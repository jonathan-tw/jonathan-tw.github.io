<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>(課程筆記)(NTUST) Information Retrieval | Jonathan&#39;s Blog</title>
<meta name="keywords" content="">
<meta name="description" content="HW1 - Vector Space Model TF、IDF計算方式: 一開始會讀取document的資料前處理，先去做一些normalized，讓lexicon不要有重複的term，而為了讓程式能在1分鐘內跑完，lexicon使用c&#43;&#43;的unordered_map下去存，unordered_map使用hash func">
<meta name="author" content="
Author:&nbsp;Jonathan">
<link rel="canonical" href="https://jonathan-tw.github.io/posts/%E8%AA%B2%E7%A8%8B%E7%AD%86%E8%A8%98ntust-information-retrieval/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.806c72d39786894802c51451bfd2443f6a16d2c4abe3341991dc1fb8d1f0b5b4.css" integrity="sha256-gGxy05eGiUgCxRRRv9JEP2oW0sSr4zQZkdwfuNHwtbQ=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.acb54fd32bbc1982428b8850317e45d076b95012730a5936667e6bc21777692a.js" integrity="sha256-rLVP0yu8GYJCi4hQMX5F0Ha5UBJzClk2Zn5rwhd3aSo="
        onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://jonathan-tw.github.io/img/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://jonathan-tw.github.io/img/favicon.ico">
<link rel="icon" type="image/png" sizes="32x32" href="https://jonathan-tw.github.io/img/favicon.ico">
<link rel="apple-touch-icon" href="https://jonathan-tw.github.io/img/favicon.ico">
<link rel="mask-icon" href="https://jonathan-tw.github.io/img/favicon.ico">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
    <style>
        @media (prefers-color-scheme: dark) {
            :root {
                --theme: rgb(29, 30, 32);
                --entry: rgb(46, 46, 51);
                --primary: rgb(218, 218, 219);
                --secondary: rgb(155, 156, 157);
                --tertiary: rgb(65, 66, 68);
                --content: rgb(196, 196, 197);
                --hljs-bg: rgb(46, 46, 51);
                --code-bg: rgb(55, 56, 62);
                --border: rgb(51, 51, 51);
            }

            .list {
                background: var(--theme);
            }

            .list:not(.dark)::-webkit-scrollbar-track {
                background: 0 0;
            }

            .list:not(.dark)::-webkit-scrollbar-thumb {
                border-color: var(--theme);
            }
        }

    </style>
</noscript>
<script>
var _hmt = _hmt || [];
(function() {
  var hm = document.createElement("script");
  hm.src = ""; 
  var s = document.getElementsByTagName("script")[0]; 
  s.parentNode.insertBefore(hm, s);
})();
</script>
<meta property="og:title" content="(課程筆記)(NTUST) Information Retrieval" />
<meta property="og:description" content="HW1 - Vector Space Model TF、IDF計算方式: 一開始會讀取document的資料前處理，先去做一些normalized，讓lexicon不要有重複的term，而為了讓程式能在1分鐘內跑完，lexicon使用c&#43;&#43;的unordered_map下去存，unordered_map使用hash func" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://jonathan-tw.github.io/posts/%E8%AA%B2%E7%A8%8B%E7%AD%86%E8%A8%98ntust-information-retrieval/" />
<meta property="og:image" content="https://i.imgur.com/hLLeFia.png" /><meta property="article:section" content="posts" />
<meta property="article:published_time" content="2023-06-19T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-06-19T00:00:00+00:00" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:image" content="https://i.imgur.com/hLLeFia.png" />
<meta name="twitter:title" content="(課程筆記)(NTUST) Information Retrieval"/>
<meta name="twitter:description" content="HW1 - Vector Space Model TF、IDF計算方式: 一開始會讀取document的資料前處理，先去做一些normalized，讓lexicon不要有重複的term，而為了讓程式能在1分鐘內跑完，lexicon使用c&#43;&#43;的unordered_map下去存，unordered_map使用hash func"/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [

        {
          "@type": "ListItem",
          "position":  2 ,
          "name": "📚 Posts",
          "item": "https://jonathan-tw.github.io/posts/"
        }, 
    {
      "@type": "ListItem",
      "position":  3 ,
      "name": "(課程筆記)(NTUST) Information Retrieval",
      "item": "https://jonathan-tw.github.io/posts/%E8%AA%B2%E7%A8%8B%E7%AD%86%E8%A8%98ntust-information-retrieval/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "(課程筆記)(NTUST) Information Retrieval",
  "name": "(課程筆記)(NTUST) Information Retrieval",
  "description": "HW1 - Vector Space Model TF、IDF計算方式: 一開始會讀取document的資料前處理，先去做一些normalized，讓lexicon不要有重複的term，而為了讓程式能在1分鐘內跑完，lexicon使用c++的unordered_map下去存，unordered_map使用hash func",
  "keywords": [
    ""
  ],
  "articleBody": "HW1 - Vector Space Model TF、IDF計算方式: 一開始會讀取document的資料前處理，先去做一些normalized，讓lexicon不要有重複的term，而為了讓程式能在1分鐘內跑完，lexicon使用c++的unordered_map下去存，unordered_map使用hash function找到key term，用來尋找及修改object有著極高的效率。有了normalized後的資料，就可以計算每個term在每個檔案中的TF (local)，接著算出每個term的IDF (global)。TF: 該index Term在該Doc下出現的次數。IDF: 該index Term 在所有Doc下出現的文章次數。\nDocument Term Weight、Query Term Weight計算方式: 有了TF、IDF之後，就能算出Document Term Weight及Query Term Weight。這裡使用的方法是老師講義中的Scheme3，會有較佳的score。\n左為:doc term 右為:query term\nVector Space Model運作原理及參數調整: 利用兩相同長度的向量(doc weight vector、query weight vector)求出cosine-similarity(兩向量之夾角)，此cosine-similarity值就代表ranking，Ranking值的範圍0 ≤ 𝑠𝑖𝑚 𝑞, 𝑑𝑗 ≤ 1。Ranking值高代表此doc與query的關聯性更高，排名會比其他ranking低的doc前面。而關於Vector Space Model參數的調整，我在老師的scheme3上進行調整，把query weight constant值改1.5、doc weight constant改2.5，有著較佳的結果。\nCode 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 # include # include # include # include # include # include # include # include using namespace std; struct TermProperty { int tf[4190] = { 0 }; int num_of_article_including; double idf; double weight; }; // TermProperty # define MAX_NUM_DOCS 4191.0 struct Dictionary { string term_name; string term_in_last_file_name; TermProperty term_property; bool operator==(const Dictionary\u0026 p) { return this-\u003eterm_name == p.term_name; } // bool inline friend std::ostream\u0026 operator\u003c\u003c(std::ostream\u0026 os, Dictionary\u0026 p) { os \u003c\u003c p.term_name; return os; } }; // Dictionary struct Document { string doc_name; vector\u003cstring\u003e all_term_names_in_file; vector\u003cdouble\u003e all_term_weight_in_file; double ranking; }; // Document struct Query { string file_name; vector\u003cint\u003e tf; vector\u003cstring\u003e term_names; vector\u003cdouble\u003e term_weights; }; // Query struct compare_key { inline bool operator() (const Document\u0026 struct1, const Document\u0026 struct2) { if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003e struct2.doc_name ) { return 1; } // if else if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003c struct2.doc_name ) { return 0; } // else if return ( struct1.ranking \u003e struct2.ranking ); } // }; class Doc_Scanner { public: unordered_map\u003cstring, Dictionary\u003e doc_terms_map; vector\u003cDocument\u003e all_docs; int num_file; vector\u003cQuery\u003e all_queries; void ReadAllDocuments() { string doc_files_path = \"./docs/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( doc_files_path.c_str(), \u0026file_info ); int k = handle; if ( handle == -1 ) { cout \u003c\u003c \"Read Docs Error. Please check your docs path.\\n\"; } // if else { num_file = 0; while ( k != -1 ) { string file_name = file_info.name; Document document; document.doc_name = file_name; document.ranking = -1; document.all_term_names_in_file = read_a_doc_to_dictionary( file_name ); all_docs.push_back( document ); num_file++; k = _findnext( handle, \u0026file_info); } // while } // else _findclose( handle ); } // ReadAllDocuments() void CalculateDocsTermWeight() { for ( int i = 0; i \u003c all_docs.size(); i++ ) { for ( int j = 0; j \u003c all_docs[i].all_term_names_in_file.size(); j++ ) { auto iterator = doc_terms_map.find( all_docs[i].all_term_names_in_file[j] ); Dictionary doc_term = iterator -\u003e second; doc_term.term_property.idf = MAX_NUM_DOCS / doc_term.term_property.num_of_article_including; doc_term.term_property.weight = ( doc_term.term_property.tf[i] + 2.5 ) * log10( doc_term.term_property.idf ); all_docs[i].all_term_weight_in_file.push_back( doc_term.term_property.weight ); iterator -\u003e second = doc_term; } // for } // for } // CalculateDocsTermWeight() void CalculateEveryQueryFile() { string query_files_path = \"./queries/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( query_files_path.c_str(), \u0026file_info ); int k = handle; while ( k != -1 ) { string file_name = file_info.name; calculate_query_term_weight( file_name ); k = _findnext( handle, \u0026file_info ); } // while } // RankEveryQuery() void RankEveryQueryFile( ofstream \u0026 output_file ) { output_file \u003c\u003c \"Query,RetrievedDocuments\\n\"; for( int i = 0; i \u003c all_queries.size(); i++ ) { query_file = all_queries[i]; for( int j = 0; j \u003c all_docs.size(); j++ ) { all_docs[j].ranking = rank_doc( all_docs[j] ); } // for sort( all_docs.begin(), all_docs.end(), compare_key() ); print_ranking( output_file ); } // for } // RankEveryQueryFile() private: Query query_file; vector\u003cdouble\u003e query_weights; vector\u003cdouble\u003e doc_weights; void calculate_query_term_weight( string query_file_name ) { fstream file; string term_name; string path_name = \"./queries/\" + query_file_name; Query query; double weight; query.file_name = query_file_name; file.open( path_name, ios::in ); while ( file.peek() != EOF ) { file \u003e\u003e term_name; auto iterator = doc_terms_map.find( term_name ); if ( iterator != doc_terms_map.end() ) { Dictionary doc_term = iterator -\u003e second; weight = 2.5 * log10( doc_term.term_property.idf ); query.term_weights.push_back( weight ); query.term_names.push_back( term_name ); } // if } // while file.close(); all_queries.push_back( query ); } // calculate_query_term_weight() double rank_doc( Document doc ) { vector\u003cdouble\u003e temp_query_weights; vector\u003cdouble\u003e temp_doc_weights = doc.all_term_weight_in_file; int i; for ( i = 0; i \u003c doc.all_term_names_in_file.size(); i++ ) { temp_query_weights.push_back( 0.0 ); } // for for ( i = 0; i \u003c query_file.term_names.size(); i++ ) { auto iterator = find( doc.all_term_names_in_file.begin(), doc.all_term_names_in_file.end(), query_file.term_names[i] ); if ( iterator == doc.all_term_names_in_file.end() ) { temp_query_weights.push_back( query_file.term_weights[i] ); temp_doc_weights.push_back( 0.0 ); } // if else { int pos = distance( doc.all_term_names_in_file.begin(), iterator ); double relpace_weight = query_file.term_weights[i]; temp_query_weights[pos] = relpace_weight; } // else } // for query_weights = temp_query_weights; doc_weights = temp_doc_weights; return cosine_similarity(); } // rank_doc() double cosine_similarity() { // cout \u003c\u003c query_weights.size() \u003c\u003c \" \" \u003c\u003c doc_weights.size() \u003c\u003c \"\\n\"; double dot = 0.0, denom_query = 0.0, denom_doc = 0.0; for ( int i = 0; i \u003c doc_weights.size(); i++ ) { dot = dot + query_weights[i] * doc_weights[i]; denom_query = denom_query + query_weights[i] * query_weights[i]; denom_doc = denom_doc + doc_weights[i] * doc_weights[i]; } // for() // cout \u003c\u003c dot \u003c\u003c \" \" \u003c\u003c denom_query \u003c\u003c \" \" \u003c\u003c denom_doc \u003c\u003c \"\\n\"; return dot / ( sqrt( denom_query ) * sqrt( denom_doc ) ); } // cosine_similarity() int partition ( int low, int high ) { double pivot = all_docs[high].ranking; // pivot int i = ( low - 1 ); for (int j = low; j \u003c high; j++) { if ( all_docs[j].ranking \u003e pivot ) { i++; // increment index of smaller element Document doc; doc = all_docs[j]; all_docs[j] = all_docs[i]; all_docs[i] = doc; } // if } // for i++; Document doc; doc = all_docs[high]; all_docs[high] = all_docs[i]; all_docs[i] = doc; return i; } // partition() void descending_order_document_ranking( int low, int high) { double pivot = partition( low, high ); descending_order_document_ranking( low, pivot -1 ); descending_order_document_ranking( pivot + 1, high ); } // descending_order_document_ranking() void print_ranking( ofstream \u0026 output_file ) { string query_name = query_file.file_name; query_name.erase( query_name.end() -4, query_name.end() ); output_file \u003c\u003c query_name \u003c\u003c \",\"; for( int i = 0; i \u003c all_docs.size(); i++ ) { string term_name = all_docs[i].doc_name; term_name.erase( term_name.end() -4, term_name.end() ); output_file \u003c\u003c term_name \u003c\u003c \" \"; } // for output_file \u003c\u003c \"\\n\"; } // print_ranking() vector\u003cstring\u003e read_a_doc_to_dictionary( string file_name ) { fstream file; string term_name; string path_name = \"./docs/\" + file_name; vector\u003cstring\u003e term_names; file.open( path_name, ios::in ); while ( file.peek() != EOF ) { file \u003e\u003e term_name; term_name = add_index_term_to_dictionary( term_name, file_name ); if ( term_name != \"\" ) term_names.push_back( term_name ); } // while file.close(); return term_names; } // read_a_doc_to_dictionary() string add_index_term_to_dictionary( string term_name, string file_name ) { auto iterator = doc_terms_map.find( term_name ); if ( iterator != doc_terms_map.end() ) { Dictionary doc_term = iterator -\u003e second; doc_term.term_property.tf[num_file]++; if ( doc_term.term_in_last_file_name != file_name ) { doc_term.term_property.num_of_article_including++; doc_term.term_in_last_file_name = file_name; } // if else { term_name = \"\"; } // else iterator -\u003e second = doc_term; } // if else { TermProperty term_property; term_property.tf[num_file] = 1; term_property.num_of_article_including = 1; Dictionary doc_term; doc_term.term_name = term_name; doc_term.term_in_last_file_name = file_name; doc_term.term_property = term_property; doc_terms_map.insert( make_pair( term_name, doc_term )); } // else return term_name; } // add_index_term_to_dictionary() }; // Doc_Scanner int main() { cout \u003c\u003c \"Start scanning documents.\\n\"; Doc_Scanner doc_scanner; doc_scanner.ReadAllDocuments(); doc_scanner.CalculateDocsTermWeight(); cout \u003c\u003c \"Scanning documents done.\\n\"; cout \u003c\u003c \"Start Calulate Query Weight\\n\"; // PrintVector( doc_terms ); doc_scanner.CalculateEveryQueryFile(); cout \u003c\u003c \"End Calulate Query Weight\\n\"; ofstream output_file( \"output_csv.csv\" ); doc_scanner.RankEveryQueryFile( output_file ); cout \u003c\u003c \"End Program\\n\"; } // main() HW2 - Best Match Model Best Match 25L 一開始使用BM25L進行實作，經過多番嘗試參數，發現其值最多只能到0.70多，後改用BM25能獲得較高的數值。而BM25L改善了其long documents的問題，間接避免了overly-penalizing，shift parameter 𝛿 = 0.5能獲得較佳的結果。\nBest Match 25原理及應用 Best Match 25一樣使用了TF 及 IDF，與the vector model不同的是BM25多加了一項document length normalization的principle，且BM25為BM15及BM11的組合，當 b = 0時，為BM15，b = 1時，為BM11，藉由調控b參數來獲得較佳的結果。\n做完也發現BM25有著比the vector model更好的表現，需要的運算時間較少且精準度更高(無須做cosine-similarity是一大優勢)，但可調節的參數需要自行設定，且doument length太長時會有精準度較差的表現。\nBest Match 25參數 在程式中第137~ 139行中(RankEveryQueryFile)分別設定了k1、k3及b值，獲得最佳參數為以下值，其中k3是隨意值，因query file中的term，tf(I,q)皆 = 1\nK1 = 1.635 b = 0.85 k3 = 1000.0\n藍色項: Document Length Normalization 綠色項: Inverse Document Frequency\n中間項: Inverse Query Frequency可省略(在HW2中)\nCode 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 # include # include # include # include # include # include # include # include using namespace std; struct TermProperty { int tf[4190] = { 0 }; int num_of_article_including; double idf; double weight; }; // TermProperty # define MAX_NUM_DOCS 4191.0 struct Dictionary { string term_name; string term_in_last_file_name; TermProperty term_property; bool operator==(const Dictionary\u0026 p) { return this-\u003eterm_name == p.term_name; } // bool inline friend std::ostream\u0026 operator\u003c\u003c(std::ostream\u0026 os, Dictionary\u0026 p) { os \u003c\u003c p.term_name; return os; } }; // Dictionary struct Document { string doc_name; float doc_length; vector\u003cstring\u003e all_term_names_in_file; vector\u003cdouble\u003e all_term_tf_in_file; vector\u003cdouble\u003e all_term_ni_in_file; vector\u003cdouble\u003e all_term_weight_in_file; double ranking; }; // Document struct Query { string file_name; vector\u003cint\u003e tf; vector\u003cstring\u003e term_names; vector\u003cdouble\u003e term_weights; }; // Query struct compare_key { inline bool operator() (const Document\u0026 struct1, const Document\u0026 struct2) { if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003e struct2.doc_name ) { return 1; } // if else if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003c struct2.doc_name ) { return 0; } // else if return ( struct1.ranking \u003e struct2.ranking ); } // }; class Doc_Scanner { public: unordered_map\u003cstring, Dictionary\u003e doc_terms_map; vector\u003cDocument\u003e all_docs; float avg_doclen; int num_file; vector\u003cQuery\u003e all_queries; void ReadAllDocuments() { string doc_files_path = \"./docs/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( doc_files_path.c_str(), \u0026file_info ); int k = handle; float doc_length = 0.0; avg_doclen = 0.0; if ( handle == -1 ) { cout \u003c\u003c \"Read Docs Error. Please check your docs path.\\n\"; } // if else { num_file = 0; while ( k != -1 ) { string file_name = file_info.name; Document document; document.doc_name = file_name; document.ranking = -1; document.all_term_names_in_file = read_a_doc_to_dictionary( file_name, doc_length ); document.doc_length = doc_length; avg_doclen += doc_length; all_docs.push_back( document ); num_file++; k = _findnext( handle, \u0026file_info); doc_length = 0.0; } // while } // else avg_doclen = avg_doclen / MAX_NUM_DOCS; _findclose( handle ); } // ReadAllDocuments() void CalculateDocsTermWeight() { for ( int i = 0; i \u003c all_docs.size(); i++ ) { for ( int j = 0; j \u003c all_docs[i].all_term_names_in_file.size(); j++ ) { auto iterator = doc_terms_map.find( all_docs[i].all_term_names_in_file[j] ); Dictionary doc_term = iterator -\u003e second; doc_term.term_property.idf = MAX_NUM_DOCS / doc_term.term_property.num_of_article_including; doc_term.term_property.weight = ( doc_term.term_property.tf[i] + 2.5 ) * log10( doc_term.term_property.idf ); all_docs[i].all_term_tf_in_file.push_back( doc_term.term_property.tf[i] ); all_docs[i].all_term_ni_in_file.push_back( doc_term.term_property.num_of_article_including ); all_docs[i].all_term_weight_in_file.push_back( doc_term.term_property.weight ); iterator -\u003e second = doc_term; } // for } // for } // CalculateDocsTermWeight() void CalculateEveryQueryFile() { string query_files_path = \"./queries/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( query_files_path.c_str(), \u0026file_info ); int k = handle; while ( k != -1 ) { string file_name = file_info.name; calculate_query_term_weight( file_name ); k = _findnext( handle, \u0026file_info ); } // while } // RankEveryQuery() void RankEveryQueryFile( ofstream \u0026 output_file ) { output_file \u003c\u003c \"Query,RetrievedDocuments\\n\"; k1 = 1.635; b = 0.85; k3 = 1000.0; for( int i = 0; i \u003c all_queries.size(); i++ ) { query_file = all_queries[i]; for( int j = 0; j \u003c all_docs.size(); j++ ) { all_docs[j].ranking = rank_doc_BM25( all_docs[j] ); } // for sort( all_docs.begin(), all_docs.end(), compare_key() ); output_ranking( output_file ); } // for } // RankEveryQueryFile() private: Query query_file; vector\u003cdouble\u003e query_weights; vector\u003cdouble\u003e doc_weights; double k1, b, k3; void calculate_query_term_weight( string query_file_name ) { fstream file; string term_name; string path_name = \"./queries/\" + query_file_name; Query query; double weight; query.file_name = query_file_name; file.open( path_name, ios::in ); while ( file.peek() != EOF ) { file \u003e\u003e term_name; auto iterator = doc_terms_map.find( term_name ); if ( iterator != doc_terms_map.end() ) { Dictionary doc_term = iterator -\u003e second; weight = 2.5 * log10( doc_term.term_property.idf ); query.term_weights.push_back( weight ); query.term_names.push_back( term_name ); } // if } // while file.close(); all_queries.push_back( query ); } // calculate_query_term_weight() double rank_doc_BM25( Document doc ) { double doc_score = 0.0, doc_temp = 0.0; for( int i = 0; i \u003c query_file.term_names.size(); i++ ) { auto it = find( doc.all_term_names_in_file.begin(), doc.all_term_names_in_file.end(), query_file.term_names[i] ); if ( it != doc.all_term_names_in_file.end() ) { int pos = it - doc.all_term_names_in_file.begin(); doc_temp = ( ( ( k1 + 1.0 ) * doc.all_term_tf_in_file[pos] ) / ( k1 * ( ( 1 - b) + b * ( doc.doc_length / avg_doclen ) ) + doc.all_term_tf_in_file[pos] ) ); doc_temp = doc_temp * ( ( k3 + 1.0 ) * 1.0 / ( k3 + 1.0 ) ); auto iterator = doc_terms_map.find( query_file.term_names[i] ); Dictionary doc_term = iterator -\u003e second; doc_temp = doc_temp * log10( ( MAX_NUM_DOCS - doc_term.term_property.num_of_article_including + 0.5 ) / ( doc_term.term_property.num_of_article_including + 0.5 ) ); } // if doc_score = doc_score + doc_temp; doc_temp = 0.0; } // for() return doc_score; } // rank_doc_BM25() void output_ranking( ofstream \u0026 output_file ) { string query_name = query_file.file_name; query_name.erase( query_name.end() -4, query_name.end() ); output_file \u003c\u003c query_name \u003c\u003c \",\"; for( int i = 0; i \u003c all_docs.size(); i++ ) { string term_name = all_docs[i].doc_name; term_name.erase( term_name.end() -4, term_name.end() ); output_file \u003c\u003c term_name \u003c\u003c \" \"; } // for output_file \u003c\u003c \"\\n\"; } // output_ranking() vector\u003cstring\u003e read_a_doc_to_dictionary( string file_name, float \u0026 doc_length ) { fstream file; string term_name; string path_name = \"./docs/\" + file_name; vector\u003cstring\u003e term_names; file.open( path_name, ios::in ); while ( file.peek() != EOF ) { file \u003e\u003e term_name; doc_length++; term_name = add_index_term_to_dictionary( term_name, file_name ); if ( term_name != \"\" ) term_names.push_back( term_name ); } // while file.close(); return term_names; } // read_a_doc_to_dictionary() string add_index_term_to_dictionary( string term_name, string file_name ) { auto iterator = doc_terms_map.find( term_name ); if ( iterator != doc_terms_map.end() ) { Dictionary doc_term = iterator -\u003e second; doc_term.term_property.tf[num_file]++; if ( doc_term.term_in_last_file_name != file_name ) { doc_term.term_property.num_of_article_including++; doc_term.term_in_last_file_name = file_name; } // if else { term_name = \"\"; } // else iterator -\u003e second = doc_term; } // if else { TermProperty term_property; term_property.tf[num_file] = 1; term_property.num_of_article_including = 1; Dictionary doc_term; doc_term.term_name = term_name; doc_term.term_in_last_file_name = file_name; doc_term.term_property = term_property; doc_terms_map.insert( make_pair( term_name, doc_term )); } // else return term_name; } // add_index_term_to_dictionary() }; // Doc_Scanner int main() { cout \u003c\u003c \"Start scanning documents.\\n\"; Doc_Scanner doc_scanner; doc_scanner.ReadAllDocuments(); doc_scanner.CalculateDocsTermWeight(); cout \u003c\u003c \"Scanning documents done.\\n\"; cout \u003c\u003c \"Start Calulate Query Weight\\n\"; // PrintVector( doc_terms ); doc_scanner.CalculateEveryQueryFile(); cout \u003c\u003c \"End Calulate Query Weight\\n\"; ofstream output_file( \"output_csv.csv\" ); doc_scanner.RankEveryQueryFile( output_file ); cout \u003c\u003c \"End Program\\n\"; } // main() HW3 - Mean Average Precision (MAP) Code 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 # include # include # include # include # include # include # include # include using namespace std; struct TermProperty { int tf[14954] = { 0 }; int num_of_article_including; double idf; double weight; }; // TermProperty # define MAX_NUM_DOCS 14955.000 struct Dictionary { string term_name; string term_in_last_file_name; TermProperty term_property; bool operator==(const Dictionary\u0026 p) { return this-\u003eterm_name == p.term_name; } // bool inline friend std::ostream\u0026 operator\u003c\u003c(std::ostream\u0026 os, Dictionary\u0026 p) { os \u003c\u003c p.term_name; return os; } }; // Dictionary struct Document { string doc_name; float doc_length; vector\u003cstring\u003e all_term_names_in_file; vector\u003cdouble\u003e all_term_tf_in_file; vector\u003cdouble\u003e all_term_ni_in_file; vector\u003cdouble\u003e all_term_weight_in_file; double ranking; }; // Document struct Query { string file_name; vector\u003cint\u003e tf; vector\u003cstring\u003e term_names; vector\u003cdouble\u003e term_weights; }; // Query struct compare_key { inline bool operator() (const Document\u0026 struct1, const Document\u0026 struct2) { if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003e struct2.doc_name ) { return 1; } // if else if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003c struct2.doc_name ) { return 0; } // else if return ( struct1.ranking \u003e struct2.ranking ); } // }; class Doc_Scanner { public: unordered_map\u003cstring, Dictionary\u003e doc_terms_map; vector\u003cDocument\u003e all_docs; double avg_doclen; int num_file; vector\u003cQuery\u003e all_queries; void ReadAllDocuments() { string doc_files_path = \"./docs/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( doc_files_path.c_str(), \u0026file_info ); int k = handle; float doc_length = 0.0; avg_doclen = 0.0; if ( handle == -1 ) { cout \u003c\u003c \"Read Docs Error. Please check your docs path.\\n\"; } // if else { num_file = 0; while ( k != -1 ) { string file_name = file_info.name; Document document; document.doc_name = file_name; document.ranking = -1; document.all_term_names_in_file = read_a_doc_to_dictionary( file_name, doc_length ); document.doc_length = doc_length; avg_doclen = avg_doclen + doc_length; all_docs.push_back( document ); num_file++; k = _findnext( handle, \u0026file_info); doc_length = 0.0; } // while } // else avg_doclen = avg_doclen / MAX_NUM_DOCS; _findclose( handle ); } // ReadAllDocuments() void CalculateDocsTermWeight() { for ( int i = 0; i \u003c all_docs.size(); i++ ) { for ( int j = 0; j \u003c all_docs[i].all_term_names_in_file.size(); j++ ) { auto iterator = doc_terms_map.find( all_docs[i].all_term_names_in_file[j] ); Dictionary doc_term = iterator -\u003e second; doc_term.term_property.idf = MAX_NUM_DOCS / doc_term.term_property.num_of_article_including; doc_term.term_property.weight = ( doc_term.term_property.tf[i] ) * log10( doc_term.term_property.idf ); all_docs[i].all_term_tf_in_file.push_back( doc_term.term_property.tf[i] ); all_docs[i].all_term_ni_in_file.push_back( doc_term.term_property.num_of_article_including ); all_docs[i].all_term_weight_in_file.push_back( doc_term.term_property.weight ); iterator -\u003e second = doc_term; } // for } // for } // CalculateDocsTermWeight() void CalculateEveryQueryFile() { string query_files_path = \"./queries/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( query_files_path.c_str(), \u0026file_info ); int k = handle; while ( k != -1 ) { string file_name = file_info.name; calculate_query_term_weight( file_name ); k = _findnext( handle, \u0026file_info ); } // while } // RankEveryQuery() void RankEveryQueryFile( ofstream \u0026 output_file ) { output_file \u003c\u003c \"Query,RetrievedDocuments\\n\"; k1 = 1.4; b = 0.5; q = 0.4; k3 = 1000; for( int i = 0; i \u003c all_queries.size(); i++ ) { query_file = all_queries[i]; for( int j = 0; j \u003c all_docs.size(); j++ ) { all_docs[j].ranking = rank_doc_BM25( all_docs[j] ); } // for sort( all_docs.begin(), all_docs.end(), compare_key() ); output_ranking( output_file ); } // for } // RankEveryQueryFile() private: Query query_file; vector\u003cdouble\u003e query_weights; vector\u003cdouble\u003e doc_weights; double k1, b, k3, q; void calculate_query_term_weight( string query_file_name ) { fstream file; string term_name; string path_name = \"./queries/\" + query_file_name; Query query; double weight; query.file_name = query_file_name; file.open( path_name, ios::in ); while ( file.peek() != EOF ) { file \u003e\u003e term_name; auto iterator = doc_terms_map.find( term_name ); if ( iterator != doc_terms_map.end() ) { Dictionary doc_term = iterator -\u003e second; weight = 2.5 * log10( doc_term.term_property.idf ); query.term_weights.push_back( weight ); query.term_names.push_back( term_name ); } // if } // while file.close(); all_queries.push_back( query ); } // calculate_query_term_weight() double rank_doc_BM25( Document doc ) { double doc_score = 0.0, doc_temp = 0.0; for( int i = 0; i \u003c query_file.term_names.size(); i++ ) { auto it = find( doc.all_term_names_in_file.begin(), doc.all_term_names_in_file.end(), query_file.term_names[i] ); if ( it != doc.all_term_names_in_file.end() ) { int pos = it - doc.all_term_names_in_file.begin(); doc_temp = doc.all_term_tf_in_file[pos] / ( ( 1 - b ) + b * ( doc.doc_length / avg_doclen ) ); if ( doc_temp \u003e 0 ) { doc_temp = ( ( k1 + 1.0 ) * ( doc_temp + q ) ) / ( k1 + doc_temp + q ); } // if else { doc_temp = 0; } // else doc_score = doc_score + doc_temp; doc_score = doc_score * ( ( k3 + 1.0 ) * 1.0 / ( k3 + 1.0 ) ); auto iterator = doc_terms_map.find( query_file.term_names[i] ); Dictionary doc_term = iterator -\u003e second; doc_score = doc_score * log10( ( MAX_NUM_DOCS - doc_term.term_property.num_of_article_including + 0.5 ) / ( doc_term.term_property.num_of_article_including + 0.5 ) ); } // if doc_score = doc_score + doc_temp; doc_temp = 0.0; } // for() return doc_score; } // rank_doc_BM25() void output_ranking( ofstream \u0026 output_file ) { string query_name = query_file.file_name; query_name.erase( query_name.end() -4, query_name.end() ); output_file \u003c\u003c query_name \u003c\u003c \",\"; for( int i = 0; i \u003c all_docs.size(); i++ ) { string term_name = all_docs[i].doc_name; term_name.erase( term_name.end() -4, term_name.end() ); output_file \u003c\u003c term_name \u003c\u003c \" \"; } // for output_file \u003c\u003c \"\\n\"; } // output_ranking() vector\u003cstring\u003e read_a_doc_to_dictionary( string file_name, float \u0026 doc_length ) { fstream file; string term_name; string path_name = \"./docs/\" + file_name; vector\u003cstring\u003e term_names; file.open( path_name, ios::in ); while ( file.peek() != EOF ) { file \u003e\u003e term_name; doc_length++; term_name = add_index_term_to_dictionary( term_name, file_name ); if ( term_name != \"\" ) term_names.push_back( term_name ); } // while file.close(); return term_names; } // read_a_doc_to_dictionary() string add_index_term_to_dictionary( string term_name, string file_name ) { auto iterator = doc_terms_map.find( term_name ); if ( iterator != doc_terms_map.end() ) { Dictionary doc_term = iterator -\u003e second; doc_term.term_property.tf[num_file]++; if ( doc_term.term_in_last_file_name != file_name ) { doc_term.term_property.num_of_article_including++; doc_term.term_in_last_file_name = file_name; } // if else { term_name = \"\"; } // else iterator -\u003e second = doc_term; } // if else { TermProperty term_property; term_property.tf[num_file] = 1; term_property.num_of_article_including = 1; Dictionary doc_term; doc_term.term_name = term_name; doc_term.term_in_last_file_name = file_name; doc_term.term_property = term_property; doc_terms_map.insert( make_pair( term_name, doc_term )); } // else return term_name; } // add_index_term_to_dictionary() }; // Doc_Scanner int main() { cout \u003c\u003c \"Start scanning documents.\\n\"; Doc_Scanner doc_scanner; doc_scanner.ReadAllDocuments(); doc_scanner.CalculateDocsTermWeight(); cout \u003c\u003c \"Scanning documents done.\\n\"; cout \u003c\u003c \"Start Calulate Query Weight\\n\"; // PrintVector( doc_terms ); doc_scanner.CalculateEveryQueryFile(); cout \u003c\u003c \"End Calulate Query Weight\\n\"; ofstream output_file( \"output_csv.csv\" ); doc_scanner.RankEveryQueryFile( output_file ); cout \u003c\u003c \"End Program\\n\"; } // main() HW4 - PLSA Model PLSA參數調法 Topic_num: 8 / a (第一項local TF機率term = 0.6) all_doc使用vector存local tf\nb (第二項gobal TF機率term = 0.25) / Inter_run: 30 dictionary使用map存word與position、global TF存\nPLSA理論心得 EM可求得隱含變量T(k)，加入了Pd_z[z][m]、Pw_z[z][w]讓其隨機初始值和為1。 透過每個TOPIC下對於Pd_z[z][m] (每一份DOC(m)下是TOPIC(z)主題之機率)與 Pw_z[z][w] (每一份TOPIC(z)下term(w)之機率)，利用兩者獨立機率反覆對Pz_dw[z][m][position]進行更新。\nPLSA實作心得 程式流程為scanning documetns➡ Init Parameter ( two for m-step、one for e-step) ➡ Run EM for 30 runs ➡ calculate for every query file and log prob\nIn step 1: 存取所有doc並記錄local、global TF到對應容器中\nIn step 2: C++需要new出memory space for these parameters.\nIn step 3: 每run完一次EM完，就會得到更新的Pd_z[z][m]、Pw_z[z][w] for m-step，利用這兩個又繼續更新Pz_dw[z][m][position] for e-step，訓練到接近收斂\nIn step 4: 與query file中term進行計算，得出每個doc對應query之機率並取log以大排到小輸出。\n選用最小Topic(8)的情況底下跑了30 run，需要非常久的時間，雖然在map上已選用unordered_map最快的容器下去實作，但時間還是花得比想像中多，在猜想的原因是因為某些可以使用map下去做映射term index的部分，比起vector中的find速度會快上不少，這次的model比起以往需要更多的時間下去完成試驗，下次的作業應提早開始準備，這樣才有更多時間進行測試。\nCode 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 # include # include # include # include # include # include # include # include # include # include # include using namespace std; # define MAX_NUM_DOC 14955.0 # define MAX_NUM_QUERY 100.0 # define MAX_NUM_TOPIC 8.0 # define MAX_NUM_ITER 30.0 # define MAX_LENGTH 7059938.0 # define MAX_NUM_WORDS 111449.0 struct TermProperty { string term_name; double tf; double prob; // probability ( first or third term ) }; // TermProperty struct Document { int docID; string doc_name; double ranking; double doc_length; vector\u003cTermProperty\u003e term_properties; }; // Documentc struct Word2doc { int docID; int position; }; // Word2doc struct Dictionary { TermProperty term_property; vector\u003cWord2doc\u003e word2doc; int word2dic; bool operator==(const Dictionary\u0026 p) { return this-\u003eterm_property.term_name == p.term_property.term_name; } // bool inline friend std::ostream\u0026 operator\u003c\u003c(std::ostream\u0026 os, Dictionary\u0026 p) { os \u003c\u003c p.term_property.term_name; return os; } }; // Dictionary struct compare_key { inline bool operator() (const Document\u0026 struct1, const Document\u0026 struct2) { if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003e struct2.doc_name ) { return 1; } // if else if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003c struct2.doc_name ) { return 0; } // else if return ( struct1.ranking \u003e struct2.ranking ); } // }; class PLSA { public: unordered_map\u003cstring, Dictionary\u003e dictionary; vector\u003cDocument\u003e all_docs; vector\u003cstring\u003e all_words; int num_file; int all_docs_len; void ReadAllDocuments() { all_docs_len = 0; string doc_files_path = \"./docs/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( doc_files_path.c_str(), \u0026file_info ); int k = handle; double doc_length = 0.0; if ( handle == -1 ) { cout \u003c\u003c \"Read Docs Error. Please check your docs path.\\n\"; } // if else { num_file = 0; while ( k != -1 ) { string file_name = file_info.name; Document document; document.doc_name = file_name; document.ranking = -1; document.term_properties = read_a_doc_to_dictionary( file_name, doc_length ); document.doc_length = doc_length; document.docID = num_file; all_docs_len += doc_length; all_docs.push_back( document ); num_file++; doc_length = 0.0; k = _findnext( handle, \u0026file_info); } // while } // else _findclose( handle ); } // ReadAllDocuments() void Init() { num_data = MAX_NUM_DOC; num_words = MAX_NUM_WORDS; num_topics = MAX_NUM_TOPIC; srand(time(NULL)); //設置随機數種子，使每次獲取的随機序列不同。 Pd_z = new double*[num_topics-1]; for ( int z = 0; z \u003c num_topics; z++ ) { double norm_down = 0.0; Pd_z[z] = new double[num_data-1]; for( int m = 0; m \u003c num_data; m++ ) { Pd_z[z][m] = (rand()%100000)*0.00001; norm_down += Pd_z[z][m]; } // for for( int m = 0; m \u003c num_data; m++ ) { Pd_z[z][m] /= norm_down; } // for } // for cout \u003c\u003c \"Init step1 done\\n\"; Pw_z = new double*[num_topics-1]; for ( int z = 0; z \u003c num_topics; z++ ) { double norm_down = 0.0; Pw_z[z] = new double[num_words-1]; for( int w = 0; w \u003c num_words; w++ ) { Pw_z[z][w] = (rand()%100000)*0.00001; norm_down += Pw_z[z][w]; } // for for( int w = 0; w \u003c num_words; w++ ) { Pw_z[z][w] /= norm_down; } // for } // for cout \u003c\u003c \"Init step2 done\\n\"; Pz_dw = new double **[num_topics-1]; for ( int z = 0; z \u003c num_topics; z++ ) { Pz_dw[z] = new double *[num_data-1]; for ( int m = 0; m \u003c num_data; m++ ) { int size = ( int ) all_docs[m].term_properties.size(); Pz_dw[z][m] = new double[size-1]; } // for() } // for() cout \u003c\u003c \"Init step3 done\\n\"; } // Init() void DoPLSA() { // start training for ( int i = 0; i \u003c MAX_NUM_ITER; i++ ) { Estep(); cout \u003c\u003c \"iteration: Estep: \" \u003c\u003c i \u003c\u003c \"\\n\"; Mstep_1(); cout \u003c\u003c \"iteration: Mstep_1: \" \u003c\u003c i \u003c\u003c \"\\n\"; Mstep_2(); cout \u003c\u003c \"iteration: Mstep_2: \" \u003c\u003c i \u003c\u003c \"\\n\"; system( \"pause\" ); } // for() } // DoPLSA() void RankEveryQueryFile( ofstream \u0026 output_file ) { a = 0.6; b = 0.25; output_file \u003c\u003c \"Query,RetrievedDocuments\\n\"; string query_files_path = \"./queries/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( query_files_path.c_str(), \u0026file_info ); int k = handle; while ( k != -1 ) { string file_name = file_info.name; calculate_query_prob( file_name ); sort( all_docs.begin(), all_docs.end(), compare_key() ); output_ranking( output_file, file_name ); k = _findnext( handle, \u0026file_info ); } // while } // RankEveryQueryFile() private: int num_data; // number of data int num_words; // number of words int num_topics; // number of topics double a, b; double **Pd_z = NULL; double **Pw_z = NULL; double ***Pz_dw = NULL; double **Dw_m = NULL; vector\u003cTermProperty\u003e read_a_doc_to_dictionary( string file_name, double \u0026 doc_length ) { fstream file; string term_name; string path_name = \"./docs/\" + file_name; vector\u003cTermProperty\u003e term_properties; TermProperty term_property; Word2doc word2doc; Dictionary doc_term; unordered_map\u003cstring, int\u003e doc2dic; file.open( path_name, ios::in ); int position = 0; while ( file.peek() != EOF ) { file \u003e\u003e term_name; doc_length++; term_property.term_name = term_name; auto it_dic = dictionary.find( term_name ); if ( it_dic != dictionary.end() ) { doc_term = it_dic -\u003e second; doc_term.term_property.tf++; doc_term.term_property.prob = doc_term.term_property.tf / MAX_LENGTH; if ( doc_term.word2doc[doc_term.word2doc.size()-1].docID != num_file ) { word2doc.docID = num_file; word2doc.position = position; doc_term.word2doc.push_back( word2doc ); term_property.tf = 1; term_properties.push_back(term_property); doc2dic.insert(make_pair(term_name, position)); position++; } // if else { auto it = doc2dic.find( term_name ); int pos = it -\u003e second; term_properties[pos].tf++; } // else it_dic -\u003e second = doc_term; } // if else { term_property.tf = 1; term_property.prob = term_property.tf / MAX_LENGTH; word2doc.docID = num_file; word2doc.position = position; doc_term.term_property = term_property; doc_term.word2doc.push_back( word2doc ); doc_term.word2dic = all_words.size(); all_words.push_back( term_name ); dictionary.insert( make_pair( term_name, doc_term )); position++; term_properties.push_back(term_property); doc2dic.insert(make_pair(term_name, position)); } // else } // while for (int i = 0; i \u003c term_properties.size(); i++ ) { term_properties[i].prob = term_properties[i].tf / doc_length; } // for file.close(); return term_properties; } // read_a_doc_to_dictionary() void Estep() { cout \u003c\u003c all_docs.size() \u003c\u003c \" \" \u003c\u003c num_data \u003c\u003c \"\\n\"; for ( int m = 0; m \u003c num_data; m++ ) { for ( int position = 0; position \u003c all_docs[m].term_properties.size(); position++ ) { double norm_down = 0.0; auto it_dic = dictionary.find( all_docs[m].term_properties[position].term_name ); if ( it_dic == dictionary.end() ) cout \u003c\u003c \"cry\\n\"; int w = it_dic -\u003e second.word2dic; for ( int z = 0; z \u003c num_topics; z++ ) { double val = Pd_z[z][m] * Pw_z[z][w]; Pz_dw[z][m][position] = val; norm_down += val; } // for() if ( norm_down != 0.0 ) { for ( int z = 0; z \u003c num_topics; z++ ) { Pz_dw[z][m][position] /= norm_down; } // for } // if else { for ( int z = 0; z \u003c num_topics; z++ ) { Pz_dw[z][m][position] = 0.0; } // for } // else } // for() if ( m \u003e= 14950 ) { cout \u003c\u003c all_docs[m].doc_name \u003c\u003c \" \" \u003c\u003c all_docs[m].term_properties.size() \u003c\u003c \" qq1\\n\"; } // if } // for } // Estep() void Mstep_1() { // Pd_z[z][m] for ( int z = 0; z \u003c num_topics; z++ ) { double norm_down = 0.0; for ( int m = 0; m \u003c num_data; m++ ) { double sum = 0.0; for ( int position = 0; position \u003c all_docs[m].term_properties.size(); position++ ) { auto it = dictionary.find( all_docs[m].term_properties[position].term_name ); sum += it -\u003e second.term_property.tf * Pz_dw[z][m][position]; } // for Pd_z[z][m] = sum; norm_down += sum; } // for() if ( norm_down != 0 ) { for ( int m = 0; m \u003c num_data; m++) { Pd_z[z][m] /= norm_down; } // for } // if else { for ( int m = 0; m \u003c num_data; m++ ) { Pd_z[z][m] = 0; } // for } // else } // for() } // Mstep_1() void Mstep_2() { // Pw_z[z][w] for ( int z = 0; z \u003c num_topics; z++ ) { double norm_down = 0.0; for ( int w = 0; w \u003c num_words; w++ ) { double sum = 0.0; string word = all_words[w]; auto it = dictionary.find( word ); vector\u003cWord2doc\u003e word2docs = it -\u003e second.word2doc; for ( int i = 0; i \u003c word2docs.size(); i++ ) { int m = word2docs[i].docID; int position = word2docs[i].position; auto it_2 = dictionary.find( all_docs[m].term_properties[position].term_name ); sum += it_2 -\u003e second.term_property.tf * Pz_dw[z][m][position]; } // for Pw_z[z][w] = sum; norm_down += sum; } // for if ( norm_down != 0 ) { for ( int w = 0; w \u003c num_words; w++) { Pw_z[z][w] /= norm_down; } // for } // if else { for ( int w = 0; w \u003c num_words; w++) { Pw_z[z][w] = 0; } // for } // else } // for } // Mstep_2() void calculate_query_prob( string query_file_name ) { fstream file; string term_name; string path_name = \"./queries/\" + query_file_name; file.open( path_name, ios::in ); vector\u003cstring\u003e all_query_term; while ( file.peek() != EOF ) { file \u003e\u003e term_name; all_query_term.push_back( term_name ); } // while for ( int i = 0; i \u003c all_docs.size(); i++ ) { double prob = 0.0; for ( int j = 0; j \u003c all_query_term.size(); j++ ) { prob = prob * calculate_term_prob( all_docs[i], all_query_term[j] ); if ( prob == 0.0 ) break; } // for if ( prob != 0.0 ) prob = log10( prob ); all_docs[i].ranking = prob; } // for } // calculate_query_prob() double calculate_term_prob( Document doc, string query_term ) { double prob = 0.0, temp_prob = 0.0; auto it_dic = dictionary.find( query_term ); if ( it_dic == dictionary.end() ) return prob; int m = doc.docID; int w = it_dic -\u003e second.word2dic; vector\u003cTermProperty\u003e term_properties = doc.term_properties; TermProperty term_property; // first term auto it_doc = find_if( term_properties.begin(), term_properties.end(), [query_term] (const TermProperty\u0026 s) { return s.term_name == query_term; } ); if ( it_doc != term_properties.end() ) { term_property = *it_doc; prob += term_property.prob * a; } // if // second term and third term for ( int z = 0; z \u003c num_topics; z++ ) { temp_prob += Pd_z[z][m] * Pw_z[z][w] ; } // for prob += temp_prob * b; prob += ( 1.0 - a - b ) * it_dic -\u003e second.term_property.prob; return prob; } // calculate_term_prob() void output_ranking( ofstream \u0026 output_file, string query_file ) { query_file.erase( query_file.end() -4, query_file.end() ); output_file \u003c\u003c query_file \u003c\u003c \",\"; for( int i = 0; i \u003c all_docs.size(); i++ ) { string term_name = all_docs[i].doc_name; term_name.erase( term_name.end() -4, term_name.end() ); output_file \u003c\u003c term_name \u003c\u003c \" \"; } // for output_file \u003c\u003c \"\\n\"; } // output_ranking() }; // PLSA int main() { cout \u003c\u003c \"Start scanning documents.\\n\"; PLSA plsa; plsa.ReadAllDocuments(); system(\"pause\"); cout \u003c\u003c \"Scanning documents done.\\n\"; cout \u003c\u003c \"Start Initing.\\n\"; plsa.Init(); cout \u003c\u003c \"End Initing.\\n\"; plsa.DoPLSA(); cout \u003c\u003c \"Done Training.\\n\"; ofstream output_file( \"output_csv.csv\" ); plsa.RankEveryQueryFile( output_file ); cout \u003c\u003c \"End Program\\n\"; } // main() HW5 - Query Modeling (Rocchio Algorithm) Query Modeling (Rocchio Algorithm)參數調法 First Information Retrieval: BM25 k1= 0.8 b = 0.7 k3 = 100.0\nSecond Information Retrieval: VSM\nRocchio algorithm: a = 2.5 b = 0.4 relevant doc = 10 non-relevant doc = 1 (c = 0.1)\n如果First Information Retrieval使用PLSA能獲得較高的分數，但需要的memory極大。\nQuery Modeling (Rocchio Algorithm)理論心得 由於query所蒐集的資料量太少，導致資料檢索前所獲得的資訊太少，而透過使用Pseudo-Relevance Feedback的過程得到加強後的query term，再進行第二次資料檢索，能獲得較好的結果。Query Modeling利用此核心精神下去實作，而本次實作Pseudo-Relevance Feedback的方法為Rocchio Algorithm。\nQuery Modeling (Rocchio Algorithm)實作心得 程式流程為scanning documents ➡ calculate every word TF-IDF ➡Run BM25/PLSA for First IR ➡ using Rocchio for updating new query weight ➡ Run VSM for Second IR\nIn step 1、2: 存取所有doc並記錄local、global TF到對應容器中\nIn step 3: 計算BM25並排序前10篇文章為relevant docs\nIn step 4: update query vector on relevant docs , normalize new query weight and add original query weight ( a = 2.5, b =0.4 ) if using non-relevant doc ( c =0.1)\nIn step 5: normalize every doc weight and do VSM separately.\n在實作過程中發現Relevant Doc篇數的設定也會有很大的影響, 不一定多比較好, 太少也可能不行，10~15篇是獲得此資料集較理想的Doc數。而參數b不能設得太大否則會讓new query weight跟original query weight的權重變得模糊，效果不好，最後在統一vector長度時，當分子其中一項為0時可以不算來增加運行速度。\nCode 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 # include # include # include # include # include # include # include # include using namespace std; struct TermProperty { int tf[14954] = { 0 }; int num_of_article_including; double idf; double weight; }; // TermProperty # define MAX_NUM_DOCS 14955.000 struct Dictionary { string term_name; string term_in_last_file_name; TermProperty term_property; bool operator==(const Dictionary\u0026 p) { return this-\u003eterm_name == p.term_name; } // bool inline friend std::ostream\u0026 operator\u003c\u003c(std::ostream\u0026 os, Dictionary\u0026 p) { os \u003c\u003c p.term_name; return os; } }; // Dictionary struct Document { string doc_name; float doc_length; vector\u003cstring\u003e all_term_names_in_file; vector\u003cdouble\u003e all_term_tf_in_file; vector\u003cdouble\u003e all_term_ni_in_file; vector\u003cdouble\u003e all_term_weight_in_file; double ranking; }; // Document struct Query { string file_name; vector\u003cint\u003e tf; vector\u003cstring\u003e term_names; vector\u003cdouble\u003e term_weights; }; // Query struct compare_key { inline bool operator() (const Document\u0026 struct1, const Document\u0026 struct2) { if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003e struct2.doc_name ) { return 1; } // if else if ( struct1.ranking == struct2.ranking \u0026\u0026 struct1.doc_name \u003c struct2.doc_name ) { return 0; } // else if return ( struct1.ranking \u003e struct2.ranking ); } // }; class Doc_Scanner { public: unordered_map\u003cstring, Dictionary\u003e doc_terms_map; vector\u003cDocument\u003e all_docs; double avg_doclen; int num_file; vector\u003cQuery\u003e all_queries; void ReadAllDocuments() { string doc_files_path = \"./docs/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( doc_files_path.c_str(), \u0026file_info ); int k = handle; float doc_length = 0.0; avg_doclen = 0.0; if ( handle == -1 ) { cout \u003c\u003c \"Read Docs Error. Please check your docs path.\\n\"; } // if else { num_file = 0; while ( k != -1 ) { string file_name = file_info.name; Document document; document.doc_name = file_name; document.ranking = -1; document.all_term_names_in_file = read_a_doc_to_dictionary( file_name, doc_length ); document.doc_length = doc_length; avg_doclen = avg_doclen + doc_length; all_docs.push_back( document ); num_file++; k = _findnext( handle, \u0026file_info); doc_length = 0.0; } // while } // else avg_doclen = avg_doclen / MAX_NUM_DOCS; _findclose( handle ); } // ReadAllDocuments() void CalculateDocsTermWeight() { for ( int i = 0; i \u003c all_docs.size(); i++ ) { for ( int j = 0; j \u003c all_docs[i].all_term_names_in_file.size(); j++ ) { auto iterator = doc_terms_map.find( all_docs[i].all_term_names_in_file[j] ); Dictionary doc_term = iterator -\u003e second; doc_term.term_property.idf = MAX_NUM_DOCS / doc_term.term_property.num_of_article_including; doc_term.term_property.weight = ( doc_term.term_property.tf[i] ) * log10( doc_term.term_property.idf ); all_docs[i].all_term_tf_in_file.push_back( doc_term.term_property.tf[i] ); all_docs[i].all_term_ni_in_file.push_back( doc_term.term_property.num_of_article_including ); all_docs[i].all_term_weight_in_file.push_back( doc_term.term_property.weight ); iterator -\u003e second = doc_term; } // for } // for } // CalculateDocsTermWeight() void CalculateEveryQueryFile() { string query_files_path = \"./queries/*.txt\"; struct _finddata_t file_info; int handle = _findfirst( query_files_path.c_str(), \u0026file_info ); int k = handle; while ( k != -1 ) { string file_name = file_info.name; calculate_query_term_weight( file_name ); k = _findnext( handle, \u0026file_info ); } // while } // RankEveryQuery() void RankEveryQueryFile( ofstream \u0026 output_file ) { output_file \u003c\u003c \"Query,RetrievedDocuments\\n\"; k1 = 1.4; b = 0.5; q = 0.4; k3 = 1000; for( int i = 0; i \u003c all_queries.size(); i++ ) { query_file = all_queries[i]; for( int j = 0; j \u003c all_docs.size(); j++ ) { all_docs[j].ranking = rank_doc_BM25( all_docs[j] ); } // for sort( all_docs.begin(), all_docs.end(), compare_key() ); output_ranking( output_file ); } // for } // RankEveryQueryFile() private: Query query_file; vector\u003cdouble\u003e query_weights; vector\u003cdouble\u003e doc_weights; double k1, b, k3, q; void calculate_query_term_weight( string query_file_name ) { fstream file; string term_name; string path_name = \"./queries/\" + query_file_name; Query query; double weight; query.file_name = query_file_name; file.open( path_name, ios::in ); while ( file.peek() != EOF ) { file \u003e\u003e term_name; auto iterator = doc_terms_map.find( term_name ); if ( iterator != doc_terms_map.end() ) { Dictionary doc_term = iterator -\u003e second; weight = 2.5 * log10( doc_term.term_property.idf ); query.term_weights.push_back( weight ); query.term_names.push_back( term_name ); } // if } // while file.close(); all_queries.push_back( query ); } // calculate_query_term_weight() double rank_doc_BM25( Document doc ) { double doc_score = 0.0, doc_temp = 0.0; for( int i = 0; i \u003c query_file.term_names.size(); i++ ) { auto it = find( doc.all_term_names_in_file.begin(), doc.all_term_names_in_file.end(), query_file.term_names[i] ); if ( it != doc.all_term_names_in_file.end() ) { int pos = it - doc.all_term_names_in_file.begin(); doc_temp = doc.all_term_tf_in_file[pos] / ( ( 1 - b ) + b * ( doc.doc_length / avg_doclen ) ); if ( doc_temp \u003e 0 ) { doc_temp = ( ( k1 + 1.0 ) * ( doc_temp + q ) ) / ( k1 + doc_temp + q ); } // if else { doc_temp = 0; } // else doc_score = doc_score + doc_temp; doc_score = doc_score * ( ( k3 + 1.0 ) * 1.0 / ( k3 + 1.0 ) ); auto iterator = doc_terms_map.find( query_file.term_names[i] ); Dictionary doc_term = iterator -\u003e second; doc_score = doc_score * log10( ( MAX_NUM_DOCS - doc_term.term_property.num_of_article_including + 0.5 ) / ( doc_term.term_property.num_of_article_including + 0.5 ) ); } // if doc_score = doc_score + doc_temp; doc_temp = 0.0; } // for() return doc_score; } // rank_doc_BM25() void output_ranking( ofstream \u0026 output_file ) { string query_name = query_file.file_name; query_name.erase( query_name.end() -4, query_name.end() ); output_file \u003c\u003c query_name \u003c\u003c \",\"; for( int i = 0; i \u003c all_docs.size(); i++ ) { string term_name = all_docs[i].doc_name; term_name.erase( term_name.end() -4, term_name.end() ); output_file \u003c\u003c term_name \u003c\u003c \" \"; } // for output_file \u003c\u003c \"\\n\"; } // output_ranking() vector\u003cstring\u003e read_a_doc_to_dictionary( string file_name, float \u0026 doc_length ) { fstream file; string term_name; string path_name = \"./docs/\" + file_name; vector\u003cstring\u003e term_names; file.open( path_name, ios::in ); while ( file.peek() != EOF ) { file \u003e\u003e term_name; doc_length++; term_name = add_index_term_to_dictionary( term_name, file_name ); if ( term_name != \"\" ) term_names.push_back( term_name ); } // while file.close(); return term_names; } // read_a_doc_to_dictionary() string add_index_term_to_dictionary( string term_name, string file_name ) { auto iterator = doc_terms_map.find( term_name ); if ( iterator != doc_terms_map.end() ) { Dictionary doc_term = iterator -\u003e second; doc_term.term_property.tf[num_file]++; if ( doc_term.term_in_last_file_name != file_name ) { doc_term.term_property.num_of_article_including++; doc_term.term_in_last_file_name = file_name; } // if else { term_name = \"\"; } // else iterator -\u003e second = doc_term; } // if else { TermProperty term_property; term_property.tf[num_file] = 1; term_property.num_of_article_including = 1; Dictionary doc_term; doc_term.term_name = term_name; doc_term.term_in_last_file_name = file_name; doc_term.term_property = term_property; doc_terms_map.insert( make_pair( term_name, doc_term )); } // else return term_name; } // add_index_term_to_dictionary() }; // Doc_Scanner int main() { cout \u003c\u003c \"Start scanning documents.\\n\"; Doc_Scanner doc_scanner; doc_scanner.ReadAllDocuments(); doc_scanner.CalculateDocsTermWeight(); cout \u003c\u003c \"Scanning documents done.\\n\"; cout \u003c\u003c \"Start Calulate Query Weight\\n\"; // PrintVector( doc_terms ); doc_scanner.CalculateEveryQueryFile(); cout \u003c\u003c \"End Calulate Query Weight\\n\"; ofstream output_file( \"output_csv.csv\" ); doc_scanner.RankEveryQueryFile( output_file ); cout \u003c\u003c \"End Program\\n\"; } // main() HW6 - BERT Model BERT 參數調法 BERT 理論心得 BERT(雙向Transformer編碼表達)\n主要是以兩種預訓練的方式來建立語言模型。 讓model分辨句⼦之間上下⽂之關係 簡而知BERT預訓練模型需要做兩個主要任務:\n第⼀Task: 判斷兩句話是否真的相鄰(Binary classification)\n第⼆Task: 預測被mask之單詞(Multi-class classification)\n(三) BERT實作心得\n使用助教提供的baseline code下去實現，其主要呼叫的地方可以查官方API實作出來，利用此model回傳loss及logits值。\n而TO-DO地方中需要回傳BM25的2D array scores，可以利用助教的方法實現\nCode 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23 24 25 26 27 28 29 30 31 32 33 34 35 36 37 38 39 40 41 42 43 44 45 46 47 48 49 50 51 52 53 54 55 56 57 58 59 60 61 62 63 64 65 66 67 68 69 70 71 72 73 74 75 76 77 78 79 80 81 82 83 84 85 86 87 88 89 90 91 92 93 94 95 96 97 98 99 100 101 102 103 104 105 106 107 108 109 110 111 112 113 114 115 116 117 118 119 120 121 122 123 124 125 126 127 128 129 130 131 132 133 134 135 136 137 138 139 140 141 142 143 144 145 146 147 148 149 150 151 152 153 154 155 156 157 158 159 160 161 162 163 164 165 166 167 168 169 170 171 172 173 174 175 176 177 178 179 180 181 182 183 184 185 186 187 188 189 190 191 192 193 194 195 196 197 198 199 200 201 202 203 204 205 206 207 208 209 210 211 212 213 214 215 216 217 218 219 220 221 222 223 224 225 226 227 228 229 230 231 232 233 234 235 236 237 238 239 240 241 242 243 244 245 246 247 248 249 250 251 252 253 254 255 256 257 258 259 260 261 262 263 264 265 266 267 268 269 270 271 272 273 274 275 276 277 278 279 280 281 282 283 284 285 286 287 288 289 290 291 292 293 294 295 296 297 298 299 300 301 302 303 304 305 306 307 308 309 310 311 312 313 314 315 316 317 318 319 320 321 322 323 324 325 326 327 328 329 330 331 332 333 334 335 336 337 338 339 340 341 342 343 344 345 346 347 348 349 350 351 352 353 354 355 356 357 358 359 360 361 362 363 364 365 366 367 368 369 370 371 372 373 374 375 376 377 378 379 380 381 382 383 384 385 386 387 388 389 390 391 392 393 394 395 396 397 398 399 400 401 402 403 404 405 406 407 408 409 410 411 412 413 414 415 416 417 418 419 420 421 422 423 424 425 426 427 428 429 430 431 432 433 434 435 436 437 438 439 440 441 442 443 444 445 446 447 448 449 450 451 452 453 454 455 456 457 458 459 460 461 462 463 464 465 466 467 468 469 470 471 472 473 474 475 476 477 478 479 480 481 482 483 484 485 486 487 488 489 490 491 492 493 494 495 496 497 498 499 500 501 502 503 504 505 506 507 508 509 510 511 512 513 514 515 516 517 518 519 520 521 522 523 524 525 526 527 528 #!/usr/bin/env python # coding: utf-8 # In[ ]: from time import time from datetime import timedelta from copy import deepcopy import random import numpy as np import pandas as pd from ml_metrics import mapk import torch from torch.optim import AdamW from torch.nn.utils.rnn import pad_sequence from torch.utils.data import Dataset, DataLoader from transformers import BertTokenizerFast, BertForMultipleChoice # Random seed SEED = 42 random.seed(SEED) np.random.seed(SEED) torch.manual_seed(SEED) # CUDA device use_cuda_device = 0 torch.cuda.set_device(use_cuda_device) print(\"Using CUDA device: %d\" % torch.cuda.current_device()) # ## Settings # In[ ]: # Input files document_csv_path = '../input/ntust-ir2020-homework6/documents.csv' training_csv_path = '../input/ntust-ir2020-homework6/train_queries.csv' testing_csv_path = '../input/ntust-ir2020-homework6/test_queries.csv' # Input limitation max_query_length = 64 max_input_length = 512 num_negatives = 3 # num. of negative documents to pair with a positive document # Model finetuning model_name_or_path = \"bert-base-uncased\" max_epochs = 1 learning_rate = 3e-5 dev_set_ratio = 0.2 # make a ratio of training set as development set for rescoring weight sniffing max_patience = 0 # earlystop if avg. loss on development set doesn't decrease for num. of epochs batch_size = 2 # num. of inputs = 8 requires ~9200 MB VRAM (num. of inputs = batch_size * (num_negatives + 1)) num_workers = 2 # num. of jobs for pytorch dataloader # Save paths save_model_path = \"models/bert_base_uncased\" # assign `None` for not saving the model save_submission_path = \"bm25_bert_rescoring.csv\" K = 1000 # for MAP@K # ## Preparing # In[ ]: # Build and save BERT tokenizer tokenizer = BertTokenizerFast.from_pretrained(model_name_or_path) if save_model_path is not None: save_tokenizer_path = \"%s/tokenizer\" % (save_model_path) tokenizer.save_pretrained(save_tokenizer_path) # Collect mapping of all document id and text doc_id_to_text = {} doc_df = pd.read_csv(document_csv_path) doc_df.fillna(\"\", inplace=True) id_text_pair = zip(doc_df[\"doc_id\"], doc_df[\"doc_text\"]) for i, pair in enumerate(id_text_pair, start=1): doc_id, doc_text = pair doc_id_to_text[doc_id] = doc_text print(\"Progress: %d/%d\\r\" % (i, len(doc_df)), end='') doc_df.tail() # # Training # ## Split a ratio of training set as development set # In[ ]: train_df = pd.read_csv(training_csv_path) dev_df, train_df = np.split(train_df, [int(dev_set_ratio*len(train_df))]) dev_df.reset_index(drop=True, inplace=True) train_df.reset_index(drop=True, inplace=True) print(\"train_df shape:\", train_df.shape) print(\"dev_df shape:\", dev_df.shape) train_df.tail() # ## Build instances for training/development set # In[ ]: get_ipython().run_cell_magic('time', '', 'doc_id_to_token_ids = {}\\n\\n\\ndef preprocess_df(df):\\n \\'\\'\\' Preprocess DataFrame into training instances for BERT. \\'\\'\\'\\n instances = []\\n \\n # Parse CSV\\n for i, row in df.iterrows():\\n query_id, query_text, pos_doc_ids, bm25_top1000, _ = row\\n pos_doc_id_list = pos_doc_ids.split()\\n pos_doc_id_set = set(pos_doc_id_list)\\n bm25_top1000_list = bm25_top1000.split()\\n bm25_top1000_set = set(bm25_top1000_list)\\n\\n # Pair BM25 neg. with pos. samples\\n labeled_pos_neg_list = []\\n for pos_doc_id in pos_doc_id_list:\\n neg_doc_id_set = bm25_top1000_set - pos_doc_id_set\\n neg_doc_ids = random.sample(neg_doc_id_set, num_negatives)\\n pos_position = random.randint(0, num_negatives)\\n pos_neg_doc_ids = neg_doc_ids\\n pos_neg_doc_ids.insert(pos_position, pos_doc_id)\\n labeled_sample = (pos_neg_doc_ids, pos_position)\\n labeled_pos_neg_list.append(labeled_sample)\\n \\n # Make query tokens for BERT\\n query_tokens = tokenizer.tokenize(query_text)\\n if len(query_tokens) \u003e max_query_length: # truncation\\n query_tokens = query_tokens[:max_query_length]\\n query_token_ids = tokenizer.convert_tokens_to_ids(query_tokens)\\n query_token_ids.insert(0, tokenizer.cls_token_id)\\n query_token_ids.append(tokenizer.sep_token_id)\\n\\n # Make input instances for all query/doc pairs\\n for doc_ids, label in labeled_pos_neg_list:\\n paired_input_ids = []\\n paired_attention_mask = []\\n paired_token_type_ids = []\\n \\n # Merge all pos/neg inputs as a single sample\\n for doc_id in doc_ids:\\n if doc_id in doc_id_to_token_ids:\\n doc_token_ids = doc_id_to_token_ids[doc_id]\\n else:\\n doc_text = doc_id_to_text[doc_id]\\n doc_tokens = tokenizer.tokenize(doc_text)\\n doc_token_ids = tokenizer.convert_tokens_to_ids(doc_tokens)\\n doc_id_to_token_ids[doc_id] = doc_token_ids\\n doc_token_ids.append(tokenizer.sep_token_id)\\n\\n # make input sequences for BERT\\n input_ids = query_token_ids + doc_token_ids\\n token_type_ids = [0 for token_id in query_token_ids]\\n token_type_ids.extend(1 for token_id in doc_token_ids)\\n if len(input_ids) \u003e max_input_length: # truncation\\n input_ids = input_ids[:max_input_length]\\n token_type_ids = token_type_ids[:max_input_length]\\n attention_mask = [1 for token_id in input_ids]\\n \\n # convert and collect inputs as tensors\\n input_ids = torch.LongTensor(input_ids)\\n attention_mask = torch.FloatTensor(attention_mask)\\n token_type_ids = torch.LongTensor(token_type_ids)\\n paired_input_ids.append(input_ids)\\n paired_attention_mask.append(attention_mask)\\n paired_token_type_ids.append(token_type_ids)\\n label = torch.LongTensor([label]).squeeze()\\n \\n # Pre-pad tensor pairs for efficiency\\n paired_input_ids = pad_sequence(paired_input_ids, batch_first=True)\\n paired_attention_mask = pad_sequence(paired_attention_mask, batch_first=True)\\n paired_token_type_ids = pad_sequence(paired_token_type_ids, batch_first=True)\\n\\n # collect all inputs as a dictionary\\n instance = {}\\n instance[\\'input_ids\\'] = paired_input_ids.T # transpose for code efficiency\\n instance[\\'attention_mask\\'] = paired_attention_mask.T\\n instance[\\'token_type_ids\\'] = paired_token_type_ids.T\\n instance[\\'label\\'] = label\\n instances.append(instance)\\n\\n print(\"Progress: %d/%d\\\\r\" % (i+1, len(df)), end=\\'\\')\\n print()\\n return instances\\n\\ntrain_instances = preprocess_df(train_df)\\ndev_instances = preprocess_df(dev_df)\\n\\nprint(\"num. train_instances: %d\" % len(train_instances))\\nprint(\"num. dev_instances: %d\" % len(dev_instances))\\nprint(\"input_ids.T shape:\", train_instances[0][\\'input_ids\\'].T.shape)\\ntrain_instances[0][\\'input_ids\\'].T\\n') # ## Build dataset and dataloader for PyTorch # In[ ]: class TrainingDataset(Dataset): def __init__(self, instances): self.instances = instances def __len__(self): return len(self.instances) def __getitem__(self, i): instance = self.instances[i] input_ids = instance['input_ids'] attention_mask = instance['attention_mask'] token_type_ids = instance['token_type_ids'] label = instance['label'] return input_ids, attention_mask, token_type_ids, label def get_train_dataloader(instances, batch_size=2, num_workers=4): def collate_fn(batch): input_ids, attention_mask, token_type_ids, labels = zip(*batch) input_ids = pad_sequence(input_ids, batch_first=True).transpose(1,2).contiguous() # re-transpose attention_mask = pad_sequence(attention_mask, batch_first=True).transpose(1,2).contiguous() token_type_ids = pad_sequence(token_type_ids, batch_first=True).transpose(1,2).contiguous() labels = torch.stack(labels) return input_ids, attention_mask, token_type_ids, labels dataset = TrainingDataset(instances) dataloader = DataLoader(dataset, collate_fn=collate_fn, shuffle=True, \\ batch_size=batch_size, num_workers=num_workers) return dataloader # Demo dataloader = get_train_dataloader(train_instances) for batch in dataloader: input_ids, attention_mask, token_type_ids, labels = batch break print(input_ids.shape) input_ids # ## Initialize and finetune BERT # In[ ]: model = BertForMultipleChoice.from_pretrained(model_name_or_path) model.cuda() optimizer = AdamW(model.parameters(), lr=learning_rate) optimizer.zero_grad() # ### (TO-DO!) Define validation function for earlystopping # In[ ]: def validate(model, instances): total_loss = 0 model.eval() dataloader = get_train_dataloader(instances, batch_size=batch_size, num_workers=num_workers) for batch in dataloader: batch = (tensor.cuda() for tensor in batch) input_ids, attention_mask, token_type_ids, labels = batch ''' TO-DO: 1. Compute the cross-entropy loss (using built-in loss of BertForMultipleChoice) (Hint: You need to call a function of model which takes all the 4 tensors in the batch as inputs) 2. Sum up the loss of all dev-set samples (Hint: The built-in loss is averaged, so you should multiply it with the batch size) ''' with torch.no_grad(): ### 1. insert_missing_code loss = model( input_ids = input_ids, attention_mask = attention_mask, token_type_ids = token_type_ids, labels = labels, return_dict=1 ).loss ### 2. insert_missing_code total_loss += loss * batch_size avg_loss = total_loss / len(instances) return avg_loss # ### (TO-DO!) Let's train this beeg boy ;-) # In[ ]: patience, best_dev_loss = 0, 1e10 best_state_dict = model.state_dict() start_time = time() dataloader = get_train_dataloader(train_instances, batch_size=batch_size, num_workers=num_workers) for epoch in range(1, max_epochs+1): model.train() for i, batch in enumerate(dataloader, start=1): batch = (tensor.cuda() for tensor in batch) input_ids, attention_mask, token_type_ids, labels = batch # Backpropogation ''' TO-DO: 1. Compute the cross-entropy loss (using built-in loss of BertForMultipleChoice) (Hint: You need to call a function of model which takes all the 4 tensors in the batch as inputs) 2. Perform backpropogation on the loss (i.e. compute gradients) 3. Optimize the model. (Hint: These two lines of codes can be found in PyTorch tutorial) ''' ### 1. insert_missing_code loss = model( input_ids = input_ids, attention_mask = attention_mask, token_type_ids = token_type_ids, labels = labels, return_dict=1 ).loss ### 2. insert_missing_code loss.backward() ### 3. insert_missing_code optimizer.step() optimizer.zero_grad() # Progress bar with timer ;-) elapsed_time = time() - start_time elapsed_time = timedelta(seconds=int(elapsed_time)) print(\"Epoch: %d/%d | Batch: %d/%d | loss=%.5f | %s \\r\" \\ % (epoch, max_epochs, i, len(dataloader), loss, elapsed_time), end='') # Save parameters of each epoch if save_model_path is not None: save_checkpoint_path = \"%s/epoch_%d\" % (save_model_path, epoch) model.save_pretrained(save_checkpoint_path) # Get avg. loss on development set print(\"Epoch: %d/%d | Validating... \\r\" % (epoch, max_epochs), end='') dev_loss = validate(model, dev_instances) elapsed_time = time() - start_time elapsed_time = timedelta(seconds=int(elapsed_time)) print(\"Epoch: %d/%d | dev_loss=%.5f | %s \" \\ % (epoch, max_epochs, dev_loss, elapsed_time)) # Track best checkpoint and earlystop patience if dev_loss \u003c best_dev_loss: patience = 0 best_dev_loss = dev_loss best_state_dict = deepcopy(model.state_dict()) if save_model_path is not None: model.save_pretrained(save_model_path) else: patience += 1 if patience \u003e max_patience: print('Earlystop at epoch %d' % epoch) break # Restore parameters with best loss on development set model.load_state_dict(best_state_dict) # # Testing # In[ ]: class TestingDataset(Dataset): def __init__(self, instances): self.instances = instances def __len__(self): return len(self.instances) def __getitem__(self, i): instance = self.instances[i] input_ids = instance['input_ids'] attention_mask = instance['attention_mask'] token_type_ids = instance['token_type_ids'] input_ids = torch.LongTensor(input_ids) attention_mask = torch.FloatTensor(attention_mask) token_type_ids = torch.LongTensor(token_type_ids) return input_ids, attention_mask, token_type_ids, def get_test_dataloader(instances, batch_size=8, num_workers=4): def collate_fn(batch): input_ids, attention_mask, token_type_ids = zip(*batch) input_ids = pad_sequence(input_ids, batch_first=True).unsqueeze(1) # predict as single choice attention_mask = pad_sequence(attention_mask, batch_first=True).unsqueeze(1) token_type_ids = pad_sequence(token_type_ids, batch_first=True).unsqueeze(1) return input_ids, attention_mask, token_type_ids dataset = TestingDataset(instances) dataloader = DataLoader(dataset, collate_fn=collate_fn, shuffle=False, \\ batch_size=batch_size, num_workers=num_workers) return dataloader # ## (TO-DO!) Define function to predict BERT scores # In[ ]: def predict_query_doc_scores(model, df): model.eval() start_time = time() # Parse CSV query_id_list = df[\"query_id\"] query_text_list = df[\"query_text\"] bm25_top1000_list = df[\"bm25_top1000\"] # Treat {1 query, K documents} as a dataset for prediction query_doc_scores = [] query_doc_ids = [] rows = zip(query_id_list, query_text_list, bm25_top1000_list) for qi, row in enumerate(rows, start=1): query_id, query_text, bm25_top1000 = row bm25_doc_id_list = bm25_top1000.split() query_doc_ids.append(bm25_doc_id_list) ################################################# # Collect all instances of query/doc pairs ################################################# query_instances = [] # Make query tokens for BERT query_tokens = tokenizer.tokenize(query_text) if len(query_tokens) \u003e max_query_length: # truncation query_tokens = query_tokens[:max_query_length] query_token_ids = tokenizer.convert_tokens_to_ids(query_tokens) query_token_ids.insert(0, tokenizer.cls_token_id) query_token_ids.append(tokenizer.sep_token_id) # Make input instances for all query/doc pairs for i, doc_id in enumerate(bm25_doc_id_list, start=1): if doc_id in doc_id_to_token_ids: doc_token_ids = doc_id_to_token_ids[doc_id] else: doc_text = doc_id_to_text[doc_id] doc_tokens = tokenizer.tokenize(doc_text) doc_token_ids = tokenizer.convert_tokens_to_ids(doc_tokens) doc_id_to_token_ids[doc_id] = doc_token_ids doc_token_ids.append(tokenizer.sep_token_id) # make input sequences for BERT input_ids = query_token_ids + doc_token_ids token_type_ids = [0 for token_id in query_token_ids] token_type_ids.extend(1 for token_id in doc_token_ids) if len(input_ids) \u003e max_input_length: # truncation input_ids = input_ids[:max_input_length] token_type_ids = token_type_ids[:max_input_length] attention_mask = [1 for token_id in input_ids] # convert and collect inputs as tensors input_ids = torch.LongTensor(input_ids) attention_mask = torch.FloatTensor(attention_mask) token_type_ids = torch.LongTensor(token_type_ids) # collect all inputs as a dictionary instance = {} instance['input_ids'] = input_ids instance['attention_mask'] = attention_mask instance['token_type_ids'] = token_type_ids query_instances.append(instance) ################################################################# # Predict relevance scores for all BM25-top-1000 documents ################################################################# doc_scores = np.empty((0,1)) # Predict scores for each document dataloader = get_test_dataloader(query_instances, batch_size=batch_size*(num_negatives+1), num_workers=num_workers) for di, batch in enumerate(dataloader, start=1): batch = (tensor.cuda() for tensor in batch) input_ids, attention_mask, token_type_ids = batch ''' TO-DO: 1. Compute the logits as relevance scores (using the same function of how you compute built-in loss) (Hint: You need to call a function of model which takes all the 3 tensors in the batch as inputs) 2. The scores are still on GPU. Reallocate them on CPU, and convert into numpy arrays. (Hint: You need to call two functions on the `scores` tensors. You can find them in PyTorch tutorial.) ''' with torch.no_grad(): ### 1. insert_missing_code_to_compute_logits ### scores = model( input_ids=input_ids, attention_mask=attention_mask, token_type_ids=token_type_ids, return_dict=True ).logits # merge all scores into a big numpy array ### step 2. insert_missing_function_1()###.###insert_missing_function_2() scores = scores.cpu().numpy() doc_scores = np.vstack((doc_scores, scores)) ## 新增new row # Progress bar with timer ;-) elapsed_time = time() - start_time elapsed_time = timedelta(seconds=int(elapsed_time)) print(\"Query: %d/%d | Progress: %d/%d | %s \\r\" \\ % (qi, len(df), di, len(dataloader), elapsed_time), end='') # merge all query/BM25 document pair scores query_doc_scores.append(doc_scores) query_doc_scores = np.hstack(query_doc_scores).T print() return query_doc_scores, query_doc_ids # In[ ]: # ## (TO-DO!) Find best weight of BERT for BM25 rescoring on training set # In[ ]: dev_query_doc_scores, dev_query_doc_ids = predict_query_doc_scores(model, dev_df) print('---- Grid search weight for \"BM25 + weight * BERT\" ----') best_map_score, best_bert_weight = -100, 0.0 bert_scores = dev_query_doc_scores n_query = dev_query_doc_scores.shape[0] # Get MAP@K of BM25 baseline query_pos_doc_ids = dev_df['pos_doc_ids'].values.tolist() actual = [doc_ids.split() for doc_ids in query_pos_doc_ids] bm25_predicted = [doc_id_list[:K] for doc_id_list in dev_query_doc_ids] map_score = mapk(actual, bm25_predicted, k=K) best_map_score = map_score print(\"weight=%.1f: %.5f (BM25 baseline)\" % (0, 100*map_score)) # Collect BM25 scores into same format of BERT scores ''' TO-DO: 1. Convert the BM25 top-1000 scores into 2d numpy arrays 2. BM25 scores should have the same shape and orders as `dev_query_doc_scores` (i.e. BERT scores) (Hint: If there are 24 dev-set queries, the shape should be (24, 1000) ) ''' ### 2. insert_whatever_you_want_to_meet_the_requirement_in_step2. bm25_scores = [scores.split() for scores in dev_df[\"bm25_top1000_scores\"]] bm25_scores = [[float(score) for score in scores] for scores in bm25_scores] bm25_scores = np.array(bm25_scores) # Grid search for BM25 + BERT rescoring low_bound, high_bound, scale = 0, 5, 1000 grids = [i / scale for i in range(low_bound * scale+1, high_bound * scale+1)] for weight in grids: ''' TO-DO: 1. Compute the weighted scores using `bm25_scores`, `weight`, and `bert_scores` ''' weighted_scores = bm25_scores + weight * bert_scores ### 1. insert_missing_code ### # sort index and map to document ids as output rescore_argsort = np.flip(weighted_scores.argsort(), axis=1) predicted = [] for i in range(n_query): # num. of queries predicted.append([dev_query_doc_ids[i][idx] for idx in rescore_argsort[i]][:K]) map_score = mapk(actual, predicted, k=K) # show part of results for human evaluation if weight * 10 % 2 == 0: print(\"weight=%.1f: %.5f\" % (weight, 100*map_score)) # track weight with best MAP@10 if map_score \u003e best_map_score: best_map_score = map_score best_bert_weight = weight print(\"\\nHighest MAP@%d = %.5f found at weight=%.3f\" % (K, 100*best_map_score, best_bert_weight)) # ## (TO-DO!) Rescore testing set with BERT for submission # In[ ]: # Predict BERT scores for testing set test_df = pd.read_csv(testing_csv_path) query_id_list = test_df[\"query_id\"] n_query = len(query_id_list) test_query_doc_scores, test_query_doc_ids = predict_query_doc_scores(model, test_df) bert_scores = test_query_doc_scores # In[ ]: # Rescore query/document score with BM25 + BERT bm25_scores = [scores.split() for scores in test_df[\"bm25_top1000_scores\"]] # parse into 2d list of string bm25_scores = [[float(score) for score in scores] for scores in bm25_scores] # convert to float bm25_scores = np.array(bm25_scores) ''' TO-DO: 1. Compute the weighted scores using `bm25_scores`, `best_bert_weight`, and `bert_scores` ''' ### 1. insesrt_missing_code ### weighted_scores = bm25_scores + best_bert_weight * bert_scores # Rerank document ids with new scores rescore_argsort = np.flip(weighted_scores.argsort(), axis=1) ranked_doc_id_list = [] for i in range(n_query): # num. of queries ranked_doc_id_list.append([test_query_doc_ids[i][idx] for idx in rescore_argsort[i]][:K]) ranked_doc_ids = [' '.join(doc_id_list) for doc_id_list in ranked_doc_id_list] # Save reranked results for submission data = {'query_id': query_id_list, 'ranked_doc_ids': ranked_doc_ids} submission_df = pd.DataFrame(data) submission_df.reset_index(drop=True, inplace=True) submission_df.to_csv(save_submission_path, index=False) print(\"Saved submission file as `%s`\" % save_submission_path) ",
  "wordCount" : "13027",
  "inLanguage": "en",
  "image":"https://i.imgur.com/hLLeFia.png","datePublished": "2023-06-19T00:00:00Z",
  "dateModified": "2023-06-19T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Jonathan"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://jonathan-tw.github.io/posts/%E8%AA%B2%E7%A8%8B%E7%AD%86%E8%A8%98ntust-information-retrieval/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "Jonathan's Blog",
    "logo": {
      "@type": "ImageObject",
      "url": "https://jonathan-tw.github.io/img/favicon.ico"
    }
  }
}
</script>
</head>

<body class="" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "dark") {
        document.body.classList.add('dark');
    } else if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    } else if (window.matchMedia('(prefers-color-scheme: dark)').matches) {
        document.body.classList.add('dark');
    }

</script>



<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://jonathan-tw.github.io" accesskey="h" title="Jonathan&#39;s Blog (Alt + H)">
            <img src="https://jonathan-tw.github.io/img/favicon.ico" alt="logo" aria-label="logo"
                 height="35">Jonathan&#39;s Blog</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24"
                         fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                         stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://jonathan-tw.github.io/" title="🏠 Home">
                <span>🏠 Home</span>
                </a>
            </li>
            <li>
                <a href="https://jonathan-tw.github.io/posts" title="📚 Posts">
                <span>📚 Posts</span>
                </a>
            </li>
            <li>
                <a href="https://jonathan-tw.github.io/tags" title="🧩 Tags">
                <span>🧩 Tags</span>
                </a>
            </li>
            <li>
                <a href="https://jonathan-tw.github.io/archives/" title="📅 Archive">
                <span>📅 Archive</span>
                </a>
            </li>
            <li>
                <a href="https://jonathan-tw.github.io/search" title="🔍 Search (Alt &#43; /)" accesskey=/>
                <span>🔍 Search</span>
                </a>
            </li>
            <li>
                <a href="https://coding-interview.netlify.app/" title="👨‍💻 Jonathan&#39;s Coding Interview">
                <span>👨‍💻 Jonathan&#39;s Coding Interview</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main page">
<article class="post-single">
    <div id="single-content">
        <header class="post-header">
            <div class="breadcrumbs"><a href="https://jonathan-tw.github.io">Home</a>&nbsp;»&nbsp;<a href="https://jonathan-tw.github.io/posts/">📚 Posts</a></div>
            <h1 class="post-title">
                (課程筆記)(NTUST) Information Retrieval
            </h1>
            <div class="post-meta">Created:&nbsp;<span title='2023-06-19 00:00:00 +0000 UTC'>2023-06-19</span>&nbsp;|&nbsp;Upated:&nbsp;2023-06-19&nbsp;|&nbsp;Count words:&nbsp;13027&nbsp;|&nbsp;Reading time:&nbsp;27 mins



                &nbsp;|&nbsp;Tags: &nbsp;
                <ul class="post-tags-meta">
                    <a href="https://jonathan-tw.github.io/tags/ntust/">NTUST</a>
                    <a href="https://jonathan-tw.github.io/tags/%E8%AA%B2%E7%A8%8B%E7%AD%86%E8%A8%98/">、課程筆記</a>
                </ul>
                

            
            </span>

</div>
        </header> 
<figure class="entry-cover1"><img loading="lazy" src="https://i.imgur.com/hLLeFia.png" alt="">
        
</figure>
        <aside id="toc-container" class="toc-container wide">
    <div class="toc">
        <details  open>
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#hw1---vector-space-model" aria-label="HW1 - Vector Space Model">HW1 - Vector Space Model</a><ul>
                        
                <li>
                    <a href="#code" aria-label="Code">Code</a></li></ul>
                </li>
                <li>
                    <a href="#hw2---best-match-model" aria-label="HW2 - Best Match Model">HW2 - Best Match Model</a><ul>
                        
                <li>
                    <a href="#code-1" aria-label="Code">Code</a></li></ul>
                </li>
                <li>
                    <a href="#hw3---mean-average-precision-map" aria-label="HW3 - Mean Average Precision (MAP)">HW3 - Mean Average Precision (MAP)</a><ul>
                        
                <li>
                    <a href="#code-2" aria-label="Code">Code</a></li></ul>
                </li>
                <li>
                    <a href="#hw4---plsa-model" aria-label="HW4 - PLSA Model">HW4 - PLSA Model</a><ul>
                        
                <li>
                    <a href="#code-3" aria-label="Code">Code</a></li></ul>
                </li>
                <li>
                    <a href="#hw5---query-modeling-rocchio-algorithm" aria-label="HW5 - Query Modeling (Rocchio Algorithm)">HW5 - Query Modeling (Rocchio Algorithm)</a><ul>
                        
                <li>
                    <a href="#code-4" aria-label="Code">Code</a></li></ul>
                </li>
                <li>
                    <a href="#hw6---bert-model" aria-label="HW6 - BERT Model">HW6 - BERT Model</a><ul>
                        
                <li>
                    <a href="#code-5" aria-label="Code">Code</a>
                </li>
            </ul>
            </li>
            </ul>
        </div>
        </details>
    </div>
</aside>
<script>
    let activeElement;
    let elements;
    window.addEventListener('DOMContentLoaded', function (event) {
        checkTocPosition();

        elements = document.querySelectorAll('h1[id],h2[id],h3[id],h4[id],h5[id],h6[id]');
        
        activeElement = elements[0];
        const id = encodeURI(activeElement.getAttribute('id')).toLowerCase();
        document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
    }, false);

    window.addEventListener('resize', function(event) {
        checkTocPosition();
    }, false);

    window.addEventListener('scroll', () => {
        
        activeElement = Array.from(elements).find((element) => {
            if ((getOffsetTop(element) - window.pageYOffset) > 0 &&
                (getOffsetTop(element) - window.pageYOffset) < window.innerHeight/2) {
                return element;
            }
        }) || activeElement

        elements.forEach(element => {
            const id = encodeURI(element.getAttribute('id')).toLowerCase();
            if (element === activeElement){
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.add('active');
            } else {
                document.querySelector(`.inner ul li a[href="#${id}"]`).classList.remove('active');
            }
        })
    }, false);

    const main = parseInt(getComputedStyle(document.body).getPropertyValue('--article-width'), 10);
    const toc = parseInt(getComputedStyle(document.body).getPropertyValue('--toc-width'), 10);
    const gap = parseInt(getComputedStyle(document.body).getPropertyValue('--gap'), 10);

    function checkTocPosition() {
        const width = document.body.scrollWidth;

        if (width - main - (toc * 2) - (gap * 4) > 0) {
            document.getElementById("toc-container").classList.add("wide");
        } else {
            document.getElementById("toc-container").classList.remove("wide");
        }
    }

    function getOffsetTop(element) {
        if (!element.getClientRects().length) {
            return 0;
        }
        let rect = element.getBoundingClientRect();
        let win = element.ownerDocument.defaultView;
        return rect.top + win.pageYOffset;
    }
</script>
        
        <div class="post-content"><h2 id="hw1---vector-space-model">HW1 - Vector Space Model<a hidden class="anchor" aria-hidden="true" href="#hw1---vector-space-model">#</a></h2>
<ol>
<li>TF、IDF計算方式:</li>
</ol>
<p>一開始會讀取document的資料前處理，先去做一些normalized，讓lexicon不要有重複的term，而為了讓程式能在1分鐘內跑完，lexicon使用c++的unordered_map下去存，unordered_map使用hash function找到key term，用來尋找及修改object有著極高的效率。有了normalized後的資料，就可以計算每個term在每個檔案中的TF (local)，接著算出每個term的IDF (global)。TF: 該index Term在該Doc下出現的次數。IDF: 該index Term 在所有Doc下出現的文章次數。</p>
<ol start="2">
<li>Document Term Weight、Query Term Weight計算方式:</li>
</ol>
<p>有了TF、IDF之後，就能算出Document Term Weight及Query Term Weight。這裡使用的方法是老師講義中的Scheme3，會有較佳的score。<br>
左為:doc term 右為:query term</p>
<p><img loading="lazy" src="https://i.imgur.com/oaTF3HN.png" alt=""  />
</p>
<ol start="3">
<li>Vector Space Model運作原理及參數調整:</li>
</ol>
<p>利用兩相同長度的向量(doc weight vector、query weight vector)求出cosine-similarity(兩向量之夾角)，此cosine-similarity值就代表ranking，Ranking值的範圍0 ≤ 𝑠𝑖𝑚 𝑞, 𝑑𝑗 ≤ 1。Ranking值高代表此doc與query的關聯性更高，排名會比其他ranking低的doc前面。而關於Vector Space Model參數的調整，我在老師的scheme3上進行調整，把query weight constant值改1.5、doc weight constant改2.5，有著較佳的結果。</p>
<h3 id="code">Code<a hidden class="anchor" aria-hidden="true" href="#code">#</a></h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">302
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">303
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">304
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">305
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">306
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">307
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">308
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">309
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">310
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">311
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e"># include &lt;fstream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;string&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;vector&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;iostream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;algorithm&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;io.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;cmath&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;unordered_map&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TermProperty</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> tf[<span style="color:#ae81ff">4190</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> num_of_article_including;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> idf;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// TermProperty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_DOCS 4191.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Dictionary</span> {
</span></span><span style="display:flex;"><span>  string term_name;
</span></span><span style="display:flex;"><span>  string term_in_last_file_name;
</span></span><span style="display:flex;"><span>  TermProperty term_property;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">==</span>(<span style="color:#66d9ef">const</span> Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>term_name <span style="color:#f92672">==</span> p.term_name;
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// bool
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">friend</span> std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> os, Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    os <span style="color:#f92672">&lt;&lt;</span> p.term_name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> os;
</span></span><span style="display:flex;"><span>  } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>  string doc_name;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> all_term_names_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_weight_in_file;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> ranking;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Document
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Query</span> {
</span></span><span style="display:flex;"><span>  string file_name;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> tf;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> term_names;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> term_weights;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Query
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">compare_key</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">operator</span>() (<span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct1, <span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct2) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&gt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&lt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> ( struct1.ranking <span style="color:#f92672">&gt;</span> struct2.ranking );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Doc_Scanner</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    unordered_map<span style="color:#f92672">&lt;</span>string, Dictionary<span style="color:#f92672">&gt;</span> doc_terms_map;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Document<span style="color:#f92672">&gt;</span> all_docs;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> num_file;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Query<span style="color:#f92672">&gt;</span> all_queries;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ReadAllDocuments</span>() {
</span></span><span style="display:flex;"><span>      string doc_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( doc_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( handle <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Read Docs Error. Please check your docs path.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        num_file <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>          string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>          Document document;
</span></span><span style="display:flex;"><span>          document.doc_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>          document.ranking <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          document.all_term_names_in_file <span style="color:#f92672">=</span> read_a_doc_to_dictionary( file_name );
</span></span><span style="display:flex;"><span>          all_docs.push_back( document );
</span></span><span style="display:flex;"><span>          num_file<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info);
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      _findclose( handle );
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// ReadAllDocuments()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalculateDocsTermWeight</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_docs[i].all_term_names_in_file.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( all_docs[i].all_term_names_in_file[j] );
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second; 
</span></span><span style="display:flex;"><span>          doc_term.term_property.idf <span style="color:#f92672">=</span> MAX_NUM_DOCS <span style="color:#f92672">/</span> doc_term.term_property.num_of_article_including;
</span></span><span style="display:flex;"><span>          doc_term.term_property.weight <span style="color:#f92672">=</span> ( doc_term.term_property.tf[i] <span style="color:#f92672">+</span> <span style="color:#ae81ff">2.5</span> ) <span style="color:#f92672">*</span> log10( doc_term.term_property.idf );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_weight_in_file.push_back( doc_term.term_property.weight );
</span></span><span style="display:flex;"><span>          iterator <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// CalculateDocsTermWeight()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalculateEveryQueryFile</span>() {
</span></span><span style="display:flex;"><span>      string query_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( query_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>        calculate_query_term_weight( file_name );
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQuery()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RankEveryQueryFile</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Query,RetrievedDocuments</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_queries.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        query_file <span style="color:#f92672">=</span> all_queries[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_docs.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          all_docs[j].ranking <span style="color:#f92672">=</span> rank_doc( all_docs[j] );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        sort( all_docs.begin(), all_docs.end(), compare_key() );
</span></span><span style="display:flex;"><span>        print_ranking( output_file );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQueryFile()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Query query_file;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> query_weights;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> doc_weights;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">calculate_query_term_weight</span>( string query_file_name ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/&#34;</span> <span style="color:#f92672">+</span> query_file_name;
</span></span><span style="display:flex;"><span>      Query query;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>      query.file_name <span style="color:#f92672">=</span> query_file_name;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( term_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">!=</span> doc_terms_map.end() ) {
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>          weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.5</span> <span style="color:#f92672">*</span> log10( doc_term.term_property.idf );
</span></span><span style="display:flex;"><span>          query.term_weights.push_back( weight );
</span></span><span style="display:flex;"><span>          query.term_names.push_back( term_name );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      all_queries.push_back( query );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// calculate_query_term_weight()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">rank_doc</span>( Document doc ) {
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> temp_query_weights;
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> temp_doc_weights <span style="color:#f92672">=</span> doc.all_term_weight_in_file;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> i;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> doc.all_term_names_in_file.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        temp_query_weights.push_back( <span style="color:#ae81ff">0.0</span> );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> query_file.term_names.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> find( doc.all_term_names_in_file.begin(), doc.all_term_names_in_file.end(), query_file.term_names[i] );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">==</span> doc.all_term_names_in_file.end() ) {
</span></span><span style="display:flex;"><span>          temp_query_weights.push_back( query_file.term_weights[i] );
</span></span><span style="display:flex;"><span>          temp_doc_weights.push_back( <span style="color:#ae81ff">0.0</span> );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">int</span> pos <span style="color:#f92672">=</span> distance( doc.all_term_names_in_file.begin(), iterator );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">double</span> relpace_weight <span style="color:#f92672">=</span> query_file.term_weights[i];
</span></span><span style="display:flex;"><span>          temp_query_weights[pos] <span style="color:#f92672">=</span> relpace_weight;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      query_weights <span style="color:#f92672">=</span> temp_query_weights;
</span></span><span style="display:flex;"><span>      doc_weights <span style="color:#f92672">=</span> temp_doc_weights;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> cosine_similarity();
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// rank_doc()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">cosine_similarity</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// cout &lt;&lt; query_weights.size() &lt;&lt; &#34; &#34; &lt;&lt;  doc_weights.size() &lt;&lt; &#34;\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">double</span> dot <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>, denom_query <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>, denom_doc <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> doc_weights.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        dot <span style="color:#f92672">=</span> dot <span style="color:#f92672">+</span> query_weights[i] <span style="color:#f92672">*</span> doc_weights[i];
</span></span><span style="display:flex;"><span>        denom_query <span style="color:#f92672">=</span> denom_query <span style="color:#f92672">+</span> query_weights[i] <span style="color:#f92672">*</span> query_weights[i];
</span></span><span style="display:flex;"><span>        denom_doc <span style="color:#f92672">=</span> denom_doc <span style="color:#f92672">+</span> doc_weights[i] <span style="color:#f92672">*</span> doc_weights[i];
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// cout &lt;&lt; dot &lt;&lt; &#34; &#34; &lt;&lt; denom_query &lt;&lt; &#34; &#34; &lt;&lt; denom_doc &lt;&lt; &#34;\n&#34;;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">return</span> dot <span style="color:#f92672">/</span> ( sqrt( denom_query ) <span style="color:#f92672">*</span> sqrt( denom_doc ) );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// cosine_similarity()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> <span style="color:#a6e22e">partition</span> ( <span style="color:#66d9ef">int</span> low, <span style="color:#66d9ef">int</span> high ) { 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> pivot <span style="color:#f92672">=</span> all_docs[high].ranking;    <span style="color:#75715e">// pivot 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> ( low <span style="color:#f92672">-</span> <span style="color:#ae81ff">1</span> );   
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> low; j <span style="color:#f92672">&lt;</span> high; j<span style="color:#f92672">++</span>) { 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( all_docs[j].ranking <span style="color:#f92672">&gt;</span> pivot ) {
</span></span><span style="display:flex;"><span>          i<span style="color:#f92672">++</span>;    <span style="color:#75715e">// increment index of smaller element 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          Document doc;
</span></span><span style="display:flex;"><span>          doc <span style="color:#f92672">=</span> all_docs[j];
</span></span><span style="display:flex;"><span>          all_docs[j] <span style="color:#f92672">=</span> all_docs[i];
</span></span><span style="display:flex;"><span>          all_docs[i] <span style="color:#f92672">=</span> doc;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      i<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>      Document doc;
</span></span><span style="display:flex;"><span>      doc <span style="color:#f92672">=</span> all_docs[high];
</span></span><span style="display:flex;"><span>      all_docs[high] <span style="color:#f92672">=</span> all_docs[i];
</span></span><span style="display:flex;"><span>      all_docs[i] <span style="color:#f92672">=</span> doc;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> i; 
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// partition()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">descending_order_document_ranking</span>( <span style="color:#66d9ef">int</span> low, <span style="color:#66d9ef">int</span> high) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> pivot <span style="color:#f92672">=</span> partition( low, high );
</span></span><span style="display:flex;"><span>      descending_order_document_ranking( low, pivot <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> );
</span></span><span style="display:flex;"><span>      descending_order_document_ranking( pivot <span style="color:#f92672">+</span> <span style="color:#ae81ff">1</span>, high );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// descending_order_document_ranking()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">print_ranking</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      string query_name <span style="color:#f92672">=</span> query_file.file_name;
</span></span><span style="display:flex;"><span>      query_name.erase( query_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, query_name.end() );
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> query_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;,&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        string term_name <span style="color:#f92672">=</span> all_docs[i].doc_name;
</span></span><span style="display:flex;"><span>        term_name.erase( term_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, term_name.end() );
</span></span><span style="display:flex;"><span>        output_file <span style="color:#f92672">&lt;&lt;</span> term_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// print_ranking()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> read_a_doc_to_dictionary( string file_name ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/&#34;</span> <span style="color:#f92672">+</span> file_name;
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> term_names;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        term_name <span style="color:#f92672">=</span> add_index_term_to_dictionary( term_name, file_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( term_name <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> ) term_names.push_back( term_name );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_names;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// read_a_doc_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    string <span style="color:#a6e22e">add_index_term_to_dictionary</span>( string term_name, string file_name ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( term_name );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">!=</span> doc_terms_map.end() ) {
</span></span><span style="display:flex;"><span>        Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>        doc_term.term_property.tf[num_file]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( doc_term.term_in_last_file_name <span style="color:#f92672">!=</span> file_name ) {
</span></span><span style="display:flex;"><span>          doc_term.term_property.num_of_article_including<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          doc_term.term_in_last_file_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          term_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        iterator <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        TermProperty term_property;
</span></span><span style="display:flex;"><span>        term_property.tf[num_file] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        term_property.num_of_article_including <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        Dictionary doc_term;
</span></span><span style="display:flex;"><span>        doc_term.term_name <span style="color:#f92672">=</span> term_name;
</span></span><span style="display:flex;"><span>        doc_term.term_in_last_file_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>        doc_term.term_property <span style="color:#f92672">=</span> term_property;
</span></span><span style="display:flex;"><span>        doc_terms_map.insert( make_pair( term_name, doc_term ));
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_name;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// add_index_term_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Doc_Scanner
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start scanning documents.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  Doc_Scanner doc_scanner;
</span></span><span style="display:flex;"><span>  doc_scanner.ReadAllDocuments();
</span></span><span style="display:flex;"><span>  doc_scanner.CalculateDocsTermWeight();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Scanning documents done.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start Calulate Query Weight</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// PrintVector( doc_terms );
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  doc_scanner.CalculateEveryQueryFile();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Calulate Query Weight</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  ofstream output_file( <span style="color:#e6db74">&#34;output_csv.csv&#34;</span> );
</span></span><span style="display:flex;"><span>  doc_scanner.RankEveryQueryFile( output_file );
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Program</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// main()
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hw2---best-match-model">HW2 - Best Match Model<a hidden class="anchor" aria-hidden="true" href="#hw2---best-match-model">#</a></h2>
<ol>
<li>Best Match 25L</li>
</ol>
<p>一開始使用BM25L進行實作，經過多番嘗試參數，發現其值最多只能到0.70多，後改用BM25能獲得較高的數值。而BM25L改善了其long documents的問題，間接避免了overly-penalizing，shift parameter 𝛿 = 0.5能獲得較佳的結果。</p>
<ol start="2">
<li>Best Match 25原理及應用</li>
</ol>
<p><img loading="lazy" src="https://i.imgur.com/NcST33K.png" alt=""  />
</p>
<p>Best Match 25一樣使用了TF 及 IDF，與the vector model不同的是BM25多加了一項document length normalization的principle，且BM25為BM15及BM11的組合，當 b = 0時，為BM15，b = 1時，為BM11，藉由調控b參數來獲得較佳的結果。</p>
<p>做完也發現BM25有著比the vector model更好的表現，需要的運算時間較少且精準度更高(無須做cosine-similarity是一大優勢)，但可調節的參數需要自行設定，且doument length太長時會有精準度較差的表現。</p>
<ol start="3">
<li>Best Match 25參數</li>
</ol>
<p>在程式中第137~ 139行中(RankEveryQueryFile)分別設定了k1、k3及b值，獲得最佳參數為以下值，其中k3是隨意值，因query file中的term，tf(I,q)皆 = 1</p>
<p><img loading="lazy" src="https://i.imgur.com/Kuz4fgi.png" alt=""  />
</p>
<p>K1 = 1.635
b = 0.85
k3 = 1000.0</p>
<p>藍色項: Document Length Normalization 綠色項: Inverse Document Frequency<br>
中間項: Inverse Query Frequency可省略(在HW2中)</p>
<h3 id="code-1">Code<a hidden class="anchor" aria-hidden="true" href="#code-1">#</a></h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e"># include &lt;fstream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;string&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;vector&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;iostream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;algorithm&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;io.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;cmath&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;unordered_map&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TermProperty</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> tf[<span style="color:#ae81ff">4190</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> num_of_article_including;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> idf;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// TermProperty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_DOCS 4191.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Dictionary</span> {
</span></span><span style="display:flex;"><span>  string term_name;
</span></span><span style="display:flex;"><span>  string term_in_last_file_name;
</span></span><span style="display:flex;"><span>  TermProperty term_property;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">==</span>(<span style="color:#66d9ef">const</span> Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>term_name <span style="color:#f92672">==</span> p.term_name;
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// bool
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">friend</span> std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> os, Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    os <span style="color:#f92672">&lt;&lt;</span> p.term_name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> os;
</span></span><span style="display:flex;"><span>  } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>  string doc_name;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> doc_length;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> all_term_names_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_tf_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_ni_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_weight_in_file;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> ranking;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Document
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Query</span> {
</span></span><span style="display:flex;"><span>  string file_name;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> tf;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> term_names;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> term_weights;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Query
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">compare_key</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">operator</span>() (<span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct1, <span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct2) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&gt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&lt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> ( struct1.ranking <span style="color:#f92672">&gt;</span> struct2.ranking );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Doc_Scanner</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    unordered_map<span style="color:#f92672">&lt;</span>string, Dictionary<span style="color:#f92672">&gt;</span> doc_terms_map;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Document<span style="color:#f92672">&gt;</span> all_docs;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">float</span> avg_doclen;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> num_file;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Query<span style="color:#f92672">&gt;</span> all_queries;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ReadAllDocuments</span>() {
</span></span><span style="display:flex;"><span>      string doc_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( doc_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">float</span> doc_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      avg_doclen <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( handle <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Read Docs Error. Please check your docs path.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        num_file <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>          string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>          Document document;
</span></span><span style="display:flex;"><span>          document.doc_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>          document.ranking <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          document.all_term_names_in_file <span style="color:#f92672">=</span> read_a_doc_to_dictionary( file_name, doc_length );
</span></span><span style="display:flex;"><span>          document.doc_length <span style="color:#f92672">=</span> doc_length;
</span></span><span style="display:flex;"><span>          avg_doclen <span style="color:#f92672">+=</span> doc_length;
</span></span><span style="display:flex;"><span>          all_docs.push_back( document );
</span></span><span style="display:flex;"><span>          num_file<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info);
</span></span><span style="display:flex;"><span>          doc_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      avg_doclen <span style="color:#f92672">=</span> avg_doclen <span style="color:#f92672">/</span> MAX_NUM_DOCS;
</span></span><span style="display:flex;"><span>      _findclose( handle );
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// ReadAllDocuments()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalculateDocsTermWeight</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_docs[i].all_term_names_in_file.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( all_docs[i].all_term_names_in_file[j] );
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second; 
</span></span><span style="display:flex;"><span>          doc_term.term_property.idf <span style="color:#f92672">=</span> MAX_NUM_DOCS <span style="color:#f92672">/</span> doc_term.term_property.num_of_article_including;
</span></span><span style="display:flex;"><span>          doc_term.term_property.weight <span style="color:#f92672">=</span> ( doc_term.term_property.tf[i] <span style="color:#f92672">+</span> <span style="color:#ae81ff">2.5</span> ) <span style="color:#f92672">*</span> log10( doc_term.term_property.idf );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_tf_in_file.push_back( doc_term.term_property.tf[i] );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_ni_in_file.push_back( doc_term.term_property.num_of_article_including );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_weight_in_file.push_back( doc_term.term_property.weight );
</span></span><span style="display:flex;"><span>          iterator <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// CalculateDocsTermWeight()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalculateEveryQueryFile</span>() {
</span></span><span style="display:flex;"><span>      string query_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( query_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>        calculate_query_term_weight( file_name );
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQuery()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RankEveryQueryFile</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Query,RetrievedDocuments</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      k1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.635</span>;
</span></span><span style="display:flex;"><span>      b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.85</span>;
</span></span><span style="display:flex;"><span>      k3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_queries.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        query_file <span style="color:#f92672">=</span> all_queries[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_docs.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          all_docs[j].ranking <span style="color:#f92672">=</span> rank_doc_BM25( all_docs[j] );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        sort( all_docs.begin(), all_docs.end(), compare_key() );
</span></span><span style="display:flex;"><span>        output_ranking( output_file );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQueryFile()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Query query_file;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> query_weights;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> doc_weights;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> k1, b, k3;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">calculate_query_term_weight</span>( string query_file_name ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/&#34;</span> <span style="color:#f92672">+</span> query_file_name;
</span></span><span style="display:flex;"><span>      Query query;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>      query.file_name <span style="color:#f92672">=</span> query_file_name;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( term_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">!=</span> doc_terms_map.end() ) {
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>          weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.5</span> <span style="color:#f92672">*</span> log10( doc_term.term_property.idf );
</span></span><span style="display:flex;"><span>          query.term_weights.push_back( weight );
</span></span><span style="display:flex;"><span>          query.term_names.push_back( term_name );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      all_queries.push_back( query );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// calculate_query_term_weight()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">rank_doc_BM25</span>( Document doc ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> doc_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>, doc_temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> query_file.term_names.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> find( doc.all_term_names_in_file.begin(), doc.all_term_names_in_file.end(), query_file.term_names[i] );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( it <span style="color:#f92672">!=</span> doc.all_term_names_in_file.end() ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">int</span> pos <span style="color:#f92672">=</span> it <span style="color:#f92672">-</span> doc.all_term_names_in_file.begin();
</span></span><span style="display:flex;"><span>          doc_temp <span style="color:#f92672">=</span> ( ( ( k1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) <span style="color:#f92672">*</span> doc.all_term_tf_in_file[pos] ) <span style="color:#f92672">/</span> ( k1 <span style="color:#f92672">*</span> ( ( <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> b) <span style="color:#f92672">+</span> b <span style="color:#f92672">*</span> ( doc.doc_length <span style="color:#f92672">/</span> avg_doclen ) ) <span style="color:#f92672">+</span> doc.all_term_tf_in_file[pos] ) );
</span></span><span style="display:flex;"><span>          doc_temp <span style="color:#f92672">=</span> doc_temp <span style="color:#f92672">*</span> ( ( k3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> ( k3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( query_file.term_names[i] );
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second; 
</span></span><span style="display:flex;"><span>          doc_temp <span style="color:#f92672">=</span> doc_temp <span style="color:#f92672">*</span> log10( ( MAX_NUM_DOCS <span style="color:#f92672">-</span> doc_term.term_property.num_of_article_including <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span> ) <span style="color:#f92672">/</span> ( doc_term.term_property.num_of_article_including <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span> ) );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">+</span> doc_temp;
</span></span><span style="display:flex;"><span>        doc_temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> doc_score;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// rank_doc_BM25()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">output_ranking</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      string query_name <span style="color:#f92672">=</span> query_file.file_name;
</span></span><span style="display:flex;"><span>      query_name.erase( query_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, query_name.end() );
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> query_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;,&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        string term_name <span style="color:#f92672">=</span> all_docs[i].doc_name;
</span></span><span style="display:flex;"><span>        term_name.erase( term_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, term_name.end() );
</span></span><span style="display:flex;"><span>        output_file <span style="color:#f92672">&lt;&lt;</span> term_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// output_ranking()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> read_a_doc_to_dictionary( string file_name, <span style="color:#66d9ef">float</span> <span style="color:#f92672">&amp;</span> doc_length ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/&#34;</span> <span style="color:#f92672">+</span> file_name;
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> term_names;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        doc_length<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        term_name <span style="color:#f92672">=</span> add_index_term_to_dictionary( term_name, file_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( term_name <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> ) term_names.push_back( term_name );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_names;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// read_a_doc_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    string <span style="color:#a6e22e">add_index_term_to_dictionary</span>( string term_name, string file_name ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( term_name );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">!=</span> doc_terms_map.end() ) {
</span></span><span style="display:flex;"><span>        Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>        doc_term.term_property.tf[num_file]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( doc_term.term_in_last_file_name <span style="color:#f92672">!=</span> file_name ) {
</span></span><span style="display:flex;"><span>          doc_term.term_property.num_of_article_including<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          doc_term.term_in_last_file_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          term_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        iterator <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        TermProperty term_property;
</span></span><span style="display:flex;"><span>        term_property.tf[num_file] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        term_property.num_of_article_including <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        Dictionary doc_term;
</span></span><span style="display:flex;"><span>        doc_term.term_name <span style="color:#f92672">=</span> term_name;
</span></span><span style="display:flex;"><span>        doc_term.term_in_last_file_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>        doc_term.term_property <span style="color:#f92672">=</span> term_property;
</span></span><span style="display:flex;"><span>        doc_terms_map.insert( make_pair( term_name, doc_term ));
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_name;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// add_index_term_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Doc_Scanner
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start scanning documents.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  Doc_Scanner doc_scanner;
</span></span><span style="display:flex;"><span>  doc_scanner.ReadAllDocuments();
</span></span><span style="display:flex;"><span>  doc_scanner.CalculateDocsTermWeight();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Scanning documents done.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start Calulate Query Weight</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// PrintVector( doc_terms );
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  doc_scanner.CalculateEveryQueryFile();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Calulate Query Weight</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  ofstream output_file( <span style="color:#e6db74">&#34;output_csv.csv&#34;</span> );
</span></span><span style="display:flex;"><span>  doc_scanner.RankEveryQueryFile( output_file );
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Program</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// main()
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hw3---mean-average-precision-map">HW3 - Mean Average Precision (MAP)<a hidden class="anchor" aria-hidden="true" href="#hw3---mean-average-precision-map">#</a></h2>
<h3 id="code-2">Code<a hidden class="anchor" aria-hidden="true" href="#code-2">#</a></h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e"># include &lt;fstream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;string&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;vector&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;iostream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;algorithm&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;io.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;cmath&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;unordered_map&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TermProperty</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> tf[<span style="color:#ae81ff">14954</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> num_of_article_including;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> idf;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// TermProperty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_DOCS 14955.000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Dictionary</span> {
</span></span><span style="display:flex;"><span>  string term_name;
</span></span><span style="display:flex;"><span>  string term_in_last_file_name;
</span></span><span style="display:flex;"><span>  TermProperty term_property;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">==</span>(<span style="color:#66d9ef">const</span> Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>term_name <span style="color:#f92672">==</span> p.term_name;
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// bool
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">friend</span> std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> os, Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    os <span style="color:#f92672">&lt;&lt;</span> p.term_name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> os;
</span></span><span style="display:flex;"><span>  } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>  string doc_name;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> doc_length;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> all_term_names_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_tf_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_ni_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_weight_in_file;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> ranking;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Document
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Query</span> {
</span></span><span style="display:flex;"><span>  string file_name;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> tf;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> term_names;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> term_weights;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Query
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">compare_key</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">operator</span>() (<span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct1, <span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct2) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&gt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&lt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> ( struct1.ranking <span style="color:#f92672">&gt;</span> struct2.ranking );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Doc_Scanner</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    unordered_map<span style="color:#f92672">&lt;</span>string, Dictionary<span style="color:#f92672">&gt;</span> doc_terms_map;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Document<span style="color:#f92672">&gt;</span> all_docs;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> avg_doclen;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> num_file;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Query<span style="color:#f92672">&gt;</span> all_queries;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ReadAllDocuments</span>() {
</span></span><span style="display:flex;"><span>      string doc_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( doc_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">float</span> doc_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      avg_doclen <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( handle <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Read Docs Error. Please check your docs path.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        num_file <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>          string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>          Document document;
</span></span><span style="display:flex;"><span>          document.doc_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>          document.ranking <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          document.all_term_names_in_file <span style="color:#f92672">=</span> read_a_doc_to_dictionary( file_name, doc_length );
</span></span><span style="display:flex;"><span>          document.doc_length <span style="color:#f92672">=</span> doc_length;
</span></span><span style="display:flex;"><span>          avg_doclen <span style="color:#f92672">=</span> avg_doclen <span style="color:#f92672">+</span> doc_length;
</span></span><span style="display:flex;"><span>          all_docs.push_back( document );
</span></span><span style="display:flex;"><span>          num_file<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info);
</span></span><span style="display:flex;"><span>          doc_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      avg_doclen <span style="color:#f92672">=</span> avg_doclen <span style="color:#f92672">/</span> MAX_NUM_DOCS;
</span></span><span style="display:flex;"><span>      _findclose( handle );
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// ReadAllDocuments()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalculateDocsTermWeight</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_docs[i].all_term_names_in_file.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( all_docs[i].all_term_names_in_file[j] );
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second; 
</span></span><span style="display:flex;"><span>          doc_term.term_property.idf <span style="color:#f92672">=</span> MAX_NUM_DOCS <span style="color:#f92672">/</span> doc_term.term_property.num_of_article_including;
</span></span><span style="display:flex;"><span>          doc_term.term_property.weight <span style="color:#f92672">=</span> ( doc_term.term_property.tf[i] ) <span style="color:#f92672">*</span> log10( doc_term.term_property.idf );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_tf_in_file.push_back( doc_term.term_property.tf[i] );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_ni_in_file.push_back( doc_term.term_property.num_of_article_including );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_weight_in_file.push_back( doc_term.term_property.weight );
</span></span><span style="display:flex;"><span>          iterator <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// CalculateDocsTermWeight()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalculateEveryQueryFile</span>() {
</span></span><span style="display:flex;"><span>      string query_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( query_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>        calculate_query_term_weight( file_name );
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQuery()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RankEveryQueryFile</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Query,RetrievedDocuments</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      k1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.4</span>;
</span></span><span style="display:flex;"><span>      b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>      q <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.4</span>;
</span></span><span style="display:flex;"><span>      k3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_queries.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        query_file <span style="color:#f92672">=</span> all_queries[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_docs.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          all_docs[j].ranking <span style="color:#f92672">=</span> rank_doc_BM25( all_docs[j] );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        sort( all_docs.begin(), all_docs.end(), compare_key() );
</span></span><span style="display:flex;"><span>        output_ranking( output_file );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQueryFile()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Query query_file;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> query_weights;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> doc_weights;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> k1, b, k3, q;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">calculate_query_term_weight</span>( string query_file_name ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/&#34;</span> <span style="color:#f92672">+</span> query_file_name;
</span></span><span style="display:flex;"><span>      Query query;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>      query.file_name <span style="color:#f92672">=</span> query_file_name;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( term_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">!=</span> doc_terms_map.end() ) {
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>          weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.5</span> <span style="color:#f92672">*</span> log10( doc_term.term_property.idf );
</span></span><span style="display:flex;"><span>          query.term_weights.push_back( weight );
</span></span><span style="display:flex;"><span>          query.term_names.push_back( term_name );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      all_queries.push_back( query );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// calculate_query_term_weight()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">rank_doc_BM25</span>( Document doc ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> doc_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>, doc_temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> query_file.term_names.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> find( doc.all_term_names_in_file.begin(), doc.all_term_names_in_file.end(), query_file.term_names[i] );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( it <span style="color:#f92672">!=</span> doc.all_term_names_in_file.end() ) { 
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">int</span> pos <span style="color:#f92672">=</span> it <span style="color:#f92672">-</span> doc.all_term_names_in_file.begin();
</span></span><span style="display:flex;"><span>          doc_temp <span style="color:#f92672">=</span> doc.all_term_tf_in_file[pos] <span style="color:#f92672">/</span>  ( ( <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> b ) <span style="color:#f92672">+</span> b <span style="color:#f92672">*</span> ( doc.doc_length <span style="color:#f92672">/</span> avg_doclen ) );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( doc_temp <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> ) {
</span></span><span style="display:flex;"><span>            doc_temp <span style="color:#f92672">=</span> ( ( k1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) <span style="color:#f92672">*</span> ( doc_temp <span style="color:#f92672">+</span> q ) ) <span style="color:#f92672">/</span> ( k1 <span style="color:#f92672">+</span> doc_temp <span style="color:#f92672">+</span> q );
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            doc_temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">+</span> doc_temp;
</span></span><span style="display:flex;"><span>          doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">*</span> ( ( k3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> ( k3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( query_file.term_names[i] );
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second; 
</span></span><span style="display:flex;"><span>          doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">*</span> log10( ( MAX_NUM_DOCS <span style="color:#f92672">-</span> doc_term.term_property.num_of_article_including <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span> ) <span style="color:#f92672">/</span> ( doc_term.term_property.num_of_article_including <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span> ) );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">+</span> doc_temp;
</span></span><span style="display:flex;"><span>        doc_temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> doc_score;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// rank_doc_BM25()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">output_ranking</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      string query_name <span style="color:#f92672">=</span> query_file.file_name;
</span></span><span style="display:flex;"><span>      query_name.erase( query_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, query_name.end() );
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> query_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;,&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        string term_name <span style="color:#f92672">=</span> all_docs[i].doc_name;
</span></span><span style="display:flex;"><span>        term_name.erase( term_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, term_name.end() );
</span></span><span style="display:flex;"><span>        output_file <span style="color:#f92672">&lt;&lt;</span> term_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// output_ranking()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> read_a_doc_to_dictionary( string file_name, <span style="color:#66d9ef">float</span> <span style="color:#f92672">&amp;</span> doc_length ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/&#34;</span> <span style="color:#f92672">+</span> file_name;
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> term_names;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        doc_length<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        term_name <span style="color:#f92672">=</span> add_index_term_to_dictionary( term_name, file_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( term_name <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> ) term_names.push_back( term_name );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_names;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// read_a_doc_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    string <span style="color:#a6e22e">add_index_term_to_dictionary</span>( string term_name, string file_name ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( term_name );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">!=</span> doc_terms_map.end() ) {
</span></span><span style="display:flex;"><span>        Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>        doc_term.term_property.tf[num_file]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( doc_term.term_in_last_file_name <span style="color:#f92672">!=</span> file_name ) {
</span></span><span style="display:flex;"><span>          doc_term.term_property.num_of_article_including<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          doc_term.term_in_last_file_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          term_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        iterator <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        TermProperty term_property;
</span></span><span style="display:flex;"><span>        term_property.tf[num_file] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        term_property.num_of_article_including <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        Dictionary doc_term;
</span></span><span style="display:flex;"><span>        doc_term.term_name <span style="color:#f92672">=</span> term_name;
</span></span><span style="display:flex;"><span>        doc_term.term_in_last_file_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>        doc_term.term_property <span style="color:#f92672">=</span> term_property;
</span></span><span style="display:flex;"><span>        doc_terms_map.insert( make_pair( term_name, doc_term ));
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_name;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// add_index_term_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Doc_Scanner
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start scanning documents.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  Doc_Scanner doc_scanner;
</span></span><span style="display:flex;"><span>  doc_scanner.ReadAllDocuments();
</span></span><span style="display:flex;"><span>  doc_scanner.CalculateDocsTermWeight();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Scanning documents done.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start Calulate Query Weight</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// PrintVector( doc_terms );
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  doc_scanner.CalculateEveryQueryFile();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Calulate Query Weight</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  ofstream output_file( <span style="color:#e6db74">&#34;output_csv.csv&#34;</span> );
</span></span><span style="display:flex;"><span>  doc_scanner.RankEveryQueryFile( output_file );
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Program</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// main()
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hw4---plsa-model">HW4 - PLSA Model<a hidden class="anchor" aria-hidden="true" href="#hw4---plsa-model">#</a></h2>
<ol>
<li>PLSA參數調法</li>
</ol>
<p>Topic_num: 8 / a (第一項local TF機率term = 0.6) all_doc使用vector存local tf<br>
b (第二項gobal TF機率term = 0.25) / Inter_run: 30 dictionary使用map存word與position、global TF存</p>
<ol start="2">
<li>PLSA理論心得</li>
</ol>
<p>EM可求得隱含變量T(k)，加入了Pd_z[z][m]、Pw_z[z][w]讓其隨機初始值和為1。
透過每個TOPIC下對於Pd_z[z][m] (每一份DOC(m)下是TOPIC(z)主題之機率)與 Pw_z[z][w] (每一份TOPIC(z)下term(w)之機率)，利用兩者獨立機率反覆對Pz_dw[z][m][position]進行更新。</p>
<ol start="3">
<li>PLSA實作心得</li>
</ol>
<p>程式流程為scanning documetns➡ Init Parameter ( two for m-step、one for e-step) ➡ Run EM for 30 runs ➡ calculate for every query file and log prob</p>
<p>In step 1: 存取所有doc並記錄local、global TF到對應容器中</p>
<p>In step 2: C++需要new出memory space for these parameters.</p>
<p>In step 3: 每run完一次EM完，就會得到更新的Pd_z[z][m]、Pw_z[z][w] for m-step，利用這兩個又繼續更新Pz_dw[z][m][position] for e-step，訓練到接近收斂</p>
<p>In step 4: 與query file中term進行計算，得出每個doc對應query之機率並取log以大排到小輸出。</p>
<p>選用最小Topic(8)的情況底下跑了30 run，需要非常久的時間，雖然在map上已選用unordered_map最快的容器下去實作，但時間還是花得比想像中多，在猜想的原因是因為某些可以使用map下去做映射term index的部分，比起vector中的find速度會快上不少，這次的model比起以往需要更多的時間下去完成試驗，下次的作業應提早開始準備，這樣才有更多時間進行測試。</p>
<h3 id="code-3">Code<a hidden class="anchor" aria-hidden="true" href="#code-3">#</a></h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">302
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">303
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">304
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">305
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">306
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">307
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">308
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">309
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">310
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">311
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">312
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">313
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">314
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">315
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">316
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">317
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">318
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">319
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">320
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">321
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">322
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">323
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">324
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">325
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">326
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">327
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">328
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">329
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">330
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">331
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">332
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">333
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">334
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">335
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">336
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">337
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">338
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">339
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">340
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">341
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">342
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">343
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">344
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">345
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">346
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">347
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">348
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">349
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">350
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">351
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">352
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">353
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">354
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">355
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">356
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">357
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">358
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">359
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">360
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">361
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">362
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">363
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">364
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">365
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">366
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">367
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">368
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">369
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">370
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">371
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">372
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">373
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">374
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">375
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">376
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">377
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">378
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">379
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">380
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">381
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">382
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">383
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">384
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">385
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">386
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">387
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">388
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">389
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">390
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">391
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">392
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">393
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">394
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">395
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">396
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">397
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">398
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">399
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">400
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">401
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">402
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">403
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">404
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">405
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">406
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">407
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">408
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">409
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">410
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">411
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">412
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">413
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">414
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">415
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">416
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">417
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">418
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">419
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">420
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">421
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">422
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">423
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">424
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">425
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">426
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">427
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">428
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">429
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">430
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">431
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">432
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">433
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">434
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">435
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">436
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">437
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">438
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">439
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">440
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">441
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">442
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">443
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">444
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">445
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">446
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">447
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">448
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">449
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">450
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">451
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">452
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e"># include &lt;fstream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;string&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;vector&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;iostream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;algorithm&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;io.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;cmath&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;unordered_map&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;cstdlib&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;stdlib.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;ctime&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_DOC 14955.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_QUERY 100.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_TOPIC 8.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_ITER 30.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_LENGTH 7059938.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_WORDS 111449.0
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TermProperty</span> {
</span></span><span style="display:flex;"><span>  string term_name;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> tf;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> prob; <span style="color:#75715e">// probability ( first or third term )
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>}; <span style="color:#75715e">// TermProperty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> docID;
</span></span><span style="display:flex;"><span>  string doc_name;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> ranking;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> doc_length;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>TermProperty<span style="color:#f92672">&gt;</span> term_properties;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Documentc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Word2doc</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> docID;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> position;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Word2doc
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Dictionary</span> {
</span></span><span style="display:flex;"><span>  TermProperty term_property;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>Word2doc<span style="color:#f92672">&gt;</span> word2doc;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> word2dic;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">==</span>(<span style="color:#66d9ef">const</span> Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>term_property.term_name <span style="color:#f92672">==</span> p.term_property.term_name;
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// bool
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">friend</span> std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> os, Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    os <span style="color:#f92672">&lt;&lt;</span> p.term_property.term_name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> os;
</span></span><span style="display:flex;"><span>  } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">compare_key</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">operator</span>() (<span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct1, <span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct2) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&gt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&lt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> ( struct1.ranking <span style="color:#f92672">&gt;</span> struct2.ranking );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">PLSA</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    unordered_map<span style="color:#f92672">&lt;</span>string, Dictionary<span style="color:#f92672">&gt;</span> dictionary;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Document<span style="color:#f92672">&gt;</span> all_docs;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> all_words;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> num_file;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> all_docs_len;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ReadAllDocuments</span>() {
</span></span><span style="display:flex;"><span>      all_docs_len <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      string doc_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( doc_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> doc_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( handle <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Read Docs Error. Please check your docs path.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        num_file <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>          string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>          Document document;
</span></span><span style="display:flex;"><span>          document.doc_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>          document.ranking <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          document.term_properties <span style="color:#f92672">=</span> read_a_doc_to_dictionary( file_name, doc_length );
</span></span><span style="display:flex;"><span>          document.doc_length <span style="color:#f92672">=</span> doc_length;
</span></span><span style="display:flex;"><span>          document.docID <span style="color:#f92672">=</span> num_file;
</span></span><span style="display:flex;"><span>          all_docs_len <span style="color:#f92672">+=</span> doc_length;
</span></span><span style="display:flex;"><span>          all_docs.push_back( document );
</span></span><span style="display:flex;"><span>          num_file<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          doc_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>          k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info);
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      _findclose( handle );
</span></span><span style="display:flex;"><span>      
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// ReadAllDocuments()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Init</span>() {
</span></span><span style="display:flex;"><span>      num_data <span style="color:#f92672">=</span> MAX_NUM_DOC;
</span></span><span style="display:flex;"><span>      num_words <span style="color:#f92672">=</span> MAX_NUM_WORDS;
</span></span><span style="display:flex;"><span>      num_topics <span style="color:#f92672">=</span> MAX_NUM_TOPIC;
</span></span><span style="display:flex;"><span>      srand(time(NULL));    <span style="color:#75715e">//設置随機數種子，使每次獲取的随機序列不同。
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      Pd_z  <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">double</span><span style="color:#f92672">*</span>[num_topics<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> norm_down <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        Pd_z[z] <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">double</span>[num_data<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; m <span style="color:#f92672">&lt;</span> num_data; m<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          Pd_z[z][m] <span style="color:#f92672">=</span> (rand()<span style="color:#f92672">%</span><span style="color:#ae81ff">100000</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">0.00001</span>;
</span></span><span style="display:flex;"><span>          norm_down <span style="color:#f92672">+=</span> Pd_z[z][m];
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; m <span style="color:#f92672">&lt;</span> num_data; m<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          Pd_z[z][m] <span style="color:#f92672">/=</span> norm_down;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Init step1 done</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      Pw_z  <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">double</span><span style="color:#f92672">*</span>[num_topics<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> norm_down <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        Pw_z[z] <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">double</span>[num_words<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> w <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; w <span style="color:#f92672">&lt;</span> num_words; w<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          Pw_z[z][w] <span style="color:#f92672">=</span> (rand()<span style="color:#f92672">%</span><span style="color:#ae81ff">100000</span>)<span style="color:#f92672">*</span><span style="color:#ae81ff">0.00001</span>;
</span></span><span style="display:flex;"><span>          norm_down <span style="color:#f92672">+=</span> Pw_z[z][w];                               
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> w <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; w <span style="color:#f92672">&lt;</span> num_words; w<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          Pw_z[z][w] <span style="color:#f92672">/=</span> norm_down;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Init step2 done</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      Pz_dw <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">double</span> <span style="color:#f92672">**</span>[num_topics<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        Pz_dw[z] <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">double</span> <span style="color:#f92672">*</span>[num_data<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; m <span style="color:#f92672">&lt;</span> num_data; m<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">int</span> size <span style="color:#f92672">=</span> ( <span style="color:#66d9ef">int</span> ) all_docs[m].term_properties.size();
</span></span><span style="display:flex;"><span>          Pz_dw[z][m] <span style="color:#f92672">=</span> <span style="color:#66d9ef">new</span> <span style="color:#66d9ef">double</span>[size<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>];
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Init step3 done</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// Init()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">DoPLSA</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// start training
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> MAX_NUM_ITER; i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        Estep();
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;iteration: Estep: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> i <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        Mstep_1();
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;iteration: Mstep_1: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> i <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        Mstep_2();
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;iteration: Mstep_2: &#34;</span> <span style="color:#f92672">&lt;&lt;</span> i <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;   
</span></span><span style="display:flex;"><span>        system( <span style="color:#e6db74">&#34;pause&#34;</span> );     
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// DoPLSA()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RankEveryQueryFile</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      a <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.6</span>;
</span></span><span style="display:flex;"><span>      b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.25</span>;
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Query,RetrievedDocuments</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      string query_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( query_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>        calculate_query_prob( file_name );
</span></span><span style="display:flex;"><span>        sort( all_docs.begin(), all_docs.end(), compare_key() );
</span></span><span style="display:flex;"><span>        output_ranking( output_file, file_name );
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQueryFile() 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> num_data; <span style="color:#75715e">// number of data
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> num_words; <span style="color:#75715e">// number of words
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">int</span> num_topics; <span style="color:#75715e">// number of topics
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    <span style="color:#66d9ef">double</span> a, b;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#f92672">**</span>Pd_z <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#f92672">**</span>Pw_z <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#f92672">***</span>Pz_dw <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#f92672">**</span>Dw_m <span style="color:#f92672">=</span> NULL;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>TermProperty<span style="color:#f92672">&gt;</span> read_a_doc_to_dictionary( string file_name, <span style="color:#66d9ef">double</span> <span style="color:#f92672">&amp;</span> doc_length ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/&#34;</span> <span style="color:#f92672">+</span> file_name;
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span>TermProperty<span style="color:#f92672">&gt;</span> term_properties;
</span></span><span style="display:flex;"><span>      TermProperty term_property;
</span></span><span style="display:flex;"><span>      Word2doc word2doc;
</span></span><span style="display:flex;"><span>      Dictionary doc_term;
</span></span><span style="display:flex;"><span>      unordered_map<span style="color:#f92672">&lt;</span>string, <span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> doc2dic;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> position <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        doc_length<span style="color:#f92672">++</span>; 
</span></span><span style="display:flex;"><span>        term_property.term_name <span style="color:#f92672">=</span> term_name; 
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> it_dic <span style="color:#f92672">=</span> dictionary.find( term_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( it_dic <span style="color:#f92672">!=</span> dictionary.end() ) {
</span></span><span style="display:flex;"><span>          doc_term <span style="color:#f92672">=</span> it_dic <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>          doc_term.term_property.tf<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          doc_term.term_property.prob <span style="color:#f92672">=</span> doc_term.term_property.tf <span style="color:#f92672">/</span> MAX_LENGTH;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( doc_term.word2doc[doc_term.word2doc.size()<span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>].docID <span style="color:#f92672">!=</span> num_file ) {
</span></span><span style="display:flex;"><span>            word2doc.docID <span style="color:#f92672">=</span> num_file;
</span></span><span style="display:flex;"><span>            word2doc.position <span style="color:#f92672">=</span> position;
</span></span><span style="display:flex;"><span>            doc_term.word2doc.push_back( word2doc );
</span></span><span style="display:flex;"><span>            term_property.tf <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>            term_properties.push_back(term_property);
</span></span><span style="display:flex;"><span>            doc2dic.insert(make_pair(term_name, position));
</span></span><span style="display:flex;"><span>            position<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> doc2dic.find( term_name );
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> pos <span style="color:#f92672">=</span> it <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>            term_properties[pos].tf<span style="color:#f92672">++</span>;              
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          it_dic <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          term_property.tf <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          term_property.prob <span style="color:#f92672">=</span> term_property.tf <span style="color:#f92672">/</span> MAX_LENGTH;
</span></span><span style="display:flex;"><span>          word2doc.docID <span style="color:#f92672">=</span> num_file;
</span></span><span style="display:flex;"><span>          word2doc.position <span style="color:#f92672">=</span> position;
</span></span><span style="display:flex;"><span>          doc_term.term_property <span style="color:#f92672">=</span> term_property;
</span></span><span style="display:flex;"><span>          doc_term.word2doc.push_back( word2doc );
</span></span><span style="display:flex;"><span>          doc_term.word2dic <span style="color:#f92672">=</span> all_words.size();
</span></span><span style="display:flex;"><span>          all_words.push_back( term_name );
</span></span><span style="display:flex;"><span>          dictionary.insert( make_pair( term_name, doc_term ));
</span></span><span style="display:flex;"><span>          position<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          term_properties.push_back(term_property);
</span></span><span style="display:flex;"><span>          doc2dic.insert(make_pair(term_name, position));
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> (<span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> term_properties.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        term_properties[i].prob <span style="color:#f92672">=</span> term_properties[i].tf <span style="color:#f92672">/</span> doc_length;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_properties;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// read_a_doc_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Estep</span>() {
</span></span><span style="display:flex;"><span>      cout <span style="color:#f92672">&lt;&lt;</span> all_docs.size() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">&lt;&lt;</span> num_data <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; m <span style="color:#f92672">&lt;</span> num_data; m<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> position <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; position <span style="color:#f92672">&lt;</span> all_docs[m].term_properties.size(); position<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">double</span> norm_down <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> it_dic <span style="color:#f92672">=</span> dictionary.find( all_docs[m].term_properties[position].term_name );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( it_dic <span style="color:#f92672">==</span> dictionary.end() ) cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;cry</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">int</span> w <span style="color:#f92672">=</span> it_dic <span style="color:#f92672">-&gt;</span> second.word2dic;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">double</span> val <span style="color:#f92672">=</span> Pd_z[z][m] <span style="color:#f92672">*</span> Pw_z[z][w];
</span></span><span style="display:flex;"><span>            Pz_dw[z][m][position] <span style="color:#f92672">=</span> val;
</span></span><span style="display:flex;"><span>            norm_down <span style="color:#f92672">+=</span> val;
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( norm_down <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0.0</span> ) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>              Pz_dw[z][m][position] <span style="color:#f92672">/=</span> norm_down;
</span></span><span style="display:flex;"><span>            } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>              Pz_dw[z][m][position] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>            } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( m <span style="color:#f92672">&gt;=</span> <span style="color:#ae81ff">14950</span> ) {
</span></span><span style="display:flex;"><span>          cout <span style="color:#f92672">&lt;&lt;</span> all_docs[m].doc_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span> <span style="color:#f92672">&lt;&lt;</span> all_docs[m].term_properties.size() <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; qq1</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>    
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// Estep()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Mstep_1</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Pd_z[z][m]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> norm_down <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; m <span style="color:#f92672">&lt;</span> num_data; m<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">double</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> position <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; position <span style="color:#f92672">&lt;</span> all_docs[m].term_properties.size(); position<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> dictionary.find( all_docs[m].term_properties[position].term_name );
</span></span><span style="display:flex;"><span>            sum <span style="color:#f92672">+=</span> it <span style="color:#f92672">-&gt;</span> second.term_property.tf <span style="color:#f92672">*</span> Pz_dw[z][m][position];
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          Pd_z[z][m] <span style="color:#f92672">=</span> sum;
</span></span><span style="display:flex;"><span>          norm_down <span style="color:#f92672">+=</span> sum;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( norm_down <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; m <span style="color:#f92672">&lt;</span> num_data; m<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            Pd_z[z][m] <span style="color:#f92672">/=</span> norm_down;
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; m <span style="color:#f92672">&lt;</span> num_data; m<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>            Pd_z[z][m] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// Mstep_1()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">Mstep_2</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// Pw_z[z][w]
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> norm_down <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> w <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; w <span style="color:#f92672">&lt;</span> num_words; w<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">double</span> sum <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>          string word <span style="color:#f92672">=</span> all_words[w];
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> dictionary.find( word );
</span></span><span style="display:flex;"><span>          vector<span style="color:#f92672">&lt;</span>Word2doc<span style="color:#f92672">&gt;</span> word2docs <span style="color:#f92672">=</span> it <span style="color:#f92672">-&gt;</span> second.word2doc;
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> word2docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> word2docs[i].docID;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">int</span> position <span style="color:#f92672">=</span> word2docs[i].position;
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">auto</span> it_2 <span style="color:#f92672">=</span> dictionary.find( all_docs[m].term_properties[position].term_name );
</span></span><span style="display:flex;"><span>            sum <span style="color:#f92672">+=</span> it_2 <span style="color:#f92672">-&gt;</span> second.term_property.tf <span style="color:#f92672">*</span> Pz_dw[z][m][position];
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          
</span></span><span style="display:flex;"><span>          Pw_z[z][w] <span style="color:#f92672">=</span> sum;
</span></span><span style="display:flex;"><span>          norm_down <span style="color:#f92672">+=</span> sum;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( norm_down <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> w <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; w <span style="color:#f92672">&lt;</span> num_words; w<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            Pw_z[z][w] <span style="color:#f92672">/=</span> norm_down;
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> w <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; w <span style="color:#f92672">&lt;</span> num_words; w<span style="color:#f92672">++</span>) {
</span></span><span style="display:flex;"><span>            Pw_z[z][w] <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// Mstep_2()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">calculate_query_prob</span>( string query_file_name ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/&#34;</span> <span style="color:#f92672">+</span> query_file_name;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> all_query_term;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        all_query_term.push_back( term_name );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">double</span> prob <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_query_term.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          prob <span style="color:#f92672">=</span> prob <span style="color:#f92672">*</span> calculate_term_prob( all_docs[i], all_query_term[j] );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( prob <span style="color:#f92672">==</span> <span style="color:#ae81ff">0.0</span> ) <span style="color:#66d9ef">break</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( prob <span style="color:#f92672">!=</span> <span style="color:#ae81ff">0.0</span> ) prob <span style="color:#f92672">=</span> log10( prob );
</span></span><span style="display:flex;"><span>        all_docs[i].ranking <span style="color:#f92672">=</span> prob;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// calculate_query_prob()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">calculate_term_prob</span>( Document doc, string query_term ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> prob <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>, temp_prob <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">auto</span> it_dic <span style="color:#f92672">=</span> dictionary.find( query_term );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( it_dic <span style="color:#f92672">==</span> dictionary.end() ) <span style="color:#66d9ef">return</span> prob;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> m <span style="color:#f92672">=</span> doc.docID;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> w <span style="color:#f92672">=</span> it_dic <span style="color:#f92672">-&gt;</span> second.word2dic;
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span>TermProperty<span style="color:#f92672">&gt;</span> term_properties <span style="color:#f92672">=</span> doc.term_properties;
</span></span><span style="display:flex;"><span>      TermProperty term_property;
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// first term
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">auto</span> it_doc <span style="color:#f92672">=</span> find_if( term_properties.begin(), term_properties.end(), [query_term] (<span style="color:#66d9ef">const</span> TermProperty<span style="color:#f92672">&amp;</span> s) { <span style="color:#66d9ef">return</span> s.term_name <span style="color:#f92672">==</span> query_term; } );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( it_doc <span style="color:#f92672">!=</span> term_properties.end() ) {
</span></span><span style="display:flex;"><span>        term_property <span style="color:#f92672">=</span> <span style="color:#f92672">*</span>it_doc; 
</span></span><span style="display:flex;"><span>        prob <span style="color:#f92672">+=</span> term_property.prob <span style="color:#f92672">*</span> a;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#75715e">// second term and third term
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> z <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; z <span style="color:#f92672">&lt;</span> num_topics; z<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        temp_prob <span style="color:#f92672">+=</span> Pd_z[z][m] <span style="color:#f92672">*</span> Pw_z[z][w] ;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      prob <span style="color:#f92672">+=</span> temp_prob <span style="color:#f92672">*</span> b;
</span></span><span style="display:flex;"><span>      prob <span style="color:#f92672">+=</span> ( <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">-</span> a <span style="color:#f92672">-</span> b ) <span style="color:#f92672">*</span> it_dic <span style="color:#f92672">-&gt;</span> second.term_property.prob;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> prob;
</span></span><span style="display:flex;"><span>    }  <span style="color:#75715e">// calculate_term_prob()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">output_ranking</span>( ofstream <span style="color:#f92672">&amp;</span> output_file, string query_file ) {
</span></span><span style="display:flex;"><span>      query_file.erase( query_file.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, query_file.end() );
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> query_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;,&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        string term_name <span style="color:#f92672">=</span> all_docs[i].doc_name;
</span></span><span style="display:flex;"><span>        term_name.erase( term_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, term_name.end() );
</span></span><span style="display:flex;"><span>        output_file <span style="color:#f92672">&lt;&lt;</span> term_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// output_ranking()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// PLSA
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start scanning documents.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  PLSA plsa;
</span></span><span style="display:flex;"><span>  plsa.ReadAllDocuments();
</span></span><span style="display:flex;"><span>  system(<span style="color:#e6db74">&#34;pause&#34;</span>);
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Scanning documents done.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start Initing.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  plsa.Init(); 
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Initing.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  plsa.DoPLSA();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Done Training.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  ofstream output_file( <span style="color:#e6db74">&#34;output_csv.csv&#34;</span> );
</span></span><span style="display:flex;"><span>  plsa.RankEveryQueryFile( output_file );
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Program</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;  
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// main()
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hw5---query-modeling-rocchio-algorithm">HW5 - Query Modeling (Rocchio Algorithm)<a hidden class="anchor" aria-hidden="true" href="#hw5---query-modeling-rocchio-algorithm">#</a></h2>
<ol>
<li>Query Modeling (Rocchio Algorithm)參數調法</li>
</ol>
<p>First Information Retrieval: BM25 k1= 0.8 b = 0.7 k3 = 100.0<br>
Second Information Retrieval: VSM<br>
Rocchio algorithm: a = 2.5 b = 0.4 relevant doc = 10 non-relevant doc = 1 (c = 0.1)<br>
如果First Information Retrieval使用PLSA能獲得較高的分數，但需要的memory極大。</p>
<ol start="2">
<li>Query Modeling (Rocchio Algorithm)理論心得</li>
</ol>
<p>由於query所蒐集的資料量太少，導致資料檢索前所獲得的資訊太少，而透過使用Pseudo-Relevance Feedback的過程得到加強後的query term，再進行第二次資料檢索，能獲得較好的結果。Query Modeling利用此核心精神下去實作，而本次實作Pseudo-Relevance Feedback的方法為Rocchio Algorithm。</p>
<ol start="3">
<li>Query Modeling (Rocchio Algorithm)實作心得</li>
</ol>
<p>程式流程為scanning documents ➡ calculate every word TF-IDF ➡Run BM25/PLSA for First IR ➡ using Rocchio for updating new query weight  ➡ Run VSM for Second IR</p>
<p>In step 1、2: 存取所有doc並記錄local、global TF到對應容器中</p>
<p>In step 3: 計算BM25並排序前10篇文章為relevant docs</p>
<p>In step 4:  update query vector on relevant docs , normalize new query weight and add original query weight ( a = 2.5, b =0.4 ) if using non-relevant doc ( c =0.1)<br>
In step 5: normalize every doc weight and do VSM separately.</p>
<p>在實作過程中發現Relevant Doc篇數的設定也會有很大的影響, 不一定多比較好, 太少也可能不行，10~15篇是獲得此資料集較理想的Doc數。而參數b不能設得太大否則會讓new query weight跟original query weight的權重變得模糊，效果不好，最後在統一vector長度時，當分子其中一項為0時可以不算來增加運行速度。</p>
<h3 id="code-4">Code<a hidden class="anchor" aria-hidden="true" href="#code-4">#</a></h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-cpp" data-lang="cpp"><span style="display:flex;"><span><span style="color:#75715e"># include &lt;fstream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;string&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;vector&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;iostream&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;algorithm&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;io.h&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;cmath&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"># include &lt;unordered_map&gt;
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span><span style="color:#66d9ef">using</span> <span style="color:#66d9ef">namespace</span> std;
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">TermProperty</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> tf[<span style="color:#ae81ff">14954</span>] <span style="color:#f92672">=</span> { <span style="color:#ae81ff">0</span> };
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">int</span> num_of_article_including;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> idf;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// TermProperty
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># define MAX_NUM_DOCS 14955.000
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Dictionary</span> {
</span></span><span style="display:flex;"><span>  string term_name;
</span></span><span style="display:flex;"><span>  string term_in_last_file_name;
</span></span><span style="display:flex;"><span>  TermProperty term_property;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">bool</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">==</span>(<span style="color:#66d9ef">const</span> Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">this</span><span style="color:#f92672">-&gt;</span>term_name <span style="color:#f92672">==</span> p.term_name;
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// bool
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">friend</span> std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> <span style="color:#66d9ef">operator</span><span style="color:#f92672">&lt;&lt;</span>(std<span style="color:#f92672">::</span>ostream<span style="color:#f92672">&amp;</span> os, Dictionary<span style="color:#f92672">&amp;</span> p) {
</span></span><span style="display:flex;"><span>    os <span style="color:#f92672">&lt;&lt;</span> p.term_name;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> os;
</span></span><span style="display:flex;"><span>  } 
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Dictionary
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Document</span> {
</span></span><span style="display:flex;"><span>  string doc_name;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">float</span> doc_length;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> all_term_names_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_tf_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_ni_in_file;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> all_term_weight_in_file;
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">double</span> ranking;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Document
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Query</span> {
</span></span><span style="display:flex;"><span>  string file_name;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">int</span><span style="color:#f92672">&gt;</span> tf;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> term_names;
</span></span><span style="display:flex;"><span>  vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> term_weights;
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Query
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">compare_key</span> {
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">inline</span> <span style="color:#66d9ef">bool</span> <span style="color:#a6e22e">operator</span>() (<span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct1, <span style="color:#66d9ef">const</span> Document<span style="color:#f92672">&amp;</span> struct2) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&gt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> <span style="color:#66d9ef">if</span> ( struct1.ranking <span style="color:#f92672">==</span> struct2.ranking <span style="color:#f92672">&amp;&amp;</span> struct1.doc_name <span style="color:#f92672">&lt;</span> struct2.doc_name ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> ( struct1.ranking <span style="color:#f92672">&gt;</span> struct2.ranking );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// 
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>};
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">Doc_Scanner</span> {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">public</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    unordered_map<span style="color:#f92672">&lt;</span>string, Dictionary<span style="color:#f92672">&gt;</span> doc_terms_map;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Document<span style="color:#f92672">&gt;</span> all_docs;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> avg_doclen;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">int</span> num_file;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>Query<span style="color:#f92672">&gt;</span> all_queries;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">ReadAllDocuments</span>() {
</span></span><span style="display:flex;"><span>      string doc_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( doc_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">float</span> doc_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      avg_doclen <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( handle <span style="color:#f92672">==</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Read Docs Error. Please check your docs path.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        num_file <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>          string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>          Document document;
</span></span><span style="display:flex;"><span>          document.doc_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>          document.ranking <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>          document.all_term_names_in_file <span style="color:#f92672">=</span> read_a_doc_to_dictionary( file_name, doc_length );
</span></span><span style="display:flex;"><span>          document.doc_length <span style="color:#f92672">=</span> doc_length;
</span></span><span style="display:flex;"><span>          avg_doclen <span style="color:#f92672">=</span> avg_doclen <span style="color:#f92672">+</span> doc_length;
</span></span><span style="display:flex;"><span>          all_docs.push_back( document );
</span></span><span style="display:flex;"><span>          num_file<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info);
</span></span><span style="display:flex;"><span>          doc_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      avg_doclen <span style="color:#f92672">=</span> avg_doclen <span style="color:#f92672">/</span> MAX_NUM_DOCS;
</span></span><span style="display:flex;"><span>      _findclose( handle );
</span></span><span style="display:flex;"><span>  } <span style="color:#75715e">// ReadAllDocuments()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalculateDocsTermWeight</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> ( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_docs[i].all_term_names_in_file.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( all_docs[i].all_term_names_in_file[j] );
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second; 
</span></span><span style="display:flex;"><span>          doc_term.term_property.idf <span style="color:#f92672">=</span> MAX_NUM_DOCS <span style="color:#f92672">/</span> doc_term.term_property.num_of_article_including;
</span></span><span style="display:flex;"><span>          doc_term.term_property.weight <span style="color:#f92672">=</span> ( doc_term.term_property.tf[i] ) <span style="color:#f92672">*</span> log10( doc_term.term_property.idf );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_tf_in_file.push_back( doc_term.term_property.tf[i] );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_ni_in_file.push_back( doc_term.term_property.num_of_article_including );
</span></span><span style="display:flex;"><span>          all_docs[i].all_term_weight_in_file.push_back( doc_term.term_property.weight );
</span></span><span style="display:flex;"><span>          iterator <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// CalculateDocsTermWeight()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">CalculateEveryQueryFile</span>() {
</span></span><span style="display:flex;"><span>      string query_files_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/*.txt&#34;</span>; 
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">_finddata_t</span> file_info;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> handle <span style="color:#f92672">=</span> _findfirst( query_files_path.c_str(), <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">int</span> k <span style="color:#f92672">=</span> handle;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( k <span style="color:#f92672">!=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">1</span> ) {
</span></span><span style="display:flex;"><span>        string file_name <span style="color:#f92672">=</span> file_info.name;
</span></span><span style="display:flex;"><span>        calculate_query_term_weight( file_name );
</span></span><span style="display:flex;"><span>        k <span style="color:#f92672">=</span> _findnext( handle, <span style="color:#f92672">&amp;</span>file_info );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQuery()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">RankEveryQueryFile</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Query,RetrievedDocuments</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>      k1 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1.4</span>;
</span></span><span style="display:flex;"><span>      b <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.5</span>;
</span></span><span style="display:flex;"><span>      q <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.4</span>;
</span></span><span style="display:flex;"><span>      k3 <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_queries.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        query_file <span style="color:#f92672">=</span> all_queries[i];
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> j <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; j <span style="color:#f92672">&lt;</span> all_docs.size(); j<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>          all_docs[j].ranking <span style="color:#f92672">=</span> rank_doc_BM25( all_docs[j] );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        sort( all_docs.begin(), all_docs.end(), compare_key() );
</span></span><span style="display:flex;"><span>        output_ranking( output_file );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// RankEveryQueryFile()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">private</span><span style="color:#f92672">:</span>
</span></span><span style="display:flex;"><span>    Query query_file;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> query_weights;
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span><span style="color:#66d9ef">double</span><span style="color:#f92672">&gt;</span> doc_weights;
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> k1, b, k3, q;
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">calculate_query_term_weight</span>( string query_file_name ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./queries/&#34;</span> <span style="color:#f92672">+</span> query_file_name;
</span></span><span style="display:flex;"><span>      Query query;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> weight;
</span></span><span style="display:flex;"><span>      query.file_name <span style="color:#f92672">=</span> query_file_name;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( term_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">!=</span> doc_terms_map.end() ) {
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>          weight <span style="color:#f92672">=</span> <span style="color:#ae81ff">2.5</span> <span style="color:#f92672">*</span> log10( doc_term.term_property.idf );
</span></span><span style="display:flex;"><span>          query.term_weights.push_back( weight );
</span></span><span style="display:flex;"><span>          query.term_names.push_back( term_name );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      all_queries.push_back( query );
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// calculate_query_term_weight()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">double</span> <span style="color:#a6e22e">rank_doc_BM25</span>( Document doc ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">double</span> doc_score <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>, doc_temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> query_file.term_names.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">auto</span> it <span style="color:#f92672">=</span> find( doc.all_term_names_in_file.begin(), doc.all_term_names_in_file.end(), query_file.term_names[i] );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( it <span style="color:#f92672">!=</span> doc.all_term_names_in_file.end() ) { 
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">int</span> pos <span style="color:#f92672">=</span> it <span style="color:#f92672">-</span> doc.all_term_names_in_file.begin();
</span></span><span style="display:flex;"><span>          doc_temp <span style="color:#f92672">=</span> doc.all_term_tf_in_file[pos] <span style="color:#f92672">/</span>  ( ( <span style="color:#ae81ff">1</span> <span style="color:#f92672">-</span> b ) <span style="color:#f92672">+</span> b <span style="color:#f92672">*</span> ( doc.doc_length <span style="color:#f92672">/</span> avg_doclen ) );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> ( doc_temp <span style="color:#f92672">&gt;</span> <span style="color:#ae81ff">0</span> ) {
</span></span><span style="display:flex;"><span>            doc_temp <span style="color:#f92672">=</span> ( ( k1 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) <span style="color:#f92672">*</span> ( doc_temp <span style="color:#f92672">+</span> q ) ) <span style="color:#f92672">/</span> ( k1 <span style="color:#f92672">+</span> doc_temp <span style="color:#f92672">+</span> q );
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>          <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>            doc_temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>;
</span></span><span style="display:flex;"><span>          } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>          doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">+</span> doc_temp;
</span></span><span style="display:flex;"><span>          doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">*</span> ( ( k3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) <span style="color:#f92672">*</span> <span style="color:#ae81ff">1.0</span> <span style="color:#f92672">/</span> ( k3 <span style="color:#f92672">+</span> <span style="color:#ae81ff">1.0</span> ) );
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( query_file.term_names[i] );
</span></span><span style="display:flex;"><span>          Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second; 
</span></span><span style="display:flex;"><span>          doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">*</span> log10( ( MAX_NUM_DOCS <span style="color:#f92672">-</span> doc_term.term_property.num_of_article_including <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span> ) <span style="color:#f92672">/</span> ( doc_term.term_property.num_of_article_including <span style="color:#f92672">+</span> <span style="color:#ae81ff">0.5</span> ) );
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        doc_score <span style="color:#f92672">=</span> doc_score <span style="color:#f92672">+</span> doc_temp;
</span></span><span style="display:flex;"><span>        doc_temp <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.0</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> doc_score;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// rank_doc_BM25()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">void</span> <span style="color:#a6e22e">output_ranking</span>( ofstream <span style="color:#f92672">&amp;</span> output_file ) {
</span></span><span style="display:flex;"><span>      string query_name <span style="color:#f92672">=</span> query_file.file_name;
</span></span><span style="display:flex;"><span>      query_name.erase( query_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, query_name.end() );
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> query_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;,&#34;</span>;
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">for</span>( <span style="color:#66d9ef">int</span> i <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>; i <span style="color:#f92672">&lt;</span> all_docs.size(); i<span style="color:#f92672">++</span> ) {
</span></span><span style="display:flex;"><span>        string term_name <span style="color:#f92672">=</span> all_docs[i].doc_name;
</span></span><span style="display:flex;"><span>        term_name.erase( term_name.end() <span style="color:#f92672">-</span><span style="color:#ae81ff">4</span>, term_name.end() );
</span></span><span style="display:flex;"><span>        output_file <span style="color:#f92672">&lt;&lt;</span> term_name <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34; &#34;</span>;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// for
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      output_file <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// output_ranking()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> read_a_doc_to_dictionary( string file_name, <span style="color:#66d9ef">float</span> <span style="color:#f92672">&amp;</span> doc_length ) {
</span></span><span style="display:flex;"><span>      fstream file;
</span></span><span style="display:flex;"><span>      string term_name;
</span></span><span style="display:flex;"><span>      string path_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;./docs/&#34;</span> <span style="color:#f92672">+</span> file_name;
</span></span><span style="display:flex;"><span>      vector<span style="color:#f92672">&lt;</span>string<span style="color:#f92672">&gt;</span> term_names;
</span></span><span style="display:flex;"><span>      file.open( path_name, ios<span style="color:#f92672">::</span>in );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">while</span> ( file.peek() <span style="color:#f92672">!=</span> EOF ) {
</span></span><span style="display:flex;"><span>        file <span style="color:#f92672">&gt;&gt;</span> term_name;
</span></span><span style="display:flex;"><span>        doc_length<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        term_name <span style="color:#f92672">=</span> add_index_term_to_dictionary( term_name, file_name );
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( term_name <span style="color:#f92672">!=</span> <span style="color:#e6db74">&#34;&#34;</span> ) term_names.push_back( term_name );
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// while
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      file.close();
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_names;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// read_a_doc_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>    string <span style="color:#a6e22e">add_index_term_to_dictionary</span>( string term_name, string file_name ) {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">auto</span> iterator <span style="color:#f92672">=</span> doc_terms_map.find( term_name );
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">if</span> ( iterator <span style="color:#f92672">!=</span> doc_terms_map.end() ) {
</span></span><span style="display:flex;"><span>        Dictionary doc_term <span style="color:#f92672">=</span> iterator <span style="color:#f92672">-&gt;</span> second;
</span></span><span style="display:flex;"><span>        doc_term.term_property.tf[num_file]<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> ( doc_term.term_in_last_file_name <span style="color:#f92672">!=</span> file_name ) {
</span></span><span style="display:flex;"><span>          doc_term.term_property.num_of_article_including<span style="color:#f92672">++</span>;
</span></span><span style="display:flex;"><span>          doc_term.term_in_last_file_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>        <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>          term_name <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;&#34;</span>;
</span></span><span style="display:flex;"><span>        } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>        iterator <span style="color:#f92672">-&gt;</span> second <span style="color:#f92672">=</span> doc_term;
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// if
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>      <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>        TermProperty term_property;
</span></span><span style="display:flex;"><span>        term_property.tf[num_file] <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        term_property.num_of_article_including <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>;
</span></span><span style="display:flex;"><span>        Dictionary doc_term;
</span></span><span style="display:flex;"><span>        doc_term.term_name <span style="color:#f92672">=</span> term_name;
</span></span><span style="display:flex;"><span>        doc_term.term_in_last_file_name <span style="color:#f92672">=</span> file_name;
</span></span><span style="display:flex;"><span>        doc_term.term_property <span style="color:#f92672">=</span> term_property;
</span></span><span style="display:flex;"><span>        doc_terms_map.insert( make_pair( term_name, doc_term ));
</span></span><span style="display:flex;"><span>      } <span style="color:#75715e">// else
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">return</span> term_name;
</span></span><span style="display:flex;"><span>    } <span style="color:#75715e">// add_index_term_to_dictionary()
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>}; <span style="color:#75715e">// Doc_Scanner
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">int</span> <span style="color:#a6e22e">main</span>() {
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start scanning documents.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  Doc_Scanner doc_scanner;
</span></span><span style="display:flex;"><span>  doc_scanner.ReadAllDocuments();
</span></span><span style="display:flex;"><span>  doc_scanner.CalculateDocsTermWeight();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Scanning documents done.</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;Start Calulate Query Weight</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// PrintVector( doc_terms );
</span></span></span><span style="display:flex;"><span><span style="color:#75715e"></span>  doc_scanner.CalculateEveryQueryFile();
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Calulate Query Weight</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>  ofstream output_file( <span style="color:#e6db74">&#34;output_csv.csv&#34;</span> );
</span></span><span style="display:flex;"><span>  doc_scanner.RankEveryQueryFile( output_file );
</span></span><span style="display:flex;"><span>  cout <span style="color:#f92672">&lt;&lt;</span> <span style="color:#e6db74">&#34;End Program</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#34;</span>;
</span></span><span style="display:flex;"><span>} <span style="color:#75715e">// main()
</span></span></span></code></pre></td></tr></table>
</div>
</div><h2 id="hw6---bert-model">HW6 - BERT Model<a hidden class="anchor" aria-hidden="true" href="#hw6---bert-model">#</a></h2>
<ol>
<li>BERT 參數調法</li>
</ol>
<p><img loading="lazy" src="https://i.imgur.com/Sht27bU.png" alt=""  />
</p>
<ol start="2">
<li>BERT 理論心得</li>
</ol>
<p>BERT(雙向Transformer編碼表達)<br>
主要是以兩種預訓練的方式來建立語言模型。
<img loading="lazy" src="https://i.imgur.com/ZI38liB.png" alt=""  />
</p>
<p><img loading="lazy" src="https://i.imgur.com/l8GE1w0.png" alt=""  />
</p>
<p><img loading="lazy" src="https://i.imgur.com/lSL77GO.png" alt=""  />
</p>
<p>讓model分辨句⼦之間上下⽂之關係
<img loading="lazy" src="file:///C:/Users/w7536/AppData/Local/Temp/msohtmlclip1/01/clip_image012.jpg" alt=""  />

<img loading="lazy" src="https://i.imgur.com/8B7B18e.png" alt=""  />
</p>
<p>簡而知BERT預訓練模型需要做兩個主要任務:</p>
<p>第⼀Task: 判斷兩句話是否真的相鄰(Binary classification)<br>
第⼆Task: 預測被mask之單詞(Multi-class classification)</p>
<p>(三) BERT實作心得</p>
<p>使用助教提供的baseline code下去實現，其主要呼叫的地方可以查官方API實作出來，利用此model回傳loss及logits值。</p>
<p><img loading="lazy" src="https://i.imgur.com/B95IAk0.png" alt=""  />
</p>
<p>而TO-DO地方中需要回傳BM25的2D array scores，可以利用助教的方法實現</p>
<p><img loading="lazy" src="https://i.imgur.com/TjWyTlq.png" alt=""  />
</p>
<h3 id="code-5">Code<a hidden class="anchor" aria-hidden="true" href="#code-5">#</a></h3>
<div class="highlight"><div style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">
<table style="border-spacing:0;padding:0;margin:0;border:0;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  1
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  2
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  3
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  4
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  5
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  6
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  7
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  8
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">  9
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 10
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 11
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 12
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 13
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 14
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 15
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 16
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 17
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 18
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 19
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 20
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 21
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 22
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 23
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 24
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 25
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 26
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 27
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 28
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 29
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 30
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 31
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 32
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 33
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 34
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 35
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 36
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 37
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 38
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 39
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 40
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 41
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 42
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 43
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 44
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 45
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 46
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 47
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 48
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 49
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 50
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 51
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 52
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 53
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 54
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 55
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 56
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 57
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 58
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 59
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 60
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 61
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 62
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 63
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 64
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 65
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 66
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 67
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 68
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 69
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 70
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 71
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 72
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 73
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 74
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 75
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 76
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 77
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 78
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 79
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 80
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 81
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 82
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 83
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 84
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 85
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 86
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 87
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 88
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 89
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 90
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 91
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 92
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 93
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 94
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 95
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 96
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 97
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 98
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 99
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">100
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">101
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">102
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">103
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">104
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">105
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">106
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">107
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">108
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">109
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">110
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">111
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">112
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">113
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">114
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">115
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">116
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">117
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">118
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">119
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">120
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">121
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">122
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">123
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">124
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">125
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">126
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">127
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">128
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">129
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">130
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">131
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">132
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">133
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">134
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">135
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">136
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">137
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">138
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">139
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">140
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">141
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">142
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">143
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">144
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">145
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">146
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">147
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">148
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">149
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">150
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">151
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">152
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">153
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">154
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">155
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">156
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">157
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">158
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">159
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">160
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">161
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">162
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">163
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">164
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">165
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">166
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">167
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">168
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">169
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">170
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">171
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">172
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">173
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">174
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">175
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">176
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">177
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">178
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">179
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">180
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">181
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">182
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">183
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">184
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">185
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">186
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">187
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">188
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">189
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">190
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">191
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">192
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">193
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">194
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">195
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">196
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">197
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">198
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">199
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">200
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">201
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">202
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">203
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">204
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">205
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">206
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">207
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">208
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">209
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">210
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">211
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">212
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">213
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">214
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">215
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">216
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">217
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">218
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">219
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">220
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">221
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">222
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">223
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">224
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">225
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">226
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">227
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">228
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">229
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">230
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">231
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">232
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">233
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">234
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">235
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">236
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">237
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">238
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">239
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">240
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">241
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">242
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">243
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">244
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">245
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">246
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">247
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">248
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">249
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">250
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">251
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">252
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">253
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">254
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">255
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">256
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">257
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">258
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">259
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">260
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">261
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">262
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">263
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">264
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">265
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">266
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">267
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">268
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">269
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">270
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">271
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">272
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">273
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">274
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">275
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">276
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">277
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">278
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">279
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">280
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">281
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">282
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">283
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">284
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">285
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">286
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">287
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">288
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">289
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">290
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">291
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">292
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">293
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">294
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">295
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">296
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">297
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">298
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">299
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">300
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">301
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">302
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">303
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">304
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">305
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">306
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">307
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">308
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">309
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">310
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">311
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">312
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">313
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">314
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">315
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">316
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">317
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">318
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">319
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">320
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">321
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">322
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">323
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">324
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">325
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">326
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">327
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">328
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">329
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">330
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">331
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">332
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">333
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">334
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">335
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">336
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">337
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">338
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">339
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">340
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">341
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">342
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">343
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">344
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">345
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">346
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">347
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">348
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">349
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">350
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">351
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">352
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">353
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">354
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">355
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">356
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">357
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">358
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">359
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">360
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">361
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">362
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">363
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">364
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">365
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">366
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">367
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">368
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">369
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">370
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">371
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">372
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">373
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">374
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">375
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">376
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">377
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">378
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">379
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">380
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">381
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">382
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">383
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">384
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">385
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">386
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">387
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">388
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">389
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">390
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">391
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">392
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">393
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">394
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">395
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">396
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">397
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">398
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">399
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">400
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">401
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">402
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">403
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">404
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">405
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">406
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">407
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">408
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">409
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">410
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">411
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">412
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">413
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">414
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">415
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">416
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">417
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">418
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">419
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">420
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">421
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">422
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">423
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">424
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">425
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">426
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">427
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">428
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">429
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">430
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">431
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">432
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">433
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">434
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">435
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">436
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">437
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">438
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">439
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">440
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">441
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">442
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">443
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">444
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">445
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">446
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">447
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">448
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">449
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">450
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">451
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">452
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">453
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">454
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">455
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">456
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">457
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">458
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">459
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">460
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">461
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">462
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">463
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">464
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">465
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">466
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">467
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">468
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">469
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">470
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">471
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">472
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">473
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">474
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">475
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">476
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">477
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">478
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">479
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">480
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">481
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">482
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">483
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">484
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">485
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">486
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">487
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">488
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">489
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">490
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">491
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">492
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">493
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">494
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">495
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">496
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">497
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">498
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">499
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">500
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">501
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">502
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">503
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">504
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">505
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">506
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">507
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">508
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">509
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">510
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">511
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">512
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">513
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">514
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">515
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">516
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">517
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">518
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">519
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">520
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">521
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">522
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">523
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">524
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">525
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">526
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">527
</span><span style="white-space:pre;-webkit-user-select:none;user-select:none;margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">528
</span></code></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;;width:100%">
<pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-PYTHON" data-lang="PYTHON"><span style="display:flex;"><span><span style="color:#75715e">#!/usr/bin/env python</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># coding: utf-8</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> time <span style="color:#f92672">import</span> time
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> datetime <span style="color:#f92672">import</span> timedelta
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> copy <span style="color:#f92672">import</span> deepcopy
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> random
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> numpy <span style="color:#66d9ef">as</span> np
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> pandas <span style="color:#66d9ef">as</span> pd
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> ml_metrics <span style="color:#f92672">import</span> mapk
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">import</span> torch
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torch.optim <span style="color:#f92672">import</span> AdamW
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torch.nn.utils.rnn <span style="color:#f92672">import</span> pad_sequence
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> torch.utils.data <span style="color:#f92672">import</span> Dataset, DataLoader
</span></span><span style="display:flex;"><span><span style="color:#f92672">from</span> transformers <span style="color:#f92672">import</span> BertTokenizerFast, BertForMultipleChoice
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Random seed</span>
</span></span><span style="display:flex;"><span>SEED <span style="color:#f92672">=</span> <span style="color:#ae81ff">42</span>
</span></span><span style="display:flex;"><span>random<span style="color:#f92672">.</span>seed(SEED)
</span></span><span style="display:flex;"><span>np<span style="color:#f92672">.</span>random<span style="color:#f92672">.</span>seed(SEED)
</span></span><span style="display:flex;"><span>torch<span style="color:#f92672">.</span>manual_seed(SEED)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># CUDA device</span>
</span></span><span style="display:flex;"><span>use_cuda_device <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>torch<span style="color:#f92672">.</span>cuda<span style="color:#f92672">.</span>set_device(use_cuda_device)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Using CUDA device: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> torch<span style="color:#f92672">.</span>cuda<span style="color:#f92672">.</span>current_device())
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## Settings</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Input files</span>
</span></span><span style="display:flex;"><span>document_csv_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;../input/ntust-ir2020-homework6/documents.csv&#39;</span>
</span></span><span style="display:flex;"><span>training_csv_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;../input/ntust-ir2020-homework6/train_queries.csv&#39;</span>
</span></span><span style="display:flex;"><span>testing_csv_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#39;../input/ntust-ir2020-homework6/test_queries.csv&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Input limitation</span>
</span></span><span style="display:flex;"><span>max_query_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">64</span>
</span></span><span style="display:flex;"><span>max_input_length <span style="color:#f92672">=</span> <span style="color:#ae81ff">512</span>
</span></span><span style="display:flex;"><span>num_negatives <span style="color:#f92672">=</span> <span style="color:#ae81ff">3</span>   <span style="color:#75715e"># num. of negative documents to pair with a positive document</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Model finetuning</span>
</span></span><span style="display:flex;"><span>model_name_or_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bert-base-uncased&#34;</span>
</span></span><span style="display:flex;"><span>max_epochs <span style="color:#f92672">=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>learning_rate <span style="color:#f92672">=</span> <span style="color:#ae81ff">3e-5</span>
</span></span><span style="display:flex;"><span>dev_set_ratio <span style="color:#f92672">=</span> <span style="color:#ae81ff">0.2</span>   <span style="color:#75715e"># make a ratio of training set as development set for rescoring weight sniffing</span>
</span></span><span style="display:flex;"><span>max_patience <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>      <span style="color:#75715e"># earlystop if avg. loss on development set doesn&#39;t decrease for num. of epochs</span>
</span></span><span style="display:flex;"><span>batch_size <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>    <span style="color:#75715e"># num. of inputs = 8 requires ~9200 MB VRAM (num. of inputs = batch_size * (num_negatives + 1))</span>
</span></span><span style="display:flex;"><span>num_workers <span style="color:#f92672">=</span> <span style="color:#ae81ff">2</span>   <span style="color:#75715e"># num. of jobs for pytorch dataloader</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Save paths</span>
</span></span><span style="display:flex;"><span>save_model_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;models/bert_base_uncased&#34;</span>  <span style="color:#75715e"># assign `None` for not saving the model</span>
</span></span><span style="display:flex;"><span>save_submission_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;bm25_bert_rescoring.csv&#34;</span>
</span></span><span style="display:flex;"><span>K <span style="color:#f92672">=</span> <span style="color:#ae81ff">1000</span>   <span style="color:#75715e"># for MAP@K</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## Preparing</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Build and save BERT tokenizer</span>
</span></span><span style="display:flex;"><span>tokenizer <span style="color:#f92672">=</span> BertTokenizerFast<span style="color:#f92672">.</span>from_pretrained(model_name_or_path)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> save_model_path <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>    save_tokenizer_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/tokenizer&#34;</span> <span style="color:#f92672">%</span> (save_model_path)
</span></span><span style="display:flex;"><span>    tokenizer<span style="color:#f92672">.</span>save_pretrained(save_tokenizer_path)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Collect mapping of all document id and text</span>
</span></span><span style="display:flex;"><span>doc_id_to_text <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>doc_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(document_csv_path)
</span></span><span style="display:flex;"><span>doc_df<span style="color:#f92672">.</span>fillna(<span style="color:#e6db74">&#34;&lt;Empty Document&gt;&#34;</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>id_text_pair <span style="color:#f92672">=</span> zip(doc_df[<span style="color:#e6db74">&#34;doc_id&#34;</span>], doc_df[<span style="color:#e6db74">&#34;doc_text&#34;</span>])
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i, pair <span style="color:#f92672">in</span> enumerate(id_text_pair, start<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    doc_id, doc_text <span style="color:#f92672">=</span> pair
</span></span><span style="display:flex;"><span>    doc_id_to_text[doc_id] <span style="color:#f92672">=</span> doc_text
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Progress: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%d</span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (i, len(doc_df)), end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>doc_df<span style="color:#f92672">.</span>tail()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># # Training</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## Split a ratio of training set as development set</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>train_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(training_csv_path)
</span></span><span style="display:flex;"><span>dev_df, train_df <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>split(train_df, [int(dev_set_ratio<span style="color:#f92672">*</span>len(train_df))])
</span></span><span style="display:flex;"><span>dev_df<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>train_df<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;train_df shape:&#34;</span>, train_df<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;dev_df shape:&#34;</span>, dev_df<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>train_df<span style="color:#f92672">.</span>tail()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## Build instances for training/development set</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>get_ipython()<span style="color:#f92672">.</span>run_cell_magic(<span style="color:#e6db74">&#39;time&#39;</span>, <span style="color:#e6db74">&#39;&#39;</span>, <span style="color:#e6db74">&#39;doc_id_to_token_ids = </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n\n\n</span><span style="color:#e6db74">def preprocess_df(df):</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    </span><span style="color:#ae81ff">\&#39;\&#39;\&#39;</span><span style="color:#e6db74"> Preprocess DataFrame into training instances for BERT. </span><span style="color:#ae81ff">\&#39;\&#39;\&#39;\n</span><span style="color:#e6db74">    instances = []</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    # Parse CSV</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    for i, row in df.iterrows():</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        query_id, query_text, pos_doc_ids, bm25_top1000, _ = row</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        pos_doc_id_list = pos_doc_ids.split()</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        pos_doc_id_set = set(pos_doc_id_list)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        bm25_top1000_list = bm25_top1000.split()</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        bm25_top1000_set = set(bm25_top1000_list)</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">        # Pair BM25 neg. with pos. samples</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        labeled_pos_neg_list = []</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        for pos_doc_id in pos_doc_id_list:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            neg_doc_id_set = bm25_top1000_set - pos_doc_id_set</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            neg_doc_ids = random.sample(neg_doc_id_set, num_negatives)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            pos_position = random.randint(0, num_negatives)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            pos_neg_doc_ids = neg_doc_ids</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            pos_neg_doc_ids.insert(pos_position, pos_doc_id)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            labeled_sample = (pos_neg_doc_ids, pos_position)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            labeled_pos_neg_list.append(labeled_sample)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        # Make query tokens for BERT</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        query_tokens = tokenizer.tokenize(query_text)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        if len(query_tokens) &gt; max_query_length:  # truncation</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            query_tokens = query_tokens[:max_query_length]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        query_token_ids = tokenizer.convert_tokens_to_ids(query_tokens)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        query_token_ids.insert(0, tokenizer.cls_token_id)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        query_token_ids.append(tokenizer.sep_token_id)</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">        # Make input instances for all query/doc pairs</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">        for doc_ids, label in labeled_pos_neg_list:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            paired_input_ids = []</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            paired_attention_mask = []</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            paired_token_type_ids = []</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            # Merge all pos/neg inputs as a single sample</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            for doc_id in doc_ids:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                if doc_id in doc_id_to_token_ids:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                    doc_token_ids = doc_id_to_token_ids[doc_id]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                else:</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                    doc_text = doc_id_to_text[doc_id]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                    doc_tokens = tokenizer.tokenize(doc_text)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                    doc_token_ids = tokenizer.convert_tokens_to_ids(doc_tokens)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                    doc_id_to_token_ids[doc_id] = doc_token_ids</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                doc_token_ids.append(tokenizer.sep_token_id)</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">                # make input sequences for BERT</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                input_ids = query_token_ids + doc_token_ids</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                token_type_ids = [0 for token_id in query_token_ids]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                token_type_ids.extend(1 for token_id in doc_token_ids)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                if len(input_ids) &gt; max_input_length:  # truncation</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                    input_ids = input_ids[:max_input_length]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                    token_type_ids = token_type_ids[:max_input_length]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                attention_mask = [1 for token_id in input_ids]</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                # convert and collect inputs as tensors</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                input_ids = torch.LongTensor(input_ids)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                attention_mask = torch.FloatTensor(attention_mask)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                token_type_ids = torch.LongTensor(token_type_ids)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                paired_input_ids.append(input_ids)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                paired_attention_mask.append(attention_mask)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">                paired_token_type_ids.append(token_type_ids)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            label = torch.LongTensor([label]).squeeze()</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            </span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            # Pre-pad tensor pairs for efficiency</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            paired_input_ids = pad_sequence(paired_input_ids, batch_first=True)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            paired_attention_mask = pad_sequence(paired_attention_mask, batch_first=True)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            paired_token_type_ids = pad_sequence(paired_token_type_ids, batch_first=True)</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">            # collect all inputs as a dictionary</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            instance = </span><span style="color:#e6db74">{}</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            instance[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">input_ids</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">] = paired_input_ids.T  # transpose for code efficiency</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            instance[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">attention_mask</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">] = paired_attention_mask.T</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            instance[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">token_type_ids</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">] = paired_token_type_ids.T</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            instance[</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">label</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">] = label</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">            instances.append(instance)</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">        print(&#34;Progress: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%d</span><span style="color:#ae81ff">\\</span><span style="color:#e6db74">r&#34; % (i+1, len(df)), end=</span><span style="color:#ae81ff">\&#39;\&#39;</span><span style="color:#e6db74">)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    print()</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">    return instances</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">train_instances = preprocess_df(train_df)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">dev_instances = preprocess_df(dev_df)</span><span style="color:#ae81ff">\n\n</span><span style="color:#e6db74">print(&#34;num. train_instances: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34; </span><span style="color:#e6db74">% le</span><span style="color:#e6db74">n(train_instances))</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">print(&#34;num. dev_instances: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34; </span><span style="color:#e6db74">% le</span><span style="color:#e6db74">n(dev_instances))</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">print(&#34;input_ids.T shape:&#34;, train_instances[0][</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">input_ids</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">].T.shape)</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">train_instances[0][</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">input_ids</span><span style="color:#ae81ff">\&#39;</span><span style="color:#e6db74">].T</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## Build dataset and dataloader for PyTorch</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TrainingDataset</span>(Dataset):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, instances):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>instances <span style="color:#f92672">=</span> instances
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __len__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> len(self<span style="color:#f92672">.</span>instances)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __getitem__(self, i):
</span></span><span style="display:flex;"><span>        instance <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>instances[i]
</span></span><span style="display:flex;"><span>        input_ids <span style="color:#f92672">=</span> instance[<span style="color:#e6db74">&#39;input_ids&#39;</span>]
</span></span><span style="display:flex;"><span>        attention_mask <span style="color:#f92672">=</span> instance[<span style="color:#e6db74">&#39;attention_mask&#39;</span>]
</span></span><span style="display:flex;"><span>        token_type_ids <span style="color:#f92672">=</span> instance[<span style="color:#e6db74">&#39;token_type_ids&#39;</span>]
</span></span><span style="display:flex;"><span>        label <span style="color:#f92672">=</span> instance[<span style="color:#e6db74">&#39;label&#39;</span>]
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> input_ids, attention_mask, token_type_ids, label
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_train_dataloader</span>(instances, batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">2</span>, num_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">collate_fn</span>(batch):
</span></span><span style="display:flex;"><span>        input_ids, attention_mask, token_type_ids, labels <span style="color:#f92672">=</span> zip(<span style="color:#f92672">*</span>batch)
</span></span><span style="display:flex;"><span>        input_ids <span style="color:#f92672">=</span> pad_sequence(input_ids, batch_first<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>transpose(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>contiguous()  <span style="color:#75715e"># re-transpose</span>
</span></span><span style="display:flex;"><span>        attention_mask <span style="color:#f92672">=</span> pad_sequence(attention_mask, batch_first<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>transpose(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>contiguous()
</span></span><span style="display:flex;"><span>        token_type_ids <span style="color:#f92672">=</span> pad_sequence(token_type_ids, batch_first<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>transpose(<span style="color:#ae81ff">1</span>,<span style="color:#ae81ff">2</span>)<span style="color:#f92672">.</span>contiguous()
</span></span><span style="display:flex;"><span>        labels <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>stack(labels)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> input_ids, attention_mask, token_type_ids, labels
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    dataset <span style="color:#f92672">=</span> TrainingDataset(instances)
</span></span><span style="display:flex;"><span>    dataloader <span style="color:#f92672">=</span> DataLoader(dataset, collate_fn<span style="color:#f92672">=</span>collate_fn, shuffle<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, \
</span></span><span style="display:flex;"><span>                            batch_size<span style="color:#f92672">=</span>batch_size, num_workers<span style="color:#f92672">=</span>num_workers)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> dataloader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Demo</span>
</span></span><span style="display:flex;"><span>dataloader <span style="color:#f92672">=</span> get_train_dataloader(train_instances)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> batch <span style="color:#f92672">in</span> dataloader:
</span></span><span style="display:flex;"><span>    input_ids, attention_mask, token_type_ids, labels <span style="color:#f92672">=</span> batch
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>print(input_ids<span style="color:#f92672">.</span>shape)
</span></span><span style="display:flex;"><span>input_ids
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## Initialize and finetune BERT</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>model <span style="color:#f92672">=</span> BertForMultipleChoice<span style="color:#f92672">.</span>from_pretrained(model_name_or_path)
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>cuda()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>optimizer <span style="color:#f92672">=</span> AdamW(model<span style="color:#f92672">.</span>parameters(), lr<span style="color:#f92672">=</span>learning_rate)
</span></span><span style="display:flex;"><span>optimizer<span style="color:#f92672">.</span>zero_grad()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ### (TO-DO!) Define validation function for earlystopping</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">validate</span>(model, instances):
</span></span><span style="display:flex;"><span>    total_loss <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">.</span>eval()
</span></span><span style="display:flex;"><span>    dataloader <span style="color:#f92672">=</span> get_train_dataloader(instances, batch_size<span style="color:#f92672">=</span>batch_size, num_workers<span style="color:#f92672">=</span>num_workers)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> batch <span style="color:#f92672">in</span> dataloader:
</span></span><span style="display:flex;"><span>        batch <span style="color:#f92672">=</span> (tensor<span style="color:#f92672">.</span>cuda() <span style="color:#66d9ef">for</span> tensor <span style="color:#f92672">in</span> batch)
</span></span><span style="display:flex;"><span>        input_ids, attention_mask, token_type_ids, labels <span style="color:#f92672">=</span> batch
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39; TO-DO: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        1. Compute the cross-entropy loss (using built-in loss of BertForMultipleChoice)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          (Hint: You need to call a function of model which takes all the 4 tensors in the batch as inputs)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        2. Sum up the loss of all dev-set samples
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          (Hint: The built-in loss is averaged, so you should multiply it with the batch size)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">### 1. insert_missing_code </span>
</span></span><span style="display:flex;"><span>            loss <span style="color:#f92672">=</span> model( input_ids <span style="color:#f92672">=</span> input_ids, attention_mask <span style="color:#f92672">=</span> attention_mask,     
</span></span><span style="display:flex;"><span>                          token_type_ids <span style="color:#f92672">=</span> token_type_ids, labels <span style="color:#f92672">=</span> labels, return_dict<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> )<span style="color:#f92672">.</span>loss          
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">### 2. insert_missing_code </span>
</span></span><span style="display:flex;"><span>        total_loss <span style="color:#f92672">+=</span> loss <span style="color:#f92672">*</span> batch_size 
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    avg_loss <span style="color:#f92672">=</span> total_loss <span style="color:#f92672">/</span> len(instances)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> avg_loss
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ### (TO-DO!) Let&#39;s train this beeg boy ;-)</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>patience, best_dev_loss <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">1e10</span>
</span></span><span style="display:flex;"><span>best_state_dict <span style="color:#f92672">=</span> model<span style="color:#f92672">.</span>state_dict()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>start_time <span style="color:#f92672">=</span> time()
</span></span><span style="display:flex;"><span>dataloader <span style="color:#f92672">=</span> get_train_dataloader(train_instances, batch_size<span style="color:#f92672">=</span>batch_size, num_workers<span style="color:#f92672">=</span>num_workers)
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> epoch <span style="color:#f92672">in</span> range(<span style="color:#ae81ff">1</span>, max_epochs<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">.</span>train()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i, batch <span style="color:#f92672">in</span> enumerate(dataloader, start<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        batch <span style="color:#f92672">=</span> (tensor<span style="color:#f92672">.</span>cuda() <span style="color:#66d9ef">for</span> tensor <span style="color:#f92672">in</span> batch)
</span></span><span style="display:flex;"><span>        input_ids, attention_mask, token_type_ids, labels <span style="color:#f92672">=</span> batch
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Backpropogation</span>
</span></span><span style="display:flex;"><span>        <span style="color:#e6db74">&#39;&#39;&#39; TO-DO: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        1. Compute the cross-entropy loss (using built-in loss of BertForMultipleChoice)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          (Hint: You need to call a function of model which takes all the 4 tensors in the batch as inputs)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        2. Perform backpropogation on the loss (i.e. compute gradients)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        3. Optimize the model.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">          (Hint: These two lines of codes can be found in PyTorch tutorial)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">### 1. insert_missing_code</span>
</span></span><span style="display:flex;"><span>        loss <span style="color:#f92672">=</span> model( input_ids <span style="color:#f92672">=</span> input_ids, attention_mask <span style="color:#f92672">=</span> attention_mask,     
</span></span><span style="display:flex;"><span>                      token_type_ids <span style="color:#f92672">=</span> token_type_ids, labels <span style="color:#f92672">=</span> labels, return_dict<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span> )<span style="color:#f92672">.</span>loss  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">### 2. insert_missing_code</span>
</span></span><span style="display:flex;"><span>        loss<span style="color:#f92672">.</span>backward()
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">### 3. insert_missing_code</span>
</span></span><span style="display:flex;"><span>        optimizer<span style="color:#f92672">.</span>step()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        optimizer<span style="color:#f92672">.</span>zero_grad()
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Progress bar with timer ;-)</span>
</span></span><span style="display:flex;"><span>        elapsed_time <span style="color:#f92672">=</span> time() <span style="color:#f92672">-</span> start_time
</span></span><span style="display:flex;"><span>        elapsed_time <span style="color:#f92672">=</span> timedelta(seconds<span style="color:#f92672">=</span>int(elapsed_time))
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;Epoch: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> | Batch: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> | loss=</span><span style="color:#e6db74">%.5f</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">      </span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">&#34;</span> \
</span></span><span style="display:flex;"><span>              <span style="color:#f92672">%</span> (epoch, max_epochs, i, len(dataloader), loss, elapsed_time), end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Save parameters of each epoch</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> save_model_path <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>        save_checkpoint_path <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">/epoch_</span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (save_model_path, epoch)
</span></span><span style="display:flex;"><span>        model<span style="color:#f92672">.</span>save_pretrained(save_checkpoint_path)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Get avg. loss on development set</span>
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Epoch: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> | Validating...                           </span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (epoch, max_epochs), end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>    dev_loss <span style="color:#f92672">=</span> validate(model, dev_instances)
</span></span><span style="display:flex;"><span>    elapsed_time <span style="color:#f92672">=</span> time() <span style="color:#f92672">-</span> start_time
</span></span><span style="display:flex;"><span>    elapsed_time <span style="color:#f92672">=</span> timedelta(seconds<span style="color:#f92672">=</span>int(elapsed_time))
</span></span><span style="display:flex;"><span>    print(<span style="color:#e6db74">&#34;Epoch: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> | dev_loss=</span><span style="color:#e6db74">%.5f</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">                      &#34;</span> \
</span></span><span style="display:flex;"><span>          <span style="color:#f92672">%</span> (epoch, max_epochs, dev_loss, elapsed_time))
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Track best checkpoint and earlystop patience</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> dev_loss <span style="color:#f92672">&lt;</span> best_dev_loss:
</span></span><span style="display:flex;"><span>        patience <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>        best_dev_loss <span style="color:#f92672">=</span> dev_loss
</span></span><span style="display:flex;"><span>        best_state_dict <span style="color:#f92672">=</span> deepcopy(model<span style="color:#f92672">.</span>state_dict())
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> save_model_path <span style="color:#f92672">is</span> <span style="color:#f92672">not</span> <span style="color:#66d9ef">None</span>:
</span></span><span style="display:flex;"><span>            model<span style="color:#f92672">.</span>save_pretrained(save_model_path)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>        patience <span style="color:#f92672">+=</span> <span style="color:#ae81ff">1</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> patience <span style="color:#f92672">&gt;</span> max_patience:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#39;Earlystop at epoch </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">&#39;</span> <span style="color:#f92672">%</span> epoch)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">break</span>
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Restore parameters with best loss on development set</span>
</span></span><span style="display:flex;"><span>model<span style="color:#f92672">.</span>load_state_dict(best_state_dict)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># # Testing</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">class</span> <span style="color:#a6e22e">TestingDataset</span>(Dataset):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __init__(self, instances):
</span></span><span style="display:flex;"><span>        self<span style="color:#f92672">.</span>instances <span style="color:#f92672">=</span> instances
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __len__(self):
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> len(self<span style="color:#f92672">.</span>instances)
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> __getitem__(self, i):
</span></span><span style="display:flex;"><span>        instance <span style="color:#f92672">=</span> self<span style="color:#f92672">.</span>instances[i]
</span></span><span style="display:flex;"><span>        input_ids <span style="color:#f92672">=</span> instance[<span style="color:#e6db74">&#39;input_ids&#39;</span>]
</span></span><span style="display:flex;"><span>        attention_mask <span style="color:#f92672">=</span> instance[<span style="color:#e6db74">&#39;attention_mask&#39;</span>]
</span></span><span style="display:flex;"><span>        token_type_ids <span style="color:#f92672">=</span> instance[<span style="color:#e6db74">&#39;token_type_ids&#39;</span>]
</span></span><span style="display:flex;"><span>        input_ids <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>LongTensor(input_ids)
</span></span><span style="display:flex;"><span>        attention_mask <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>FloatTensor(attention_mask)
</span></span><span style="display:flex;"><span>        token_type_ids <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>LongTensor(token_type_ids)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> input_ids, attention_mask, token_type_ids, 
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">get_test_dataloader</span>(instances, batch_size<span style="color:#f92672">=</span><span style="color:#ae81ff">8</span>, num_workers<span style="color:#f92672">=</span><span style="color:#ae81ff">4</span>):
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">def</span> <span style="color:#a6e22e">collate_fn</span>(batch):
</span></span><span style="display:flex;"><span>        input_ids, attention_mask, token_type_ids <span style="color:#f92672">=</span> zip(<span style="color:#f92672">*</span>batch)
</span></span><span style="display:flex;"><span>        input_ids <span style="color:#f92672">=</span> pad_sequence(input_ids, batch_first<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>unsqueeze(<span style="color:#ae81ff">1</span>)  <span style="color:#75715e"># predict as single choice</span>
</span></span><span style="display:flex;"><span>        attention_mask <span style="color:#f92672">=</span> pad_sequence(attention_mask, batch_first<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>unsqueeze(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        token_type_ids <span style="color:#f92672">=</span> pad_sequence(token_type_ids, batch_first<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)<span style="color:#f92672">.</span>unsqueeze(<span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">return</span> input_ids, attention_mask, token_type_ids
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    dataset <span style="color:#f92672">=</span> TestingDataset(instances)
</span></span><span style="display:flex;"><span>    dataloader <span style="color:#f92672">=</span> DataLoader(dataset, collate_fn<span style="color:#f92672">=</span>collate_fn, shuffle<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>, \
</span></span><span style="display:flex;"><span>                            batch_size<span style="color:#f92672">=</span>batch_size, num_workers<span style="color:#f92672">=</span>num_workers)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> dataloader
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## (TO-DO!) Define function to predict BERT scores</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">def</span> <span style="color:#a6e22e">predict_query_doc_scores</span>(model, df):
</span></span><span style="display:flex;"><span>    model<span style="color:#f92672">.</span>eval()
</span></span><span style="display:flex;"><span>    start_time <span style="color:#f92672">=</span> time()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Parse CSV</span>
</span></span><span style="display:flex;"><span>    query_id_list <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;query_id&#34;</span>]
</span></span><span style="display:flex;"><span>    query_text_list <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;query_text&#34;</span>]
</span></span><span style="display:flex;"><span>    bm25_top1000_list <span style="color:#f92672">=</span> df[<span style="color:#e6db74">&#34;bm25_top1000&#34;</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># Treat {1 query, K documents} as a dataset for prediction</span>
</span></span><span style="display:flex;"><span>    query_doc_scores <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    query_doc_ids <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    rows <span style="color:#f92672">=</span> zip(query_id_list, query_text_list, bm25_top1000_list)
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> qi, row <span style="color:#f92672">in</span> enumerate(rows, start<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>        query_id, query_text, bm25_top1000 <span style="color:#f92672">=</span> row
</span></span><span style="display:flex;"><span>        bm25_doc_id_list <span style="color:#f92672">=</span> bm25_top1000<span style="color:#f92672">.</span>split()
</span></span><span style="display:flex;"><span>        query_doc_ids<span style="color:#f92672">.</span>append(bm25_doc_id_list)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#################################################</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#    Collect all instances of query/doc pairs</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#################################################</span>
</span></span><span style="display:flex;"><span>        query_instances <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Make query tokens for BERT</span>
</span></span><span style="display:flex;"><span>        query_tokens <span style="color:#f92672">=</span> tokenizer<span style="color:#f92672">.</span>tokenize(query_text)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> len(query_tokens) <span style="color:#f92672">&gt;</span> max_query_length:  <span style="color:#75715e"># truncation</span>
</span></span><span style="display:flex;"><span>            query_tokens <span style="color:#f92672">=</span> query_tokens[:max_query_length]
</span></span><span style="display:flex;"><span>        query_token_ids <span style="color:#f92672">=</span> tokenizer<span style="color:#f92672">.</span>convert_tokens_to_ids(query_tokens)
</span></span><span style="display:flex;"><span>        query_token_ids<span style="color:#f92672">.</span>insert(<span style="color:#ae81ff">0</span>, tokenizer<span style="color:#f92672">.</span>cls_token_id)
</span></span><span style="display:flex;"><span>        query_token_ids<span style="color:#f92672">.</span>append(tokenizer<span style="color:#f92672">.</span>sep_token_id)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Make input instances for all query/doc pairs</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> i, doc_id <span style="color:#f92672">in</span> enumerate(bm25_doc_id_list, start<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> doc_id <span style="color:#f92672">in</span> doc_id_to_token_ids:
</span></span><span style="display:flex;"><span>                doc_token_ids <span style="color:#f92672">=</span> doc_id_to_token_ids[doc_id]
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span>:
</span></span><span style="display:flex;"><span>                doc_text <span style="color:#f92672">=</span> doc_id_to_text[doc_id]
</span></span><span style="display:flex;"><span>                doc_tokens <span style="color:#f92672">=</span> tokenizer<span style="color:#f92672">.</span>tokenize(doc_text)
</span></span><span style="display:flex;"><span>                doc_token_ids <span style="color:#f92672">=</span> tokenizer<span style="color:#f92672">.</span>convert_tokens_to_ids(doc_tokens)
</span></span><span style="display:flex;"><span>                doc_id_to_token_ids[doc_id] <span style="color:#f92672">=</span> doc_token_ids
</span></span><span style="display:flex;"><span>            doc_token_ids<span style="color:#f92672">.</span>append(tokenizer<span style="color:#f92672">.</span>sep_token_id)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># make input sequences for BERT</span>
</span></span><span style="display:flex;"><span>            input_ids <span style="color:#f92672">=</span> query_token_ids <span style="color:#f92672">+</span> doc_token_ids
</span></span><span style="display:flex;"><span>            token_type_ids <span style="color:#f92672">=</span> [<span style="color:#ae81ff">0</span> <span style="color:#66d9ef">for</span> token_id <span style="color:#f92672">in</span> query_token_ids]
</span></span><span style="display:flex;"><span>            token_type_ids<span style="color:#f92672">.</span>extend(<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> token_id <span style="color:#f92672">in</span> doc_token_ids)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> len(input_ids) <span style="color:#f92672">&gt;</span> max_input_length:  <span style="color:#75715e"># truncation</span>
</span></span><span style="display:flex;"><span>                input_ids <span style="color:#f92672">=</span> input_ids[:max_input_length]
</span></span><span style="display:flex;"><span>                token_type_ids <span style="color:#f92672">=</span> token_type_ids[:max_input_length]
</span></span><span style="display:flex;"><span>            attention_mask <span style="color:#f92672">=</span> [<span style="color:#ae81ff">1</span> <span style="color:#66d9ef">for</span> token_id <span style="color:#f92672">in</span> input_ids]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># convert and collect inputs as tensors</span>
</span></span><span style="display:flex;"><span>            input_ids <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>LongTensor(input_ids)
</span></span><span style="display:flex;"><span>            attention_mask <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>FloatTensor(attention_mask)
</span></span><span style="display:flex;"><span>            token_type_ids <span style="color:#f92672">=</span> torch<span style="color:#f92672">.</span>LongTensor(token_type_ids)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># collect all inputs as a dictionary</span>
</span></span><span style="display:flex;"><span>            instance <span style="color:#f92672">=</span> {}
</span></span><span style="display:flex;"><span>            instance[<span style="color:#e6db74">&#39;input_ids&#39;</span>] <span style="color:#f92672">=</span> input_ids
</span></span><span style="display:flex;"><span>            instance[<span style="color:#e6db74">&#39;attention_mask&#39;</span>] <span style="color:#f92672">=</span> attention_mask
</span></span><span style="display:flex;"><span>            instance[<span style="color:#e6db74">&#39;token_type_ids&#39;</span>] <span style="color:#f92672">=</span> token_type_ids
</span></span><span style="display:flex;"><span>            query_instances<span style="color:#f92672">.</span>append(instance)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#################################################################</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#    Predict relevance scores for all BM25-top-1000 documents</span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">#################################################################</span>
</span></span><span style="display:flex;"><span>        doc_scores <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>empty((<span style="color:#ae81ff">0</span>,<span style="color:#ae81ff">1</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># Predict scores for each document</span>
</span></span><span style="display:flex;"><span>        dataloader <span style="color:#f92672">=</span> get_test_dataloader(query_instances, batch_size<span style="color:#f92672">=</span>batch_size<span style="color:#f92672">*</span>(num_negatives<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>), num_workers<span style="color:#f92672">=</span>num_workers)
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">for</span> di, batch <span style="color:#f92672">in</span> enumerate(dataloader, start<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>):
</span></span><span style="display:flex;"><span>            batch <span style="color:#f92672">=</span> (tensor<span style="color:#f92672">.</span>cuda() <span style="color:#66d9ef">for</span> tensor <span style="color:#f92672">in</span> batch)
</span></span><span style="display:flex;"><span>            input_ids, attention_mask, token_type_ids <span style="color:#f92672">=</span> batch
</span></span><span style="display:flex;"><span>            
</span></span><span style="display:flex;"><span>            <span style="color:#e6db74">&#39;&#39;&#39; TO-DO: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            1. Compute the logits as relevance scores (using the same function of how you compute built-in loss)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              (Hint: You need to call a function of model which takes all the 3 tensors in the batch as inputs)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">         
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            2. The scores are still on GPU. Reallocate them on CPU, and convert into numpy arrays.
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">              (Hint: You need to call two functions on the `scores` tensors. You can find them in PyTorch tutorial.)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">            &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">with</span> torch<span style="color:#f92672">.</span>no_grad():
</span></span><span style="display:flex;"><span>                <span style="color:#75715e">### 1. insert_missing_code_to_compute_logits ###</span>
</span></span><span style="display:flex;"><span>                scores <span style="color:#f92672">=</span> model( input_ids<span style="color:#f92672">=</span>input_ids, attention_mask<span style="color:#f92672">=</span>attention_mask,     
</span></span><span style="display:flex;"><span>                                token_type_ids<span style="color:#f92672">=</span>token_type_ids, return_dict<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span> )<span style="color:#f92672">.</span>logits  
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># merge all scores into a big numpy array</span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e">### step 2.  insert_missing_function_1()###.###insert_missing_function_2()</span>
</span></span><span style="display:flex;"><span>            scores <span style="color:#f92672">=</span> scores<span style="color:#f92672">.</span>cpu()<span style="color:#f92672">.</span>numpy() 
</span></span><span style="display:flex;"><span>            doc_scores <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>vstack((doc_scores, scores)) <span style="color:#75715e">## 新增new row</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#75715e"># Progress bar with timer ;-)</span>
</span></span><span style="display:flex;"><span>            elapsed_time <span style="color:#f92672">=</span> time() <span style="color:#f92672">-</span> start_time
</span></span><span style="display:flex;"><span>            elapsed_time <span style="color:#f92672">=</span> timedelta(seconds<span style="color:#f92672">=</span>int(elapsed_time))
</span></span><span style="display:flex;"><span>            print(<span style="color:#e6db74">&#34;Query: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> | Progress: </span><span style="color:#e6db74">%d</span><span style="color:#e6db74">/</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> | </span><span style="color:#e6db74">%s</span><span style="color:#e6db74">      </span><span style="color:#ae81ff">\r</span><span style="color:#e6db74">&#34;</span> \
</span></span><span style="display:flex;"><span>                  <span style="color:#f92672">%</span> (qi, len(df), di, len(dataloader), elapsed_time), end<span style="color:#f92672">=</span><span style="color:#e6db74">&#39;&#39;</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#75715e"># merge all query/BM25 document pair scores</span>
</span></span><span style="display:flex;"><span>        query_doc_scores<span style="color:#f92672">.</span>append(doc_scores)
</span></span><span style="display:flex;"><span>    query_doc_scores <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>hstack(query_doc_scores)<span style="color:#f92672">.</span>T
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    print()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> query_doc_scores, query_doc_ids
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## (TO-DO!) Find best weight of BERT for BM25 rescoring on training set</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dev_query_doc_scores, dev_query_doc_ids <span style="color:#f92672">=</span> predict_query_doc_scores(model, dev_df)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#39;---- Grid search weight for &#34;BM25 + weight * BERT&#34; ----&#39;</span>)
</span></span><span style="display:flex;"><span>best_map_score, best_bert_weight <span style="color:#f92672">=</span> <span style="color:#f92672">-</span><span style="color:#ae81ff">100</span>, <span style="color:#ae81ff">0.0</span>
</span></span><span style="display:flex;"><span>bert_scores <span style="color:#f92672">=</span> dev_query_doc_scores
</span></span><span style="display:flex;"><span>n_query <span style="color:#f92672">=</span> dev_query_doc_scores<span style="color:#f92672">.</span>shape[<span style="color:#ae81ff">0</span>]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Get MAP@K of BM25 baseline</span>
</span></span><span style="display:flex;"><span>query_pos_doc_ids <span style="color:#f92672">=</span> dev_df[<span style="color:#e6db74">&#39;pos_doc_ids&#39;</span>]<span style="color:#f92672">.</span>values<span style="color:#f92672">.</span>tolist()
</span></span><span style="display:flex;"><span>actual <span style="color:#f92672">=</span> [doc_ids<span style="color:#f92672">.</span>split() <span style="color:#66d9ef">for</span> doc_ids <span style="color:#f92672">in</span> query_pos_doc_ids]
</span></span><span style="display:flex;"><span>bm25_predicted <span style="color:#f92672">=</span> [doc_id_list[:K] <span style="color:#66d9ef">for</span> doc_id_list <span style="color:#f92672">in</span> dev_query_doc_ids]
</span></span><span style="display:flex;"><span>map_score <span style="color:#f92672">=</span> mapk(actual, bm25_predicted, k<span style="color:#f92672">=</span>K)
</span></span><span style="display:flex;"><span>best_map_score <span style="color:#f92672">=</span> map_score
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;weight=</span><span style="color:#e6db74">%.1f</span><span style="color:#e6db74">: </span><span style="color:#e6db74">%.5f</span><span style="color:#e6db74">  (BM25 baseline)&#34;</span> <span style="color:#f92672">%</span> (<span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">100</span><span style="color:#f92672">*</span>map_score))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Collect BM25 scores into same format of BERT scores</span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39; TO-DO: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1. Convert the BM25 top-1000 scores into 2d numpy arrays
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">2. BM25 scores should have the same shape and orders as `dev_query_doc_scores` (i.e. BERT scores)
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">  (Hint: If there are 24 dev-set queries, the shape should be (24, 1000) )
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 2. insert_whatever_you_want_to_meet_the_requirement_in_step2.</span>
</span></span><span style="display:flex;"><span>bm25_scores <span style="color:#f92672">=</span> [scores<span style="color:#f92672">.</span>split() <span style="color:#66d9ef">for</span> scores <span style="color:#f92672">in</span> dev_df[<span style="color:#e6db74">&#34;bm25_top1000_scores&#34;</span>]] 
</span></span><span style="display:flex;"><span>bm25_scores <span style="color:#f92672">=</span> [[float(score) <span style="color:#66d9ef">for</span> score <span style="color:#f92672">in</span> scores] <span style="color:#66d9ef">for</span> scores <span style="color:#f92672">in</span> bm25_scores]
</span></span><span style="display:flex;"><span>bm25_scores <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(bm25_scores)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Grid search for BM25 + BERT rescoring</span>
</span></span><span style="display:flex;"><span>low_bound, high_bound, scale <span style="color:#f92672">=</span> <span style="color:#ae81ff">0</span>, <span style="color:#ae81ff">5</span>, <span style="color:#ae81ff">1000</span>
</span></span><span style="display:flex;"><span>grids <span style="color:#f92672">=</span> [i <span style="color:#f92672">/</span> scale <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(low_bound <span style="color:#f92672">*</span> scale<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>, high_bound <span style="color:#f92672">*</span> scale<span style="color:#f92672">+</span><span style="color:#ae81ff">1</span>)]
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> weight <span style="color:#f92672">in</span> grids:
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#e6db74">&#39;&#39;&#39; TO-DO: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    1. Compute the weighted scores using `bm25_scores`, `weight`, and `bert_scores`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    &#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span>    weighted_scores <span style="color:#f92672">=</span> bm25_scores <span style="color:#f92672">+</span> weight <span style="color:#f92672">*</span> bert_scores <span style="color:#75715e">### 1. insert_missing_code ###</span>
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># sort index and map to document ids as output</span>
</span></span><span style="display:flex;"><span>    rescore_argsort <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>flip(weighted_scores<span style="color:#f92672">.</span>argsort(), axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>    predicted <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n_query):  <span style="color:#75715e"># num. of queries</span>
</span></span><span style="display:flex;"><span>        predicted<span style="color:#f92672">.</span>append([dev_query_doc_ids[i][idx] <span style="color:#66d9ef">for</span> idx <span style="color:#f92672">in</span> rescore_argsort[i]][:K])
</span></span><span style="display:flex;"><span>    map_score <span style="color:#f92672">=</span> mapk(actual, predicted, k<span style="color:#f92672">=</span>K)
</span></span><span style="display:flex;"><span>    
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># show part of results for human evaluation</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> weight <span style="color:#f92672">*</span> <span style="color:#ae81ff">10</span> <span style="color:#f92672">%</span> <span style="color:#ae81ff">2</span> <span style="color:#f92672">==</span> <span style="color:#ae81ff">0</span>:
</span></span><span style="display:flex;"><span>        print(<span style="color:#e6db74">&#34;weight=</span><span style="color:#e6db74">%.1f</span><span style="color:#e6db74">: </span><span style="color:#e6db74">%.5f</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (weight, <span style="color:#ae81ff">100</span><span style="color:#f92672">*</span>map_score))
</span></span><span style="display:flex;"><span>        
</span></span><span style="display:flex;"><span>    <span style="color:#75715e"># track weight with best MAP@10</span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> map_score <span style="color:#f92672">&gt;</span> best_map_score:
</span></span><span style="display:flex;"><span>        best_map_score <span style="color:#f92672">=</span> map_score
</span></span><span style="display:flex;"><span>        best_bert_weight <span style="color:#f92672">=</span> weight
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;</span><span style="color:#ae81ff">\n</span><span style="color:#e6db74">Highest MAP@</span><span style="color:#e6db74">%d</span><span style="color:#e6db74"> = </span><span style="color:#e6db74">%.5f</span><span style="color:#e6db74"> found at weight=</span><span style="color:#e6db74">%.3f</span><span style="color:#e6db74">&#34;</span> <span style="color:#f92672">%</span> (K, <span style="color:#ae81ff">100</span><span style="color:#f92672">*</span>best_map_score, best_bert_weight))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># ## (TO-DO!) Rescore testing set with BERT for submission</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Predict BERT scores for testing set</span>
</span></span><span style="display:flex;"><span>test_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>read_csv(testing_csv_path)
</span></span><span style="display:flex;"><span>query_id_list <span style="color:#f92672">=</span> test_df[<span style="color:#e6db74">&#34;query_id&#34;</span>]
</span></span><span style="display:flex;"><span>n_query <span style="color:#f92672">=</span> len(query_id_list)
</span></span><span style="display:flex;"><span>test_query_doc_scores, test_query_doc_ids <span style="color:#f92672">=</span> predict_query_doc_scores(model, test_df)
</span></span><span style="display:flex;"><span>bert_scores <span style="color:#f92672">=</span> test_query_doc_scores
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># In[ ]:</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Rescore query/document score with BM25 + BERT</span>
</span></span><span style="display:flex;"><span>bm25_scores <span style="color:#f92672">=</span> [scores<span style="color:#f92672">.</span>split() <span style="color:#66d9ef">for</span> scores <span style="color:#f92672">in</span> test_df[<span style="color:#e6db74">&#34;bm25_top1000_scores&#34;</span>]]  <span style="color:#75715e"># parse into 2d list of string</span>
</span></span><span style="display:flex;"><span>bm25_scores <span style="color:#f92672">=</span> [[float(score) <span style="color:#66d9ef">for</span> score <span style="color:#f92672">in</span> scores] <span style="color:#66d9ef">for</span> scores <span style="color:#f92672">in</span> bm25_scores]  <span style="color:#75715e"># convert to float</span>
</span></span><span style="display:flex;"><span>bm25_scores <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>array(bm25_scores)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39; TO-DO: 
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">1. Compute the weighted scores using `bm25_scores`, `best_bert_weight`, and `bert_scores`
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#39;&#39;&#39;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">### 1. insesrt_missing_code ###</span>
</span></span><span style="display:flex;"><span>weighted_scores <span style="color:#f92672">=</span> bm25_scores <span style="color:#f92672">+</span> best_bert_weight <span style="color:#f92672">*</span> bert_scores
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Rerank document ids with new scores</span>
</span></span><span style="display:flex;"><span>rescore_argsort <span style="color:#f92672">=</span> np<span style="color:#f92672">.</span>flip(weighted_scores<span style="color:#f92672">.</span>argsort(), axis<span style="color:#f92672">=</span><span style="color:#ae81ff">1</span>)
</span></span><span style="display:flex;"><span>ranked_doc_id_list <span style="color:#f92672">=</span> []
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">for</span> i <span style="color:#f92672">in</span> range(n_query):  <span style="color:#75715e"># num. of queries</span>
</span></span><span style="display:flex;"><span>    ranked_doc_id_list<span style="color:#f92672">.</span>append([test_query_doc_ids[i][idx] <span style="color:#66d9ef">for</span> idx <span style="color:#f92672">in</span> rescore_argsort[i]][:K])
</span></span><span style="display:flex;"><span>ranked_doc_ids <span style="color:#f92672">=</span> [<span style="color:#e6db74">&#39; &#39;</span><span style="color:#f92672">.</span>join(doc_id_list) <span style="color:#66d9ef">for</span> doc_id_list <span style="color:#f92672">in</span> ranked_doc_id_list]
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e"># Save reranked results for submission</span>
</span></span><span style="display:flex;"><span>data <span style="color:#f92672">=</span> {<span style="color:#e6db74">&#39;query_id&#39;</span>: query_id_list, <span style="color:#e6db74">&#39;ranked_doc_ids&#39;</span>: ranked_doc_ids}
</span></span><span style="display:flex;"><span>submission_df <span style="color:#f92672">=</span> pd<span style="color:#f92672">.</span>DataFrame(data)
</span></span><span style="display:flex;"><span>submission_df<span style="color:#f92672">.</span>reset_index(drop<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>, inplace<span style="color:#f92672">=</span><span style="color:#66d9ef">True</span>)
</span></span><span style="display:flex;"><span>submission_df<span style="color:#f92672">.</span>to_csv(save_submission_path, index<span style="color:#f92672">=</span><span style="color:#66d9ef">False</span>)
</span></span><span style="display:flex;"><span>print(<span style="color:#e6db74">&#34;Saved submission file as `</span><span style="color:#e6db74">%s</span><span style="color:#e6db74">`&#34;</span> <span style="color:#f92672">%</span> save_submission_path)
</span></span></code></pre></td></tr></table>
</div>
</div>

        </div>

        <footer class="post-footer">
            
<nav class="paginav">
  <a class="next" href="https://jonathan-tw.github.io/posts/%E8%AA%B2%E7%A8%8B%E7%AD%86%E8%A8%98ntust-network-communication-protocols/">
    <span class="title">Next »</span>
    <br>
    <span>(課程筆記)(NTUST) Network Communication Protocols</span>
  </a>
</nav>


<div class="share-buttons">
    <a target="_blank" rel="noopener noreferrer" aria-label="share (課程筆記)(NTUST) Information Retrieval on twitter"
       href="https://twitter.com/intent/tweet/?text=%28%e8%aa%b2%e7%a8%8b%e7%ad%86%e8%a8%98%29%28NTUST%29%20Information%20Retrieval&amp;url=https%3a%2f%2fjonathan-tw.github.io%2fposts%2f%25E8%25AA%25B2%25E7%25A8%258B%25E7%25AD%2586%25E8%25A8%2598ntust-information-retrieval%2f&amp;hashtags=NTUST%2c%e8%aa%b2%e7%a8%8b%e7%ad%86%e8%a8%98">
    <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-253.927,424.544c135.939,0 210.268,-112.643 210.268,-210.268c0,-3.218 0,-6.437 -0.153,-9.502c14.406,-10.421 26.973,-23.448 36.935,-38.314c-13.18,5.824 -27.433,9.809 -42.452,11.648c15.326,-9.196 26.973,-23.602 32.49,-40.92c-14.252,8.429 -30.038,14.56 -46.896,17.931c-13.487,-14.406 -32.644,-23.295 -53.946,-23.295c-40.767,0 -73.87,33.104 -73.87,73.87c0,5.824 0.613,11.494 1.992,16.858c-61.456,-3.065 -115.862,-32.49 -152.337,-77.241c-6.284,10.881 -9.962,23.601 -9.962,37.088c0,25.594 13.027,48.276 32.95,61.456c-12.107,-0.307 -23.448,-3.678 -33.41,-9.196l0,0.92c0,35.862 25.441,65.594 59.311,72.49c-6.13,1.686 -12.72,2.606 -19.464,2.606c-4.751,0 -9.348,-0.46 -13.946,-1.38c9.349,29.426 36.628,50.728 68.965,51.341c-25.287,19.771 -57.164,31.571 -91.8,31.571c-5.977,0 -11.801,-0.306 -17.625,-1.073c32.337,21.15 71.264,33.41 112.95,33.41Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share (課程筆記)(NTUST) Information Retrieval on linkedin"
       href="https://www.linkedin.com/shareArticle?mini=true&amp;url=https%3a%2f%2fjonathan-tw.github.io%2fposts%2f%25E8%25AA%25B2%25E7%25A8%258B%25E7%25AD%2586%25E8%25A8%2598ntust-information-retrieval%2f&amp;title=%28%e8%aa%b2%e7%a8%8b%e7%ad%86%e8%a8%98%29%28NTUST%29%20Information%20Retrieval&amp;summary=%28%e8%aa%b2%e7%a8%8b%e7%ad%86%e8%a8%98%29%28NTUST%29%20Information%20Retrieval&amp;source=https%3a%2f%2fjonathan-tw.github.io%2fposts%2f%25E8%25AA%25B2%25E7%25A8%258B%25E7%25AD%2586%25E8%25A8%2598ntust-information-retrieval%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-288.985,423.278l0,-225.717l-75.04,0l0,225.717l75.04,0Zm270.539,0l0,-129.439c0,-69.333 -37.018,-101.586 -86.381,-101.586c-39.804,0 -57.634,21.891 -67.617,37.266l0,-31.958l-75.021,0c0.995,21.181 0,225.717 0,225.717l75.02,0l0,-126.056c0,-6.748 0.486,-13.492 2.474,-18.315c5.414,-13.475 17.767,-27.434 38.494,-27.434c27.135,0 38.007,20.707 38.007,51.037l0,120.768l75.024,0Zm-307.552,-334.556c-25.674,0 -42.448,16.879 -42.448,39.002c0,21.658 16.264,39.002 41.455,39.002l0.484,0c26.165,0 42.452,-17.344 42.452,-39.002c-0.485,-22.092 -16.241,-38.954 -41.943,-39.002Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share (課程筆記)(NTUST) Information Retrieval on reddit"
       href="https://reddit.com/submit?url=https%3a%2f%2fjonathan-tw.github.io%2fposts%2f%25E8%25AA%25B2%25E7%25A8%258B%25E7%25AD%2586%25E8%25A8%2598ntust-information-retrieval%2f&title=%28%e8%aa%b2%e7%a8%8b%e7%ad%86%e8%a8%98%29%28NTUST%29%20Information%20Retrieval">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-3.446,265.638c0,-22.964 -18.616,-41.58 -41.58,-41.58c-11.211,0 -21.361,4.457 -28.841,11.666c-28.424,-20.508 -67.586,-33.757 -111.204,-35.278l18.941,-89.121l61.884,13.157c0.756,15.734 13.642,28.29 29.56,28.29c16.407,0 29.706,-13.299 29.706,-29.701c0,-16.403 -13.299,-29.702 -29.706,-29.702c-11.666,0 -21.657,6.792 -26.515,16.578l-69.105,-14.69c-1.922,-0.418 -3.939,-0.042 -5.585,1.036c-1.658,1.073 -2.811,2.761 -3.224,4.686l-21.152,99.438c-44.258,1.228 -84.046,14.494 -112.837,35.232c-7.468,-7.164 -17.589,-11.591 -28.757,-11.591c-22.965,0 -41.585,18.616 -41.585,41.58c0,16.896 10.095,31.41 24.568,37.918c-0.639,4.135 -0.99,8.328 -0.99,12.576c0,63.977 74.469,115.836 166.33,115.836c91.861,0 166.334,-51.859 166.334,-115.836c0,-4.218 -0.347,-8.387 -0.977,-12.493c14.564,-6.47 24.735,-21.034 24.735,-38.001Zm-119.474,108.193c-20.27,20.241 -59.115,21.816 -70.534,21.816c-11.428,0 -50.277,-1.575 -70.522,-21.82c-3.007,-3.008 -3.007,-7.882 0,-10.889c3.003,-2.999 7.882,-3.003 10.885,0c12.777,12.781 40.11,17.317 59.637,17.317c19.522,0 46.86,-4.536 59.657,-17.321c3.016,-2.999 7.886,-2.995 10.885,0.008c3.008,3.011 3.003,7.882 -0.008,10.889Zm-5.23,-48.781c-16.373,0 -29.701,-13.324 -29.701,-29.698c0,-16.381 13.328,-29.714 29.701,-29.714c16.378,0 29.706,13.333 29.706,29.714c0,16.374 -13.328,29.698 -29.706,29.698Zm-160.386,-29.702c0,-16.381 13.328,-29.71 29.714,-29.71c16.369,0 29.689,13.329 29.689,29.71c0,16.373 -13.32,29.693 -29.689,29.693c-16.386,0 -29.714,-13.32 -29.714,-29.693Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share (課程筆記)(NTUST) Information Retrieval on facebook"
       href="https://facebook.com/sharer/sharer.php?u=https%3a%2f%2fjonathan-tw.github.io%2fposts%2f%25E8%25AA%25B2%25E7%25A8%258B%25E7%25AD%2586%25E8%25A8%2598ntust-information-retrieval%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-106.468,0l0,-192.915l66.6,0l12.672,-82.621l-79.272,0l0,-53.617c0,-22.603 11.073,-44.636 46.58,-44.636l36.042,0l0,-70.34c0,0 -32.71,-5.582 -63.982,-5.582c-65.288,0 -107.96,39.569 -107.96,111.204l0,62.971l-72.573,0l0,82.621l72.573,0l0,192.915l-191.104,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share (課程筆記)(NTUST) Information Retrieval on whatsapp"
       href="https://api.whatsapp.com/send?text=%28%e8%aa%b2%e7%a8%8b%e7%ad%86%e8%a8%98%29%28NTUST%29%20Information%20Retrieval%20-%20https%3a%2f%2fjonathan-tw.github.io%2fposts%2f%25E8%25AA%25B2%25E7%25A8%258B%25E7%25AD%2586%25E8%25A8%2598ntust-information-retrieval%2f">
        <svg version="1.1" viewBox="0 0 512 512" xml:space="preserve">
            <path
                    d="M449.446,0c34.525,0 62.554,28.03 62.554,62.554l0,386.892c0,34.524 -28.03,62.554 -62.554,62.554l-386.892,0c-34.524,0 -62.554,-28.03 -62.554,-62.554l0,-386.892c0,-34.524 28.029,-62.554 62.554,-62.554l386.892,0Zm-58.673,127.703c-33.842,-33.881 -78.847,-52.548 -126.798,-52.568c-98.799,0 -179.21,80.405 -179.249,179.234c-0.013,31.593 8.241,62.428 23.927,89.612l-25.429,92.884l95.021,-24.925c26.181,14.28 55.659,21.807 85.658,21.816l0.074,0c98.789,0 179.206,-80.413 179.247,-179.243c0.018,-47.895 -18.61,-92.93 -52.451,-126.81Zm-126.797,275.782l-0.06,0c-26.734,-0.01 -52.954,-7.193 -75.828,-20.767l-5.441,-3.229l-56.386,14.792l15.05,-54.977l-3.542,-5.637c-14.913,-23.72 -22.791,-51.136 -22.779,-79.287c0.033,-82.142 66.867,-148.971 149.046,-148.971c39.793,0.014 77.199,15.531 105.329,43.692c28.128,28.16 43.609,65.592 43.594,105.4c-0.034,82.149 -66.866,148.983 -148.983,148.984Zm81.721,-111.581c-4.479,-2.242 -26.499,-13.075 -30.604,-14.571c-4.105,-1.495 -7.091,-2.241 -10.077,2.241c-2.986,4.483 -11.569,14.572 -14.182,17.562c-2.612,2.988 -5.225,3.364 -9.703,1.12c-4.479,-2.241 -18.91,-6.97 -36.017,-22.23c-13.314,-11.876 -22.304,-26.542 -24.916,-31.026c-2.612,-4.484 -0.279,-6.908 1.963,-9.14c2.016,-2.007 4.48,-5.232 6.719,-7.847c2.24,-2.615 2.986,-4.484 4.479,-7.472c1.493,-2.99 0.747,-5.604 -0.374,-7.846c-1.119,-2.241 -10.077,-24.288 -13.809,-33.256c-3.635,-8.733 -7.327,-7.55 -10.077,-7.688c-2.609,-0.13 -5.598,-0.158 -8.583,-0.158c-2.986,0 -7.839,1.121 -11.944,5.604c-4.105,4.484 -15.675,15.32 -15.675,37.364c0,22.046 16.048,43.342 18.287,46.332c2.24,2.99 31.582,48.227 76.511,67.627c10.685,4.615 19.028,7.371 25.533,9.434c10.728,3.41 20.492,2.929 28.209,1.775c8.605,-1.285 26.499,-10.833 30.231,-21.295c3.732,-10.464 3.732,-19.431 2.612,-21.298c-1.119,-1.869 -4.105,-2.99 -8.583,-5.232Z" />
        </svg>
    </a>
    <a target="_blank" rel="noopener noreferrer" aria-label="share (課程筆記)(NTUST) Information Retrieval on telegram"
       href="https://telegram.me/share/url?text=%28%e8%aa%b2%e7%a8%8b%e7%ad%86%e8%a8%98%29%28NTUST%29%20Information%20Retrieval&amp;url=https%3a%2f%2fjonathan-tw.github.io%2fposts%2f%25E8%25AA%25B2%25E7%25A8%258B%25E7%25AD%2586%25E8%25A8%2598ntust-information-retrieval%2f">
        <svg version="1.1" xml:space="preserve" viewBox="2 2 28 28">
            <path
                    d="M26.49,29.86H5.5a3.37,3.37,0,0,1-2.47-1,3.35,3.35,0,0,1-1-2.47V5.48A3.36,3.36,0,0,1,3,3,3.37,3.37,0,0,1,5.5,2h21A3.38,3.38,0,0,1,29,3a3.36,3.36,0,0,1,1,2.46V26.37a3.35,3.35,0,0,1-1,2.47A3.38,3.38,0,0,1,26.49,29.86Zm-5.38-6.71a.79.79,0,0,0,.85-.66L24.73,9.24a.55.55,0,0,0-.18-.46.62.62,0,0,0-.41-.17q-.08,0-16.53,6.11a.59.59,0,0,0-.41.59.57.57,0,0,0,.43.52l4,1.24,1.61,4.83a.62.62,0,0,0,.63.43.56.56,0,0,0,.4-.17L16.54,20l4.09,3A.9.9,0,0,0,21.11,23.15ZM13.8,20.71l-1.21-4q8.72-5.55,8.78-5.55c.15,0,.23,0,.23.16a.18.18,0,0,1,0,.06s-2.51,2.3-7.52,6.8Z" />
        </svg>
    </a>
</div>

        </footer>
    </div>
</article>
</main>


<script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>


<footer class="footer">
    <span>
        Copyright
        &copy;
        2023-2023
        <a href="https://jonathan-tw.github.io" style="color:#939393;">Jonathan&#39;s Blog</a>
        All Rights Reserved
    </span>

    <a href="https://beian.miit.gov.cn/" target="_blank" style="color:#939393;"></a>&nbsp;


    <span id="busuanzi_container">
        <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.3.0/css/font-awesome.min.css">
        Viewers: <span id="busuanzi_value_site_uv"></span>
        Views: <span id="busuanzi_value_site_pv"></span>
    </span>

</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <span class="topInner">
        <svg class="topSvg" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
            <path d="M12 6H0l6-6z"/>
        </svg>
        <span id="read_progress"></span>
    </span>
</a>

<script>
    document.addEventListener('scroll', function (e) {
        const readProgress = document.getElementById("read_progress");
        const scrollHeight = document.documentElement.scrollHeight;
        const clientHeight = document.documentElement.clientHeight;
        const scrollTop = document.documentElement.scrollTop || document.body.scrollTop;
        
        readProgress.innerText = ((scrollTop / (scrollHeight - clientHeight)).toFixed(2) * 100).toFixed(0);
    })
</script><script>

  let detail = document.getElementsByClassName('details')
 
  details = [].slice.call(detail);
 
  for (let index = 0; index < details.length; index++) {
 
  let element = details[index]
 
  const summary = element.getElementsByClassName('details-summary')[0];
 
  if (summary) {
 
  summary.addEventListener('click', () => {
 
  element.classList.toggle('open');
 
  }, false);
 
  }
 
  }
 
 </script>
 

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    let mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 400 || document.documentElement.scrollTop > 400) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };
</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
<script>
    document.querySelectorAll('pre > code').forEach((codeblock) => {
        const container = codeblock.parentNode.parentNode;

        const copybutton = document.createElement('button');
        copybutton.classList.add('copy-code');
        copybutton.innerText = 'copy';

        function copyingDone() {
            copybutton.innerText = 'copied!';
            setTimeout(() => {
                copybutton.innerText = 'copy';
            }, 2000);
        }

        copybutton.addEventListener('click', (cb) => {
            if ('clipboard' in navigator) {
                let text = codeblock.textContent +
                    '\r\n————————————————\r\n' +
                    '版权声明：本文为「' + "Jonathan's Blog"
                +'」的原创文章，遵循CC 4.0 BY-SA版权协议，转载请附上原文出处链接及本声明。' +
                '\r\n原文链接：' + location.href;
                navigator.clipboard.writeText(text);
                copyingDone();
                return;
            }

            const range = document.createRange();
            range.selectNodeContents(codeblock);
            const selection = window.getSelection();
            selection.removeAllRanges();
            selection.addRange(range);
            try {
                document.execCommand('copy');
                copyingDone();
            } catch (e) {
            }
            ;
            selection.removeRange(range);
        });

        if (container.classList.contains("highlight")) {
            container.appendChild(copybutton);
        } else if (container.parentNode.firstChild === container) {
            
        } else if (codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName === "TABLE") {
            
            codeblock.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(copybutton);
        } else {
            
            codeblock.parentNode.appendChild(copybutton);
        }
    });
</script>

<script src="https://code.jquery.com/jquery-1.12.4.min.js"></script>
<script>
    $("code[class^=language] ").on("mouseover", function () {
        if (this.clientWidth < this.scrollWidth) {
            $(this).css("width", "135%")
        }
    }).on("mouseout", function () {
        $(this).css("width", "100%")
    })
</script>
</body>

</html>
